(this["webpackJsonp@papercups-io/chat-builder-nes-example"]=this["webpackJsonp@papercups-io/chat-builder-nes-example"]||[]).push([[0],{19:function(e,t,n){e.exports=n(48)},20:function(e,t,n){},48:function(e,t,n){"use strict";n.r(t);n(20);var r=n(0),o=n.n(r),a=n(14),i=n.n(a),s=n(3),c=n(5),u=n(1),l=n(4),d=n.n(l);function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e,t){return t||(t=e.slice(0)),e.raw=t,e}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function h(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var v=function(){return o.a.createElement("div",{style:{display:"flex",margin:8,justifyContent:"center",alignItems:"center"}},o.a.createElement("a",{href:"https://papercups.io?utm_source=papercups&utm_medium=chat&utm_campaign=chat-builder-link",target:"_blank",rel:"noopener noreferrer",style:{color:"gray",opacity:.8,transition:"0.2s"}},"Powered by Papercups"))},b="https://app.papercups.io";function y(){}function w(){var e=new Date;return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds())}var S,x,E=function(e,t,n){if(e.addEventListener){for(var r,o=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return p(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,void 0):void 0}}(e))){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}(t);!(r=o()).done;)e.addEventListener(r.value,n);return function(){return t.map((function(t){return e.removeEventListener(t,n)}))}}return console.error("Custom events are not supported in your browser!"),y},_={},P=function(e,t){void 0===t&&(t={});try{return Promise.resolve(d.a.get(e,{params:t}).then((function(e){return e.data.data})))}catch(e){return Promise.reject(e)}},C=function(e,t){void 0===t&&(t={});try{return Promise.resolve(d.a.post(e,t).then((function(e){return e.data.data})))}catch(e){return Promise.reject(e)}},I=function(e,t){void 0===t&&(t={});try{return Promise.resolve(d.a.put(e,t).then((function(e){return e.data.data})))}catch(e){return Promise.reject(e)}},O=function(e,t,n){void 0===t&&(t=_),void 0===n&&(n=b);try{return C(n+"/api/customers",{customer:f({},t,{account_id:e,first_seen:w(),last_seen:w()})})}catch(e){return Promise.reject(e)}},M=function(e,t,n){return void 0===t&&(t=_),void 0===n&&(n=b),I(n+"/api/customers/"+e+"/metadata",{metadata:t})},k=function(){function e(e){this.debugModeEnabled=!!e}var t=e.prototype;return t.debug=function(){var e;this.debugModeEnabled&&(e=console).debug.apply(e,arguments)},t.log=function(){var e;this.debugModeEnabled&&(e=console).log.apply(e,arguments)},t.info=function(){var e;(e=console).info.apply(e,arguments)},t.warn=function(){var e;(e=console).warn.apply(e,arguments)},t.error=function(){var e;(e=console).error.apply(e,arguments)},e}(),j=function(e){return void 0!==e.hidden?{hidden:"hidden",event:"visibilitychange",state:"visibilityState"}:void 0!==e.mozHidden?{hidden:"mozHidden",event:"mozvisibilitychange",state:"mozVisibilityState"}:void 0!==e.msHidden?{hidden:"msHidden",event:"msvisibilitychange",state:"msVisibilityState"}:void 0!==e.webkitHidden?{hidden:"webkitHidden",event:"webkitvisibilitychange",state:"webkitVisibilityState"}:{hidden:null,event:null,state:null}},A=function(e){var t=j(e).hidden;return!!t&&!!e[t]},T=function(e,t){var n=j(e).event;return e.addEventListener(n,t,!1),function(){return e.removeEventListener(n,t)}};function U(e){var t=function(e){var t=Array.prototype,n=Function.prototype,r=Object.prototype,o=r.toString,a=r.hasOwnProperty,i=e.navigator,s=n.bind,c=t.forEach,u=Array.isArray,l=t.slice,d={},f=u||function(e){return"[object Array]"===o.call(e)};function g(e){try{return/^\s*\bfunction\b/.test(e)}catch(e){return!1}}function m(e){return"[object String]"==o.call(e)}function p(e){return void 0===e}function h(e,t,n){if(null!=e)if(c&&e.forEach===c)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,o=e.length;r<o;r++)if(r in e&&t.call(n,e[r],r,e)===d)return}else for(var i in e)if(a.call(e,i)&&t.call(n,e[i],i,e)===d)return}var v,b,y,w,S,x,E,_,P,C,I,O,M=(S={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},x=function(e){var t=new SyntaxError(e);throw t.at=v,t.text=y,t},E=function(e){return e&&e!==b&&x("Expected '"+e+"' instead of '"+b+"'"),b=y.charAt(v),v+=1,b},_=function(){var e,t="";for("-"===b&&(t="-",E("-"));b>="0"&&b<="9";)t+=b,E();if("."===b)for(t+=".";E()&&b>="0"&&b<="9";)t+=b;if("e"===b||"E"===b)for(t+=b,E(),"-"!==b&&"+"!==b||(t+=b,E());b>="0"&&b<="9";)t+=b,E();if(e=+t,isFinite(e))return e;x("Bad number")},P=function(){var e,t,n,r="";if('"'===b)for(;E();){if('"'===b)return E(),r;if("\\"===b)if(E(),"u"===b){for(n=0,t=0;t<4&&(e=parseInt(E(),16),isFinite(e));t+=1)n=16*n+e;r+=String.fromCharCode(n)}else{if("string"!=typeof S[b])break;r+=S[b]}else r+=b}x("Bad string")},C=function(){for(;b&&b<=" ";)E()},I=function(){var e=[];if("["===b){if(E("["),C(),"]"===b)return E("]"),e;for(;b;){if(e.push(w()),C(),"]"===b)return E("]"),e;E(","),C()}}x("Bad array")},O=function(){var e,t={};if("{"===b){if(E("{"),C(),"}"===b)return E("}"),t;for(;b;){if(e=P(),C(),E(":"),Object.hasOwnProperty.call(t,e)&&x('Duplicate key "'+e+'"'),t[e]=w(),C(),"}"===b)return E("}"),t;E(","),C()}}x("Bad object")},w=function(){switch(C(),b){case"{":return O();case"[":return I();case'"':return P();case"-":return _();default:return b>="0"&&b<="9"?_():function(){switch(b){case"t":return E("t"),E("r"),E("u"),E("e"),!0;case"f":return E("f"),E("a"),E("l"),E("s"),E("e"),!1;case"n":return E("n"),E("u"),E("l"),E("l"),null}x('Unexpected "'+b+'"')}()}},function(e){var t;return y=e,v=0,b=" ",t=w(),C(),b&&x("Syntax error"),t});function k(e){var t,n,r,o,a="";for(t=n=0,r=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,o=0;o<r;o++){var i=e.charCodeAt(o),s=null;i<128?n++:s=i>127&&i<2048?String.fromCharCode(i>>6|192,63&i|128):String.fromCharCode(i>>12|224,i>>6&63|128,63&i|128),null!==s&&(n>t&&(a+=e.substring(t,n)),a+=s,t=n=o+1)}return n>t&&(a+=e.substring(t,e.length)),a}return{ArrayProto:t,FuncProto:n,ObjProto:r,toString:o,hasOwnProperty:a,win:e,windowConsole:e.console,navigator:i,document:e.document,windowOpera:e.opera,screen:e.screen,userAgent:i.userAgent,intl:e.Intl,nativeBind:s,nativeForEach:c,nativeIndexOf:t.indexOf,nativeIsArray:u,slice:l,breaker:d,__NOOP:function(){},__NOOPTIONS:{},isFunction:g,isString:m,includes:function(e,t){return-1!==e.indexOf(t)},isUndefined:p,timestamp:function(){return Date.now=Date.now||function(){return+new Date},Date.now()},each:h,trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},extend:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return h(n,(function(t){for(var n in t)void 0!==t[n]&&(e[n]=t[n])})),e},bind:function(e,t){var n,r;if(s&&e.bind===s)return s.apply(e,l.call(arguments,1));if(!g(e))throw new TypeError;return n=l.call(arguments,2),r=function(){if(!(this instanceof r))return e.apply(t,n.concat(l.call(arguments)));var o={};o.prototype=e.prototype;var a=new o;o.prototype=null;var i=e.apply(a,n.concat(l.call(arguments)));return Object(i)===i?i:a}},truncate:function e(t,n){var r;return"string"==typeof t?r=t.slice(0,n):f(t)?(r=[],h(t,(function(t){r.push(e(t,n))}))):function(e){return e===Object(e)&&!f(e)}(t)?(r={},h(t,(function(t,o){r[o]=e(t,n)}))):r=t,r},stripEmptyProperties:function(e){var t={};return h(e,(function(e,n){m(e)&&e.length>0&&(t[n]=e)})),t},HTTPBuildQuery:function(e,t){var n,r,o=[];return p(t)&&(t="&"),h(e,(function(e,t){n=encodeURIComponent(e.toString()),r=encodeURIComponent(t),o[o.length]=r+"="+n})),o.join(t)},JSONEncode:function(e){var t=function(e){var t=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return t.lastIndex=0,t.test(e)?'"'+e.replace(t,(function(e){var t=n[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'};return function e(n,r){var i="",s=0,c="",u="",l=0,d=i,f=[],g=r[n];switch(g&&"object"==typeof g&&"function"==typeof g.toJSON&&(g=g.toJSON(n)),typeof g){case"string":return t(g);case"number":return isFinite(g)?String(g):"null";case"boolean":case"undefined":return String(g);case"object":if(!g)return"null";if(i+="    ",f=[],"[object Array]"===o.apply(g)){for(l=g.length,s=0;s<l;s+=1)f[s]=e(s,g)||"null";return u=0===f.length?"[]":i?"[\n"+i+f.join(",\n"+i)+"\n"+d+"]":"["+f.join(",")+"]",i=d,u}for(c in g)a.call(g,c)&&(u=e(c,g))&&f.push(t(c)+(i?": ":":")+u);return u=0===f.length?"{}":i?"{"+f.join(",")+d+"}":"{"+f.join(",")+"}",i=d,u}}("",{"":e})},JSONDecode:M,utf8Encode:k,base64Encode:function(e){var t,n,r,o,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=0,s=0,c="",u=[];if(!e)return e;e=k(e);do{t=(o=e.charCodeAt(i++)<<16|e.charCodeAt(i++)<<8|e.charCodeAt(i++))>>12&63,n=o>>6&63,r=63&o,u[s++]=a.charAt(o>>18&63)+a.charAt(t)+a.charAt(n)+a.charAt(r)}while(i<e.length);switch(c=u.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c},getQueryParam:function(e,t){t=t.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);if(null===n||n&&"string"!=typeof n[1]&&n[1].length)return"";var r=n[1];try{r=decodeURIComponent(r)}catch(e){console.error("Skipping decoding for malformed query param: "+r)}return r.replace(/\+/g," ")}}}(e),n=t.navigator,r=t.userAgent,o=t.windowOpera,a=t.intl,i=t.each,s=t.extend,c=t.includes,u=t.timestamp,l=t.stripEmptyProperties,d=t.getQueryParam,f={campaignParams:function(){var e="utm_source utm_medium utm_campaign utm_content utm_term".split(" "),t="",n={};return i(e,(function(e){(t=d(document.URL,e)).length&&(n[e]=t)})),n},searchEngine:function(e){return 0===e.search("https?://(.*)google.([^/?]*)")?"google":0===e.search("https?://(.*)bing.com")?"bing":0===e.search("https?://(.*)yahoo.com")?"yahoo":0===e.search("https?://(.*)duckduckgo.com")?"duckduckgo":null},searchInfo:function(e){var t=f.searchEngine(e),n="yahoo"!=t?"q":"p",r={};if(null!==t){r.$search_engine=t;var o=d(e,n);o.length&&(r.ph_keyword=o)}return r},browser:function(e,t,n){return t=t||"",n||c(e," OPR/")?c(e,"Mini")?"Opera Mini":"Opera":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":c(e,"IEMobile")||c(e,"WPDesktop")?"Internet Explorer Mobile":c(e,"SamsungBrowser/")?"Samsung Internet":c(e,"Edge")||c(e,"Edg/")?"Microsoft Edge":c(e,"FBIOS")?"Facebook Mobile":c(e,"Chrome")?"Chrome":c(e,"CriOS")?"Chrome iOS":c(e,"UCWEB")||c(e,"UCBrowser")?"UC Browser":c(e,"FxiOS")?"Firefox iOS":c(t,"Apple")?c(e,"Mobile")?"Mobile Safari":"Safari":c(e,"Android")?"Android Mobile":c(e,"Konqueror")?"Konqueror":c(e,"Firefox")?"Firefox":c(e,"MSIE")||c(e,"Trident/")?"Internet Explorer":c(e,"Gecko")?"Mozilla":""},browserVersion:function(e,t,n){var r={"Internet Explorer Mobile":/rv:(\d+(\.\d+)?)/,"Microsoft Edge":/Edge?\/(\d+(\.\d+)?)/,Chrome:/Chrome\/(\d+(\.\d+)?)/,"Chrome iOS":/CriOS\/(\d+(\.\d+)?)/,"UC Browser":/(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/,Safari:/Version\/(\d+(\.\d+)?)/,"Mobile Safari":/Version\/(\d+(\.\d+)?)/,Opera:/(Opera|OPR)\/(\d+(\.\d+)?)/,Firefox:/Firefox\/(\d+(\.\d+)?)/,"Firefox iOS":/FxiOS\/(\d+(\.\d+)?)/,Konqueror:/Konqueror:(\d+(\.\d+)?)/,BlackBerry:/BlackBerry (\d+(\.\d+)?)/,"Android Mobile":/android\s(\d+(\.\d+)?)/,"Samsung Internet":/SamsungBrowser\/(\d+(\.\d+)?)/,"Internet Explorer":/(rv:|MSIE )(\d+(\.\d+)?)/,Mozilla:/rv:(\d+(\.\d+)?)/}[f.browser(e,t,n)];if(void 0===r)return null;var o=e.match(r);return o?parseFloat(o[o.length-2]):null},os:function(){var e=r;return/Windows/i.test(e)?/Phone/.test(e)||/WPDesktop/.test(e)?"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(e)?"iOS":/Android/.test(e)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Mac/i.test(e)?"Mac OS X":/Linux/.test(e)?"Linux":/CrOS/.test(e)?"Chrome OS":""},device:function(e){return/Windows Phone/i.test(e)||/WPDesktop/.test(e)?"Windows Phone":/iPad/.test(e)?"iPad":/iPod/.test(e)?"iPod Touch":/iPhone/.test(e)?"iPhone":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Android/.test(e)?"Android":""},referringDomain:function(e){var t=e.split("/");return t.length>=3?t[2]:""},timezone:function(e){try{return e.DateTimeFormat().resolvedOptions().timeZone}catch(e){return null}},properties:function(){var t;return s(l({os:f.os(),browser:f.browser(r,n.vendor,o),referrer:document.referrer,referring_domain:f.referringDomain(document.referrer),device:f.device(r),time_zone:f.timezone(a)}),{current_url:e.location.href,host:e.location.host,pathname:e.location.pathname,browser_version:null===(t=f.browserVersion(r,n.vendor,o))||void 0===t?void 0:t.toString(),screen_height:screen.height,screen_width:screen.width,lib:"web",insert_id:Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),time:u()/1e3})}};return f.properties()}var B,D,F,N=u.a.div(S||(S=m([""]))),W=u.a.div(x||(x=m(["\n  display: flex;\n"]))),R=u.a.div((function(e){var t=e.isOpen;return{margin:0,zIndex:2147483e3,position:"fixed",bottom:100,right:20,width:376,maxWidth:["90%","376px"],minHeight:t?250:0,maxHeight:["60%","704px"],background:"#fff",boxShadow:"rgba(0, 0, 0, 0.16) 0px 5px 40px",height:t?"calc(100% - 120px)":0,border:"none",borderRadius:8,overflow:"hidden",transition:"opacity 0.2s ease-in, transform 0.2s ease-in",opacity:t?1:0,transform:t?"none":"translateY(4px) translateZ(0px)",pointerEvents:t?"auto":"none"}})),z=u.a.div((function(e){var t=e.isOpen;return{margin:0,zIndex:2147483e3,position:"fixed",bottom:100,right:20,width:240,maxWidth:["90%","376px"],minHeight:t?250:0,maxHeight:["60%","704px"],background:"transparent",boxShadow:"none",height:t?"calc(100% - 120px)":0,border:"none",borderRadius:8,overflow:"hidden",transition:"opacity 0.2s ease-in, transform 0.2s ease-in",opacity:t?1:0,transform:t?"none":"translateY(4px) translateZ(0px)",pointerEvents:t?"auto":"none"}})),V=u.a.div({position:"fixed",zIndex:2147483003,bottom:20,right:20}),H=function(e){var t,n;function r(t){var n;return(n=e.call(this,t)||this).scrollToEl=null,n.subscriptions=[],n.EVENTS=["papercups:open","papercups:close","papercups:toggle","papercups:identify","storytime:customer:set"],n.fetchWidgetSettings=function(){try{var e=n.props.config,t={};return Promise.resolve(function(e,t){void 0===t&&(t=b);try{return P(t+"/api/widget_settings",{account_id:e})}catch(e){return Promise.reject(e)}}(e.accountId,e.baseUrl).then((function(e){return e||t})).catch((function(){return t})))}catch(e){return Promise.reject(e)}},n.customEventHandlers=function(e){if(!e||!e.type)return null;var t=e.detail;switch(e.type){case"papercups:open":return n.setOpenState(!0);case"papercups:close":return n.setOpenState(!1);case"papercups:toggle":return n.handleToggleOpen();case"storytime:customer:set":return console.warn("No handler has been set up to handle event `storytime:customer:set`",t);default:return null}},n.updateWidgetSettingsMetadata=function(){try{var e=n.props.config,t=e.accountId,r=e.baseUrl,o=U(window);return Promise.resolve(function(e,t,n){void 0===n&&(n=b);try{return I(n+"/api/widget_settings/metadata",{account_id:e,metadata:t})}catch(e){return Promise.reject(e)}}(t,o,r).catch((function(e){n.logger.error("Failed to update widget metadata:",e)})))}catch(e){return Promise.reject(e)}},n.setOpenState=function(e){n.setState({isOpen:e},(function(){n.handleVisibilityChange(),e&&n.scrollIntoView()}))},n.handleToggleOpen=function(){var e=n.state;e.isLoaded&&n.setOpenState(!e.isOpen)},n.handleChatLoaded=function(){n.setState({isLoaded:!0});var e=n.props.onChatLoaded,t=void 0===e?y:e;t&&"function"==typeof t&&t()},n.sendCustomerUpdate=function(e){var t=e.customerId,r=f({},U(window),n.formatCustomerMetadata());return n.updateExistingCustomer(t,r)},n.formatCustomerMetadata=function(){var e=n.props.config.customer,t=void 0===e?{}:e;return t?Object.keys(t).reduce((function(e,n){var r,o;return f({},e,"metadata"===n?((r={})[n]=t[n],r):((o={})[n]=String(t[n]),o))}),{}):{}},n.handleCacheCustomerId=function(e){n.logger.debug("Caching customer ID:",e),window.dispatchEvent(new CustomEvent("papercups:customer:set",{detail:e})),n.storage.setCustomerId(e)},n.handleMessageReceived=function(e){var t=n.props.onMessageReceived,r=void 0===t?y:t;e.user_id&&!e.customer_id&&r&&r(e)},n.handleMessageSent=function(e){var t=n.props.onMessageSent,r=void 0===t?y:t;r&&r(e)},n.handleUnseenMessages=function(e){n.logger.debug("Handling unseen messages:",e),n.setState({shouldDisplayNotifications:!0})},n.handleMessagesSeen=function(){n.logger.debug("Handling messages seen"),n.setState({shouldDisplayNotifications:!1})},n.listenForNewConversations=function(e){var t=n.props.config.customer,r=n.socket.channel("conversation:lobby:"+e,{});r.on("conversation:created",(function(){setTimeout((function(){return n.fetchLatestConversation(e,t)}),1e3)})),r.join().receive("ok",(function(e){n.logger.debug("Successfully listening for new conversations!",e)})).receive("error",(function(e){n.logger.debug("Unable to listen for new conversations!",e)}))},n.listenForAgentAvailability=function(){var e=n.socket.channel("room:"+n.props.config.accountId,{});e.join().receive("ok",(function(e){n.logger.debug("Joined room successfully!",e)})).receive("error",(function(e){n.logger.debug("Unable to join room!",e)}));var t=new c.Presence(e);t.onSync((function(){n.logger.debug("Syncing presence:",t.list()),n.setState({availableAgents:t.list().map((function(e){return e.metas[0]})).filter((function(e){return!!e.user_id}))})}))},n.scrollIntoView=function(){n.scrollToEl&&n.scrollToEl.scrollIntoView(!1)},n.handleVisibilityChange=function(e){var t=document||e&&e.target;if(!A(t)){var r=n.state.messages;(void 0===r?[]:r).some((function(e){return n.shouldMarkAsSeen(e)}))&&n.markMessagesAsSeen()}},n.handlePapercupsPlan=function(e){void 0===e&&(e={}),n.logger.debug("Handling subscription plan:",e),n.setState({shouldDisplayBranding:!0})},n.handleToggleDisplay=function(e){void 0===e&&(e={});var t=!!e.isOpen;n.setState({isOpen:t},(function(){n.handleVisibilityChange(),t&&n.scrollIntoView()}))},n.getDefaultGreeting=function(){var e=n.props.config.greeting;return e?[{type:"bot",customer_id:"bot",body:e,created_at:(new Date).toISOString(),seen_at:(new Date).toISOString()}]:[]},n.isValidCustomer=function(e){try{if(!e||!e.length)return Promise.resolve(!1);if(!((a=e)&&a.length&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)))return Promise.resolve(!1);var t=n.props.config,r=t.baseUrl,o=t.accountId;return Promise.resolve(h((function(){return Promise.resolve(function(e,t,n){void 0===n&&(n=b);try{return P(n+"/api/customers/"+e+"/exists",{account_id:t})}catch(e){return Promise.reject(e)}}(e,o,r))}),(function(){return n.logger.warn("Failed to validate customer ID."),n.logger.warn("You might be on an older version of Papercups."),!0})))}catch(e){return Promise.reject(e)}var a},n.checkForExistingCustomer=function(e,t){try{if(!e||null==e||!e.external_id)return n.setState({customerId:t}),Promise.resolve(t);var r=n.props.config;return Promise.resolve(function(e,t,n,r){void 0===r&&(r=b);try{return P(r+"/api/customers/identify",f({},n,{external_id:e,account_id:t}))}catch(e){return Promise.reject(e)}}(e.external_id,r.accountId,{email:e.email,host:e.host},r.baseUrl)).then((function(e){var r=e.customer_id;return r?r===t?(n.setState({customerId:t}),t):(n.setState({customerId:r}),n.handleCacheCustomerId(r),r):(n.setState({customerId:null}),null)}))}catch(e){return Promise.reject(e)}},n.fetchLatestConversation=function(e,t){try{return Promise.resolve(n.checkForExistingCustomer(t,e)).then((function(e){if(e){var r=n.props.config,o=r.accountId,a=r.baseUrl;return n.logger.debug("Fetching conversations for customer:",e),h((function(){return Promise.resolve(function(e,t,n){void 0===n&&(n=b);try{return P(n+"/api/conversations/customer",{customer_id:e,account_id:t})}catch(e){return Promise.reject(e)}}(e,o,a)).then((function(r){if(n.logger.debug("Found existing conversations:",r),!r||!r.length)return n.setState({messages:[].concat(n.getDefaultGreeting())}),void n.listenForNewConversations(e);var o=r[0],a=o.id,i=o.messages,s=(void 0===i?[]:i).sort((function(e,t){return+new Date(e.created_at)-+new Date(t.created_at)}));return n.setState({conversationId:a,messages:[].concat(n.getDefaultGreeting(),s)}),n.joinConversationChannel(a,e),Promise.resolve(n.updateExistingCustomer(e,t)).then((function(){var e=s.filter((function(e){return!e.seen_at&&!!e.user_id}));e.length>0&&n.handleUnseenMessages({message:e[0]})}))}))}),(function(e){n.logger.debug("Error fetching conversations!",e)}))}n.setState({messages:[].concat(n.getDefaultGreeting())})}))}catch(e){return Promise.reject(e)}},n.createOrUpdateCustomer=function(e,t,r){try{var o=n.props.config,a=o.baseUrl,i=o.customer,s=r?f({},i,{email:r}):i;return Promise.resolve(h((function(){return Promise.resolve(t?M(t,s,a):O(e,s,a)).then((function(e){var r=e.id;return t||n.handleCacheCustomerId(r),r}))}),(function(t){return n.logger.error("Failed to update or create customer:",t),n.logger.error("Retrying..."),Promise.resolve(O(e,s,a)).then((function(e){var t=e.id;return n.handleCacheCustomerId(t),t}))})))}catch(e){return Promise.reject(e)}},n.updateExistingCustomer=function(e,t){try{if(!t)return Promise.resolve();var r=h((function(){return Promise.resolve(M(e,t,n.props.config.baseUrl)).then((function(){}))}),(function(e){n.logger.debug("Error updating customer metadata!",e)}));return Promise.resolve(r&&r.then?r.then((function(){})):void 0)}catch(e){return Promise.reject(e)}},n.initializeNewConversation=function(e,t){try{var r=n.props.config,o=r.accountId,a=r.baseUrl;return Promise.resolve(n.createOrUpdateCustomer(o,e,t)).then((function(e){return Promise.resolve(function(e,t,n){void 0===n&&(n=b);try{return C(n+"/api/conversations",{conversation:{account_id:e,customer_id:t}})}catch(e){return Promise.reject(e)}}(o,e,a)).then((function(t){var r=t.id;return n.setState({customerId:e,conversationId:r}),n.joinConversationChannel(r,e),{customerId:e,conversationId:r}}))}))}catch(e){return Promise.reject(e)}},n.joinConversationChannel=function(e,t){n.channel&&n.channel.leave&&n.channel.leave(),n.logger.debug("Joining channel:",e),n.channel=n.socket.channel("conversation:"+e,{customer_id:t}),n.channel.on("shout",(function(e){n.handleNewMessage(e)})),n.channel.join().receive("ok",(function(e){n.logger.debug("Joined conversation successfully!",e)})).receive("error",(function(e){n.logger.debug("Unable to join conversation!",e)})),n.sendCustomerUpdate({conversationId:e,customerId:t}),n.scrollIntoView()},n.handleNewMessage=function(e){n.handleMessageReceived(e);var t=n.state.messages,r=void 0===t?[]:t,o=r.find((function(t){return!(t.created_at||(n=t.sent_at,r=e.sent_at,!n||!r||Math.floor(+new Date(n)/1e3)!==Math.floor(+new Date(r)/1e3))||t.body!==e.body&&(t.body||e.body));var n,r})),a=o?r.map((function(t){return t.sent_at===o.sent_at?e:t})):[].concat(r,[e]);n.setState({messages:a},(function(){n.scrollIntoView(),n.shouldMarkAsSeen(e)?n.markMessagesAsSeen():o||n.handleUnseenMessages({message:e})}))},n.shouldMarkAsSeen=function(e){var t=n.state.isOpen,r=!!e.user_id;return!e.seen_at&&!A(document)&&r&&t},n.markMessagesAsSeen=function(){var e=n.state,t=e.messages,r=void 0===t?[]:t;n.channel&&e.customerId&&e.conversationId&&(n.logger.debug("Marking messages as seen!"),n.channel.push("messages:seen",{}),n.handleMessagesSeen(),n.setState({messages:r.map((function(e){return e.seen_at?e:f({},e,{seen_at:(new Date).toISOString()})}))}))},n.handleSendMessage=function(e,t){try{var r=function(){n.channel&&(n.channel.push("shout",f({},e,{body:u,customer_id:n.state.customerId,sent_at:m})),n.handleMessageSent(f({},e,{body:u,type:"customer",sent_at:m,customer_id:n.state.customerId,conversation_id:n.state.conversationId})))},o=n.state,a=o.customerId,i=o.conversationId,s=o.isSending,c=e.body,u=void 0===c?"":c,l=e.file_ids,d=void 0===l?[]:l,g=!u||0===u.trim().length;if(s||g&&(!d||0===d.length))return Promise.resolve();var m=(new Date).toISOString(),p=f({},e,{body:u,customer_id:a,type:"customer",sent_at:m});n.setState({messages:[].concat(n.state.messages,[p])},(function(){return n.scrollIntoView()}));var h=function(){if(!a||!i)return Promise.resolve(n.initializeNewConversation(a,t)).then((function(){}))}();return Promise.resolve(h&&h.then?h.then(r):r())}catch(e){return Promise.reject(e)}},n.state={config:{},messages:[],customerId:null,availableAgents:[],conversationId:null,isLoaded:!1,isSending:!1,isOpen:"function"==typeof t.children||!!t.isOpenByDefault,shouldDisplayNotifications:!1,shouldDisplayBranding:!0},n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,g(t,n);var a=r.prototype;return a.componentDidMount=function(){try{var e=this,t=window,n=document||t.document,r=(a=t,Boolean("localhost"===a.location.hostname||"[::1]"===a.location.hostname||a.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/))||!!e.props.debug);return e.logger=new k(r),e.storage=(o=function(e){try{return e&&(e.localStorage||e.sessionStorage)}catch(e){return{_db:{},getItem:function(e){return this._db[e]||null},setItem:function(e,t){this._db[e]=t},removeItem:function(e){delete this._db[e]}}}}(window),{getCustomerId:function(){return function(e){var t=o.getItem("__PAPERCUPS____CUSTOMER_ID__");if(!t)return null;try{return JSON.parse(t)}catch(e){return t}}()},setCustomerId:function(e){o.setItem("__PAPERCUPS____CUSTOMER_ID__",JSON.stringify(e))},removeCustomerId:function(){o.removeItem("__CUSTOMER_ID__")}}),e.subscriptions=[E(window,e.EVENTS,e.customEventHandlers),T(n,e.handleVisibilityChange)],Promise.resolve(e.loadWidgetSettings()).then((function(t){var n=t.baseUrl,r=t.customerId,o=t.metadata;return Promise.resolve(e.isValidCustomer(r)).then((function(t){var a=t?r:null;e.setState({customerId:a});var i=function(e){var t=(e||b).split("://");return("https"===t[0]?"wss":"ws")+"://"+t[1]+"/socket"}(n);return e.socket=new c.Socket(i),e.socket.connect(),e.listenForAgentAvailability(),Promise.resolve(e.fetchLatestConversation(a,o)).then((function(){e.handleChatLoaded()}))}))}))}catch(e){return Promise.reject(e)}var o,a},a.componentWillUnmount=function(){this.channel&&this.channel.leave(),this.subscriptions.forEach((function(e){"function"==typeof e&&e()}))},a.loadWidgetSettings=function(){try{var e=this;return Promise.resolve(e.fetchWidgetSettings()).then((function(t){var n,r,o=e.props.config,a=o.accountId,i=o.primaryColor,s=o.baseUrl,c=o.title,u=o.subtitle,l=o.greeting,d=o.newMessagePlaceholder,g=o.emailInputPlaceholder,m=o.newMessagesNotificationText,p=o.agentAvailableText,h=o.agentUnavailableText,v=o.showAgentAvailability,b=o.customer,y=void 0===b?{}:b,w=f({},U(window),y),S={accountId:a,baseUrl:s,agentAvailableText:p,agentUnavailableText:h,title:c||t.title,subtitle:u||t.subtitle,primaryColor:i||t.color,greeting:l||t.greeting,newMessagePlaceholder:d||t.new_message_placeholder,emailInputPlaceholder:g||t.email_input_placeholder,newMessagesNotificationText:m||t.new_messages_notification_text,companyName:null==t||null===(n=t.account)||void 0===n?void 0:n.company_name,showAgentAvailability:v||t.show_agent_availability,customerId:e.storage.getCustomerId(),subscriptionPlan:null==t||null===(r=t.account)||void 0===r?void 0:r.subscription_plan,metadata:w};return e.setState({config:S}),Promise.resolve(e.updateWidgetSettingsMetadata()).then((function(){return S}))}))}catch(e){return Promise.reject(e)}},a.renderUnreadMessages=function(){var e=this.props.notifications;if(!e||"function"!=typeof e)return null;var t=this.state,n=t.customerId,r=t.messages,a=(void 0===r?[]:r).filter((function(e){var t=e.body;return!e.seen_at&&!function(e,t){return e.customer_id===t||!!e.sent_at&&"customer"===e.type}(e,n)&&t&&t.trim().length>0})).slice(0,2).map((function(e){var t,n,r=e.body;return f({},e,{body:(t=void 0===r?"":r,void 0===n&&(n=" "),t.length<=140?t:t.substr(0,t.lastIndexOf(n,140)).concat("..."))})}));return 0===a.length?null:o.a.createElement(z,{isOpen:!0},o.a.createElement(W,{style:{background:"transparent",flexDirection:"column",justifyContent:"flex-end",height:"100%",width:"100%",flex:1}},e({config:this.props.config,state:this.state,unread:a,onToggleOpen:this.handleToggleOpen})))},a.render=function(){var e=this,t=this.props,n=t.config,r=t.styles,a=void 0===r?{}:r,i=t.children,s=this.state,c=s.isOpen,u=s.shouldDisplayNotifications,l=s.shouldDisplayBranding;return i?i({config:n,state:this.state,onClose:this.handleToggleOpen,onToggleOpen:this.handleToggleOpen,onSendMessage:this.handleSendMessage,scrollToRef:function(t){return e.scrollToEl=t}}):o.a.createElement(o.a.Fragment,null,!c&&u&&this.renderUnreadMessages(),o.a.createElement(R,{className:"Papercups-chatWindowContainer",isOpen:c},o.a.createElement(W,{style:{background:"#fff",flexDirection:"column",height:"100%",width:"100%",flex:1}},this.props.header&&this.props.header({config:n,state:this.state,onClose:this.handleToggleOpen}),o.a.createElement(N,{style:f({flex:1,overflowY:"scroll"},a.body)},this.props.body&&this.props.body({config:n,state:this.state,scrollToRef:function(t){return e.scrollToEl=t}})),l&&o.a.createElement(v,null),this.props.footer&&this.props.footer({config:n,state:this.state,onSendMessage:this.handleSendMessage}),o.a.createElement("img",{alt:"Papercups",src:"https://papercups.s3.us-east-2.amazonaws.com/papercups-logo.svg",width:"0",height:"0"}))),o.a.createElement(V,{className:"Papercups-toggleButtonContainer"},this.props.toggle&&this.props.toggle({config:n,state:this.state,onToggleOpen:this.handleToggleOpen})))},r}(o.a.Component),L=(u.a.button({outline:"none",border:"none",userSelect:"none",cursor:"pointer",width:"50px",height:"50px",borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center","&:focus":{outline:"none"}}),n(17)),J=u.a.div((function(e){return Object(L.a)({color:"#fff",backgroundColor:"#212529",backgroundClip:"padding-box",borderImageOutset:2,borderImageRepeat:"stretch",borderImageSlice:2,borderImageSource:'url(\'data:image/svg+xml;utf8,<?xml version="1.0" encoding="UTF-8" ?><svg version="1.1" width="5" height="5" xmlns="http://www.w3.org/2000/svg"><path d="M2 1 h1 v1 h-1 z M1 2 h1 v1 h-1 z M3 2 h1 v1 h-1 z M2 3 h1 v1 h-1 z" fill="rgb(33,37,41)" /></svg>\')',borderImageWidth:2,borderStyle:"solid",borderWidth:"4px",padding:"0.5rem 1rem"},e.style)})),Y=function(){return o.a.createElement(J,null,o.a.createElement("p",{className:"nes-text",style:{marginBottom:"0.5rem"}},"Welcome to ",o.a.createElement("span",{className:"nes-text is-primary"},"Papercups!")),o.a.createElement("div",null,o.a.createElement("span",null,"Ask us anything in the chat below.")))},q=function(e){var t=e.message;return o.a.createElement("section",{className:"message",style:{width:"85%",display:"flex",alignItems:"center"}},o.a.createElement("i",{className:"nes-bcrikko",style:{marginRight:"10px",flex:"0 0 96px"}}),o.a.createElement("div",{className:"nes-balloon from-left is-dark"},o.a.createElement("p",null,t)))},G=function(e){var t=e.message;return o.a.createElement("section",{className:"message",style:{width:"65%",alignSelf:"flex-end",display:"flex",justifyContent:"flex-end"}},o.a.createElement("div",{className:"nes-balloon from-right is-dark"},o.a.createElement("p",{className:"nes-text is-primary"},t)))},K=function(e){var t=e.state,n=e.scrollToRef,r=t.customerId,a=t.messages,i=void 0===a?[]:a;return o.a.createElement("section",{style:{display:"flex",flexDirection:"column"},className:"message-list"},i.map((function(e,t){var n=e.customer_id===r||!!e.sent_at&&"customer"===e.type,a=e.id||t;return n?o.a.createElement(G,{key:a,message:e.body||""}):o.a.createElement(q,{key:a,message:e.body||""})})),o.a.createElement("div",{key:"scroll-el",ref:n}))},Z=n(16),$=function(e){var t=e.config,n=e.onSendMessage,r=o.a.useState(""),a=Object(Z.a)(r,2),i=a[0],s=a[1];return o.a.createElement("form",{onSubmit:function(e){e.preventDefault(),n({body:i}),s("")}},o.a.createElement("div",null,o.a.createElement("input",{type:"text",className:"nes-input is-dark footer-input",value:i,placeholder:t.newMessagePlaceholder||"Start typing...",onChange:function(e){return s(e.target.value)},style:{border:"none"}})))},Q=function(e){var t=e.state,n=e.onToggleOpen;return o.a.createElement("div",{style:{position:"fixed",bottom:"30px",right:"20px"},onClick:n},o.a.createElement("button",{id:"toggle-btn",type:"button",className:"nes-btn is-primary"},o.a.createElement("span",null,t.isOpen?"X":"Chat")))},X={accountId:"eb504736-0f20-4978-98ff-1a82ae60b266",greeting:"Welcome to the Papercups demo! Feel free to send test messages below :)",customer:{name:"Demo User",metadata:{page:"nes"}},baseUrl:"https://alex-papercups-staging.herokuapp.com"},ee=u.a.h1(B||(B=Object(s.a)(["\n  margin-bottom: 1em;\n"]))),te=u.a.p(D||(D=Object(s.a)(["\n  margin-bottom: 1.4em;\n"]))),ne=u.a.div(F||(F=Object(s.a)(['\n  background-clip: padding-box;\n  border-image-outset: 2;\n  border-image-repeat: stretch;\n  border-image-slice: 2;\n  border-image-source: url(\'data:image/svg+xml;utf8,<?xml version="1.0" encoding="UTF-8" ?><svg version="1.1" width="5" height="5" xmlns="http://www.w3.org/2000/svg"><path d="M2 1 h1 v1 h-1 z M1 2 h1 v1 h-1 z M3 2 h1 v1 h-1 z M2 3 h1 v1 h-1 z" fill="rgb(33,37,41)" /></svg>\');\n  border-image-width: 2;\n  border-style: solid;\n  border-width: 4px;\n  height: calc(100% - 8px);\n  margin: 4px;\n  padding: 0.5rem;\n  width: calc(100% - 8px);\n  display: flex;\n  flex-direction: column;\n']))),re=u.a.div((function(e){var t=e.isOpen;return{backgroundColor:"#fff",border:"none",bottom:100,height:t?"calc(100% - 120px)":0,margin:0,maxHeight:"704px",maxWidth:"640px",minHeight:t?250:0,opacity:t?1:0,overflow:"hidden",pointerEvents:t?"auto":"none",position:"fixed",right:20,transform:t?"none":"translateY(4px) translateZ(0px)",width:640,zIndex:2147483e3,"@media(max-width: 640px)":{maxHeight:"70%",maxWidth:"90%"}}})),oe=function(){return o.a.createElement("div",null,o.a.createElement("div",{style:{padding:40,width:800,maxWidth:"80%"}},o.a.createElement(ee,null,o.a.createElement("a",{href:"https://github.com/papercups-io/papercups",target:"_blank",rel:"noopener noreferrer"},"Papercups")," ","live demo: NES"),o.a.createElement(te,null,"This is an example of a custom live chat component built on top of the"," ",o.a.createElement("a",{href:"https://github.com/papercups-io/chat-builder",target:"_blank",rel:"noopener noreferrer"},"@papercups-io/chat-builder")," ","library using"," ",o.a.createElement("a",{href:"https://nostalgic-css.github.io/NES.css",target:"_blank",rel:"noopener noreferrer"},"NES.css"),"."),o.a.createElement(te,null,"Try sending us a message in the chat window to the right! One of the maintainers will respond (eventually)."),o.a.createElement(te,null,"The code for this example can be found"," ",o.a.createElement("a",{href:"https://github.com/papercups-io/chat-builder/tree/master/examples/nes",target:"_blank",rel:"noopener noreferrer"},"here"),"."),o.a.createElement(te,null,o.a.createElement("i",{className:"nes-octocat animate"}))),o.a.createElement(H,{config:X},(function(e){var t=e.config,n=e.state,r=e.onSendMessage,a=e.onToggleOpen,i=e.scrollToRef;return o.a.createElement(o.a.Fragment,null,o.a.createElement(re,{isOpen:n.isOpen},o.a.createElement(ne,null,o.a.createElement(Y,null),o.a.createElement(J,{style:{marginTop:"15px",marginBottom:"15px",flexGrow:1,overflowY:"scroll",padding:"1rem"}},o.a.createElement(K,{state:n,scrollToRef:i})),o.a.createElement(J,{style:{padding:"0"}},o.a.createElement($,{config:t,onSendMessage:r})))),o.a.createElement(Q,{state:n,onToggleOpen:a}))})))};i.a.render(o.a.createElement(oe,null),document.getElementById("root"))}},[[19,1,2]]]);
//# sourceMappingURL=main.206ab9fa.chunk.js.map
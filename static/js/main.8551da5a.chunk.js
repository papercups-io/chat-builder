(this["webpackJsonp@papercups-io/chat-builder-ant-example"]=this["webpackJsonp@papercups-io/chat-builder-ant-example"]||[]).push([[0],{16:function(e,t,n){e.exports=n(45)},17:function(e,t,n){},45:function(e,t,n){"use strict";n.r(t);n(17);var r=n(0),o=n.n(r),i=n(13),a=n.n(i),s=n(4),c=n(2),u=n(3),l=n.n(u);function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function f(e,t){return t||(t=e.slice(0)),e.raw=t,e}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var h=function(){return o.a.createElement("div",{style:{display:"flex",margin:8,justifyContent:"center",alignItems:"center"}},o.a.createElement("a",{href:"https://papercups.io?utm_source=papercups&utm_medium=chat&utm_campaign=chat-builder-link",target:"_blank",rel:"noopener noreferrer",style:{color:"gray",opacity:.8,transition:"0.2s"}},"Powered by Papercups"))},m="https://app.papercups.io";function v(){}function y(){var e=new Date;return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds())}var b=function(e,t,n){if(e.addEventListener){for(var r,o=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return g(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,void 0):void 0}}(e))){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}(t);!(r=o()).done;)e.addEventListener(r.value,n);return function(){return t.map((function(t){return e.removeEventListener(t,n)}))}}return console.error("Custom events are not supported in your browser!"),v},w={},S=function(e,t){void 0===t&&(t={});try{return Promise.resolve(l.a.get(e,{params:t}).then((function(e){return e.data.data})))}catch(e){return Promise.reject(e)}},C=function(e,t){void 0===t&&(t={});try{return Promise.resolve(l.a.post(e,t).then((function(e){return e.data.data})))}catch(e){return Promise.reject(e)}},_=function(e,t){void 0===t&&(t={});try{return Promise.resolve(l.a.put(e,t).then((function(e){return e.data.data})))}catch(e){return Promise.reject(e)}},x=function(e,t,n){void 0===t&&(t=w),void 0===n&&(n=m);try{return C(n+"/api/customers",{customer:d({},t,{account_id:e,first_seen:y(),last_seen:y()})})}catch(e){return Promise.reject(e)}},E=function(e,t,n){return void 0===t&&(t=w),void 0===n&&(n=m),_(n+"/api/customers/"+e+"/metadata",{metadata:t})},P=function(){function e(e){this.debugModeEnabled=!!e}var t=e.prototype;return t.debug=function(){var e;this.debugModeEnabled&&(e=console).debug.apply(e,arguments)},t.log=function(){var e;this.debugModeEnabled&&(e=console).log.apply(e,arguments)},t.info=function(){var e;(e=console).info.apply(e,arguments)},t.warn=function(){var e;(e=console).warn.apply(e,arguments)},t.error=function(){var e;(e=console).error.apply(e,arguments)},e}(),I=function(e){return void 0!==e.hidden?{hidden:"hidden",event:"visibilitychange",state:"visibilityState"}:void 0!==e.mozHidden?{hidden:"mozHidden",event:"mozvisibilitychange",state:"mozVisibilityState"}:void 0!==e.msHidden?{hidden:"msHidden",event:"msvisibilitychange",state:"msVisibilityState"}:void 0!==e.webkitHidden?{hidden:"webkitHidden",event:"webkitvisibilitychange",state:"webkitVisibilityState"}:{hidden:null,event:null,state:null}},O=function(e){var t=I(e).hidden;return!!t&&!!e[t]},k=function(e,t){var n=I(e).event;return e.addEventListener(n,t,!1),function(){return e.removeEventListener(n,t)}};function M(e){var t=function(e){var t=Array.prototype,n=Function.prototype,r=Object.prototype,o=r.toString,i=r.hasOwnProperty,a=e.navigator,s=n.bind,c=t.forEach,u=Array.isArray,l=t.slice,d={},f=u||function(e){return"[object Array]"===o.call(e)};function g(e){try{return/^\s*\bfunction\b/.test(e)}catch(e){return!1}}function p(e){return"[object String]"==o.call(e)}function h(e){return void 0===e}function m(e,t,n){if(null!=e)if(c&&e.forEach===c)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,o=e.length;r<o;r++)if(r in e&&t.call(n,e[r],r,e)===d)return}else for(var a in e)if(i.call(e,a)&&t.call(n,e[a],a,e)===d)return}var v,y,b,w,S,C,_,x,E,P,I,O,k=(S={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},C=function(e){var t=new SyntaxError(e);throw t.at=v,t.text=b,t},_=function(e){return e&&e!==y&&C("Expected '"+e+"' instead of '"+y+"'"),y=b.charAt(v),v+=1,y},x=function(){var e,t="";for("-"===y&&(t="-",_("-"));y>="0"&&y<="9";)t+=y,_();if("."===y)for(t+=".";_()&&y>="0"&&y<="9";)t+=y;if("e"===y||"E"===y)for(t+=y,_(),"-"!==y&&"+"!==y||(t+=y,_());y>="0"&&y<="9";)t+=y,_();if(e=+t,isFinite(e))return e;C("Bad number")},E=function(){var e,t,n,r="";if('"'===y)for(;_();){if('"'===y)return _(),r;if("\\"===y)if(_(),"u"===y){for(n=0,t=0;t<4&&(e=parseInt(_(),16),isFinite(e));t+=1)n=16*n+e;r+=String.fromCharCode(n)}else{if("string"!=typeof S[y])break;r+=S[y]}else r+=y}C("Bad string")},P=function(){for(;y&&y<=" ";)_()},I=function(){var e=[];if("["===y){if(_("["),P(),"]"===y)return _("]"),e;for(;y;){if(e.push(w()),P(),"]"===y)return _("]"),e;_(","),P()}}C("Bad array")},O=function(){var e,t={};if("{"===y){if(_("{"),P(),"}"===y)return _("}"),t;for(;y;){if(e=E(),P(),_(":"),Object.hasOwnProperty.call(t,e)&&C('Duplicate key "'+e+'"'),t[e]=w(),P(),"}"===y)return _("}"),t;_(","),P()}}C("Bad object")},w=function(){switch(P(),y){case"{":return O();case"[":return I();case'"':return E();case"-":return x();default:return y>="0"&&y<="9"?x():function(){switch(y){case"t":return _("t"),_("r"),_("u"),_("e"),!0;case"f":return _("f"),_("a"),_("l"),_("s"),_("e"),!1;case"n":return _("n"),_("u"),_("l"),_("l"),null}C('Unexpected "'+y+'"')}()}},function(e){var t;return b=e,v=0,y=" ",t=w(),P(),y&&C("Syntax error"),t});function M(e){var t,n,r,o,i="";for(t=n=0,r=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,o=0;o<r;o++){var a=e.charCodeAt(o),s=null;a<128?n++:s=a>127&&a<2048?String.fromCharCode(a>>6|192,63&a|128):String.fromCharCode(a>>12|224,a>>6&63|128,63&a|128),null!==s&&(n>t&&(i+=e.substring(t,n)),i+=s,t=n=o+1)}return n>t&&(i+=e.substring(t,e.length)),i}return{ArrayProto:t,FuncProto:n,ObjProto:r,toString:o,hasOwnProperty:i,win:e,windowConsole:e.console,navigator:a,document:e.document,windowOpera:e.opera,screen:e.screen,userAgent:a.userAgent,intl:e.Intl,nativeBind:s,nativeForEach:c,nativeIndexOf:t.indexOf,nativeIsArray:u,slice:l,breaker:d,__NOOP:function(){},__NOOPTIONS:{},isFunction:g,isString:p,includes:function(e,t){return-1!==e.indexOf(t)},isUndefined:h,timestamp:function(){return Date.now=Date.now||function(){return+new Date},Date.now()},each:m,trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},extend:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return m(n,(function(t){for(var n in t)void 0!==t[n]&&(e[n]=t[n])})),e},bind:function(e,t){var n,r;if(s&&e.bind===s)return s.apply(e,l.call(arguments,1));if(!g(e))throw new TypeError;return n=l.call(arguments,2),r=function(){if(!(this instanceof r))return e.apply(t,n.concat(l.call(arguments)));var o={};o.prototype=e.prototype;var i=new o;o.prototype=null;var a=e.apply(i,n.concat(l.call(arguments)));return Object(a)===a?a:i}},truncate:function e(t,n){var r;return"string"==typeof t?r=t.slice(0,n):f(t)?(r=[],m(t,(function(t){r.push(e(t,n))}))):function(e){return e===Object(e)&&!f(e)}(t)?(r={},m(t,(function(t,o){r[o]=e(t,n)}))):r=t,r},stripEmptyProperties:function(e){var t={};return m(e,(function(e,n){p(e)&&e.length>0&&(t[n]=e)})),t},HTTPBuildQuery:function(e,t){var n,r,o=[];return h(t)&&(t="&"),m(e,(function(e,t){n=encodeURIComponent(e.toString()),r=encodeURIComponent(t),o[o.length]=r+"="+n})),o.join(t)},JSONEncode:function(e){var t=function(e){var t=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return t.lastIndex=0,t.test(e)?'"'+e.replace(t,(function(e){var t=n[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'};return function e(n,r){var a="",s=0,c="",u="",l=0,d=a,f=[],g=r[n];switch(g&&"object"==typeof g&&"function"==typeof g.toJSON&&(g=g.toJSON(n)),typeof g){case"string":return t(g);case"number":return isFinite(g)?String(g):"null";case"boolean":case"undefined":return String(g);case"object":if(!g)return"null";if(a+="    ",f=[],"[object Array]"===o.apply(g)){for(l=g.length,s=0;s<l;s+=1)f[s]=e(s,g)||"null";return u=0===f.length?"[]":a?"[\n"+a+f.join(",\n"+a)+"\n"+d+"]":"["+f.join(",")+"]",a=d,u}for(c in g)i.call(g,c)&&(u=e(c,g))&&f.push(t(c)+(a?": ":":")+u);return u=0===f.length?"{}":a?"{"+f.join(",")+d+"}":"{"+f.join(",")+"}",a=d,u}}("",{"":e})},JSONDecode:k,utf8Encode:M,base64Encode:function(e){var t,n,r,o,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=0,s=0,c="",u=[];if(!e)return e;e=M(e);do{t=(o=e.charCodeAt(a++)<<16|e.charCodeAt(a++)<<8|e.charCodeAt(a++))>>12&63,n=o>>6&63,r=63&o,u[s++]=i.charAt(o>>18&63)+i.charAt(t)+i.charAt(n)+i.charAt(r)}while(a<e.length);switch(c=u.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c},getQueryParam:function(e,t){t=t.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);if(null===n||n&&"string"!=typeof n[1]&&n[1].length)return"";var r=n[1];try{r=decodeURIComponent(r)}catch(e){console.error("Skipping decoding for malformed query param: "+r)}return r.replace(/\+/g," ")}}}(e),n=t.navigator,r=t.userAgent,o=t.windowOpera,i=t.intl,a=t.each,s=t.extend,c=t.includes,u=t.timestamp,l=t.stripEmptyProperties,d=t.getQueryParam,f={campaignParams:function(){var e="utm_source utm_medium utm_campaign utm_content utm_term".split(" "),t="",n={};return a(e,(function(e){(t=d(document.URL,e)).length&&(n[e]=t)})),n},searchEngine:function(e){return 0===e.search("https?://(.*)google.([^/?]*)")?"google":0===e.search("https?://(.*)bing.com")?"bing":0===e.search("https?://(.*)yahoo.com")?"yahoo":0===e.search("https?://(.*)duckduckgo.com")?"duckduckgo":null},searchInfo:function(e){var t=f.searchEngine(e),n="yahoo"!=t?"q":"p",r={};if(null!==t){r.$search_engine=t;var o=d(e,n);o.length&&(r.ph_keyword=o)}return r},browser:function(e,t,n){return t=t||"",n||c(e," OPR/")?c(e,"Mini")?"Opera Mini":"Opera":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":c(e,"IEMobile")||c(e,"WPDesktop")?"Internet Explorer Mobile":c(e,"SamsungBrowser/")?"Samsung Internet":c(e,"Edge")||c(e,"Edg/")?"Microsoft Edge":c(e,"FBIOS")?"Facebook Mobile":c(e,"Chrome")?"Chrome":c(e,"CriOS")?"Chrome iOS":c(e,"UCWEB")||c(e,"UCBrowser")?"UC Browser":c(e,"FxiOS")?"Firefox iOS":c(t,"Apple")?c(e,"Mobile")?"Mobile Safari":"Safari":c(e,"Android")?"Android Mobile":c(e,"Konqueror")?"Konqueror":c(e,"Firefox")?"Firefox":c(e,"MSIE")||c(e,"Trident/")?"Internet Explorer":c(e,"Gecko")?"Mozilla":""},browserVersion:function(e,t,n){var r={"Internet Explorer Mobile":/rv:(\d+(\.\d+)?)/,"Microsoft Edge":/Edge?\/(\d+(\.\d+)?)/,Chrome:/Chrome\/(\d+(\.\d+)?)/,"Chrome iOS":/CriOS\/(\d+(\.\d+)?)/,"UC Browser":/(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/,Safari:/Version\/(\d+(\.\d+)?)/,"Mobile Safari":/Version\/(\d+(\.\d+)?)/,Opera:/(Opera|OPR)\/(\d+(\.\d+)?)/,Firefox:/Firefox\/(\d+(\.\d+)?)/,"Firefox iOS":/FxiOS\/(\d+(\.\d+)?)/,Konqueror:/Konqueror:(\d+(\.\d+)?)/,BlackBerry:/BlackBerry (\d+(\.\d+)?)/,"Android Mobile":/android\s(\d+(\.\d+)?)/,"Samsung Internet":/SamsungBrowser\/(\d+(\.\d+)?)/,"Internet Explorer":/(rv:|MSIE )(\d+(\.\d+)?)/,Mozilla:/rv:(\d+(\.\d+)?)/}[f.browser(e,t,n)];if(void 0===r)return null;var o=e.match(r);return o?parseFloat(o[o.length-2]):null},os:function(){var e=r;return/Windows/i.test(e)?/Phone/.test(e)||/WPDesktop/.test(e)?"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(e)?"iOS":/Android/.test(e)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Mac/i.test(e)?"Mac OS X":/Linux/.test(e)?"Linux":/CrOS/.test(e)?"Chrome OS":""},device:function(e){return/Windows Phone/i.test(e)||/WPDesktop/.test(e)?"Windows Phone":/iPad/.test(e)?"iPad":/iPod/.test(e)?"iPod Touch":/iPhone/.test(e)?"iPhone":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Android/.test(e)?"Android":""},referringDomain:function(e){var t=e.split("/");return t.length>=3?t[2]:""},timezone:function(e){try{return e.DateTimeFormat().resolvedOptions().timeZone}catch(e){return null}},properties:function(){var t;return s(l({os:f.os(),browser:f.browser(r,n.vendor,o),referrer:document.referrer,referring_domain:f.referringDomain(document.referrer),device:f.device(r),time_zone:f.timezone(i)}),{current_url:e.location.href,host:e.location.host,pathname:e.location.pathname,browser_version:null===(t=f.browserVersion(r,n.vendor,o))||void 0===t?void 0:t.toString(),screen_height:screen.height,screen_width:screen.width,lib:"web",insert_id:Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),time:u()/1e3})}};return f.properties()}function A(){var e=f(["\n  display: flex;\n"]);return A=function(){return e},e}function j(){var e=f([""]);return j=function(){return e},e}var T=c.a.div(j()),U=c.a.div(A()),B=c.a.div((function(e){var t=e.isOpen;return{margin:0,zIndex:2147483e3,position:"fixed",bottom:100,right:20,width:376,maxWidth:["90%","376px"],minHeight:t?250:0,maxHeight:["60%","704px"],background:"#fff",boxShadow:"rgba(0, 0, 0, 0.16) 0px 5px 40px",height:t?"calc(100% - 120px)":0,border:"none",borderRadius:8,overflow:"hidden",transition:"opacity 0.2s ease-in, transform 0.2s ease-in",opacity:t?1:0,transform:t?"none":"translateY(4px) translateZ(0px)",pointerEvents:t?"auto":"none"}})),D=c.a.div((function(e){var t=e.isOpen;return{margin:0,zIndex:2147483e3,position:"fixed",bottom:100,right:20,width:240,maxWidth:["90%","376px"],minHeight:t?250:0,maxHeight:["60%","704px"],background:"transparent",boxShadow:"none",height:t?"calc(100% - 120px)":0,border:"none",borderRadius:8,overflow:"hidden",transition:"opacity 0.2s ease-in, transform 0.2s ease-in",opacity:t?1:0,transform:t?"none":"translateY(4px) translateZ(0px)",pointerEvents:t?"auto":"none"}})),V=c.a.div({position:"fixed",zIndex:2147483003,bottom:20,right:20}),F=function(e){var t,n;function r(t){var n;return(n=e.call(this,t)||this).scrollToEl=null,n.subscriptions=[],n.EVENTS=["papercups:open","papercups:close","papercups:toggle","papercups:identify","storytime:customer:set"],n.fetchWidgetSettings=function(){try{var e=n.props.config,t={};return Promise.resolve(function(e,t){void 0===t&&(t=m);try{return S(t+"/api/widget_settings",{account_id:e})}catch(e){return Promise.reject(e)}}(e.accountId,e.baseUrl).then((function(e){return e||t})).catch((function(){return t})))}catch(e){return Promise.reject(e)}},n.customEventHandlers=function(e){if(!e||!e.type)return null;var t=e.detail;switch(e.type){case"papercups:open":return n.setOpenState(!0);case"papercups:close":return n.setOpenState(!1);case"papercups:toggle":return n.handleToggleOpen();case"storytime:customer:set":return console.warn("No handler has been set up to handle event `storytime:customer:set`",t);default:return null}},n.updateWidgetSettingsMetadata=function(){try{var e=n.props.config,t=e.accountId,r=e.baseUrl,o=M(window);return Promise.resolve(function(e,t,n){void 0===n&&(n=m);try{return _(n+"/api/widget_settings/metadata",{account_id:e,metadata:t})}catch(e){return Promise.reject(e)}}(t,o,r).catch((function(e){n.logger.error("Failed to update widget metadata:",e)})))}catch(e){return Promise.reject(e)}},n.setOpenState=function(e){n.setState({isOpen:e},(function(){n.handleVisibilityChange(),e&&n.scrollIntoView()}))},n.handleToggleOpen=function(){var e=n.state;e.isLoaded&&n.setOpenState(!e.isOpen)},n.handleChatLoaded=function(){n.setState({isLoaded:!0});var e=n.props.onChatLoaded,t=void 0===e?v:e;t&&"function"==typeof t&&t()},n.sendCustomerUpdate=function(e){var t=e.customerId,r=d({},M(window),n.formatCustomerMetadata());return n.updateExistingCustomer(t,r)},n.formatCustomerMetadata=function(){var e=n.props.config.customer,t=void 0===e?{}:e;return t?Object.keys(t).reduce((function(e,n){var r,o;return d({},e,"metadata"===n?((r={})[n]=t[n],r):((o={})[n]=String(t[n]),o))}),{}):{}},n.handleCacheCustomerId=function(e){n.logger.debug("Caching customer ID:",e),window.dispatchEvent(new CustomEvent("papercups:customer:set",{detail:e})),n.storage.setCustomerId(e)},n.handleMessageReceived=function(e){var t=n.props.onMessageReceived,r=void 0===t?v:t;e.user_id&&!e.customer_id&&r&&r(e)},n.handleMessageSent=function(e){var t=n.props.onMessageSent,r=void 0===t?v:t;r&&r(e)},n.handleUnseenMessages=function(e){n.logger.debug("Handling unseen messages:",e),n.setState({shouldDisplayNotifications:!0})},n.handleMessagesSeen=function(){n.logger.debug("Handling messages seen"),n.setState({shouldDisplayNotifications:!1})},n.listenForNewConversations=function(e){var t=n.props.config.customer,r=n.socket.channel("conversation:lobby:"+e,{});r.on("conversation:created",(function(){setTimeout((function(){return n.fetchLatestConversation(e,t)}),1e3)})),r.join().receive("ok",(function(e){n.logger.debug("Successfully listening for new conversations!",e)})).receive("error",(function(e){n.logger.debug("Unable to listen for new conversations!",e)}))},n.listenForAgentAvailability=function(){var e=n.socket.channel("room:"+n.props.config.accountId,{});e.join().receive("ok",(function(e){n.logger.debug("Joined room successfully!",e)})).receive("error",(function(e){n.logger.debug("Unable to join room!",e)}));var t=new s.Presence(e);t.onSync((function(){n.logger.debug("Syncing presence:",t.list()),n.setState({availableAgents:t.list().map((function(e){return e.metas[0]})).filter((function(e){return!!e.user_id}))})}))},n.scrollIntoView=function(){n.scrollToEl&&n.scrollToEl.scrollIntoView(!1)},n.handleVisibilityChange=function(e){var t=document||e&&e.target;if(!O(t)){var r=n.state.messages;(void 0===r?[]:r).some((function(e){return n.shouldMarkAsSeen(e)}))&&n.markMessagesAsSeen()}},n.handlePapercupsPlan=function(e){void 0===e&&(e={}),n.logger.debug("Handling subscription plan:",e),n.setState({shouldDisplayBranding:!0})},n.handleToggleDisplay=function(e){void 0===e&&(e={});var t=!!e.isOpen;n.setState({isOpen:t},(function(){n.handleVisibilityChange(),t&&n.scrollIntoView()}))},n.getDefaultGreeting=function(){var e=n.props.config.greeting;return e?[{type:"bot",customer_id:"bot",body:e,created_at:(new Date).toISOString(),seen_at:(new Date).toISOString()}]:[]},n.isValidCustomer=function(e){try{if(!e||!e.length)return Promise.resolve(!1);if(!((i=e)&&i.length&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)))return Promise.resolve(!1);var t=n.props.config,r=t.baseUrl,o=t.accountId;return Promise.resolve(p((function(){return Promise.resolve(function(e,t,n){void 0===n&&(n=m);try{return S(n+"/api/customers/"+e+"/exists",{account_id:t})}catch(e){return Promise.reject(e)}}(e,o,r))}),(function(){return n.logger.warn("Failed to validate customer ID."),n.logger.warn("You might be on an older version of Papercups."),!0})))}catch(e){return Promise.reject(e)}var i},n.checkForExistingCustomer=function(e,t){try{if(!e||!(null==e?void 0:e.external_id))return n.setState({customerId:t}),Promise.resolve(t);var r=n.props.config;return Promise.resolve(function(e,t,n,r){void 0===r&&(r=m);try{return S(r+"/api/customers/identify",d({},n,{external_id:e,account_id:t}))}catch(e){return Promise.reject(e)}}(e.external_id,r.accountId,{email:e.email,host:e.host},r.baseUrl)).then((function(e){var r=e.customer_id;return r?r===t?(n.setState({customerId:t}),t):(n.setState({customerId:r}),n.handleCacheCustomerId(r),r):(n.setState({customerId:null}),null)}))}catch(e){return Promise.reject(e)}},n.fetchLatestConversation=function(e,t){try{return Promise.resolve(n.checkForExistingCustomer(t,e)).then((function(e){if(e){var r=n.props.config,o=r.accountId,i=r.baseUrl;return n.logger.debug("Fetching conversations for customer:",e),p((function(){return Promise.resolve(function(e,t,n){void 0===n&&(n=m);try{return S(n+"/api/conversations/customer",{customer_id:e,account_id:t})}catch(e){return Promise.reject(e)}}(e,o,i)).then((function(r){if(n.logger.debug("Found existing conversations:",r),!r||!r.length)return n.setState({messages:[].concat(n.getDefaultGreeting())}),void n.listenForNewConversations(e);var o=r[0],i=o.id,a=o.messages,s=(void 0===a?[]:a).sort((function(e,t){return+new Date(e.created_at)-+new Date(t.created_at)}));return n.setState({conversationId:i,messages:[].concat(n.getDefaultGreeting(),s)}),n.joinConversationChannel(i,e),Promise.resolve(n.updateExistingCustomer(e,t)).then((function(){console.log("?",s);var e=s.filter((function(e){return!e.seen_at&&!!e.user_id}));e.length>0&&n.handleUnseenMessages({message:e[0]})}))}))}),(function(e){n.logger.debug("Error fetching conversations!",e)}))}n.setState({messages:[].concat(n.getDefaultGreeting())})}))}catch(e){return Promise.reject(e)}},n.createOrUpdateCustomer=function(e,t,r){try{var o=n.props.config,i=o.baseUrl,a=o.customer,s=r?d({},a,{email:r}):a;return Promise.resolve(p((function(){return Promise.resolve(t?E(t,s,i):x(e,s,i)).then((function(e){var r=e.id;return t||n.handleCacheCustomerId(r),r}))}),(function(t){return n.logger.error("Failed to update or create customer:",t),n.logger.error("Retrying..."),Promise.resolve(x(e,s,i)).then((function(e){var t=e.id;return n.handleCacheCustomerId(t),t}))})))}catch(e){return Promise.reject(e)}},n.updateExistingCustomer=function(e,t){try{if(!t)return Promise.resolve();var r=p((function(){return Promise.resolve(E(e,t,n.props.config.baseUrl)).then((function(){}))}),(function(e){n.logger.debug("Error updating customer metadata!",e)}));return Promise.resolve(r&&r.then?r.then((function(){})):void 0)}catch(e){return Promise.reject(e)}},n.initializeNewConversation=function(e,t){try{var r=n.props.config,o=r.accountId,i=r.baseUrl;return Promise.resolve(n.createOrUpdateCustomer(o,e,t)).then((function(e){return Promise.resolve(function(e,t,n){void 0===n&&(n=m);try{return C(n+"/api/conversations",{conversation:{account_id:e,customer_id:t}})}catch(e){return Promise.reject(e)}}(o,e,i)).then((function(t){var r=t.id;return n.setState({customerId:e,conversationId:r}),n.joinConversationChannel(r,e),{customerId:e,conversationId:r}}))}))}catch(e){return Promise.reject(e)}},n.joinConversationChannel=function(e,t){n.channel&&n.channel.leave&&n.channel.leave(),n.logger.debug("Joining channel:",e),n.channel=n.socket.channel("conversation:"+e,{customer_id:t}),n.channel.on("shout",(function(e){n.handleNewMessage(e)})),n.channel.join().receive("ok",(function(e){n.logger.debug("Joined conversation successfully!",e)})).receive("error",(function(e){n.logger.debug("Unable to join conversation!",e)})),n.sendCustomerUpdate({conversationId:e,customerId:t}),n.scrollIntoView()},n.handleNewMessage=function(e){n.handleMessageReceived(e);var t=n.state.messages,r=void 0===t?[]:t,o=r.find((function(t){return!(t.created_at||(n=t.sent_at,r=e.sent_at,!n||!r||Math.floor(+new Date(n)/1e3)!==Math.floor(+new Date(r)/1e3))||t.body!==e.body&&(t.body||e.body));var n,r})),i=o?r.map((function(t){return t.sent_at===o.sent_at?e:t})):[].concat(r,[e]);n.setState({messages:i},(function(){n.scrollIntoView(),n.shouldMarkAsSeen(e)?n.markMessagesAsSeen():o||n.handleUnseenMessages({message:e})}))},n.shouldMarkAsSeen=function(e){var t=n.state.isOpen,r=!!e.user_id;return!e.seen_at&&!O(document)&&r&&t},n.markMessagesAsSeen=function(){var e=n.state,t=e.messages,r=void 0===t?[]:t;n.channel&&e.customerId&&e.conversationId&&(n.logger.debug("Marking messages as seen!"),n.channel.push("messages:seen",{}),n.handleMessagesSeen(),n.setState({messages:r.map((function(e){return e.seen_at?e:d({},e,{seen_at:(new Date).toISOString()})}))}))},n.handleSendMessage=function(e,t){try{var r=function(){n.channel&&(n.channel.push("shout",d({},e,{body:u,customer_id:n.state.customerId,sent_at:p})),n.handleMessageSent(d({},e,{body:u,type:"customer",sent_at:p,customer_id:n.state.customerId,conversation_id:n.state.conversationId})))},o=n.state,i=o.customerId,a=o.conversationId,s=o.isSending,c=e.body,u=void 0===c?"":c,l=e.file_ids,f=void 0===l?[]:l,g=!u||0===u.trim().length;if(s||g&&(!f||0===f.length))return Promise.resolve();var p=(new Date).toISOString(),h=d({},e,{body:u,customer_id:i,type:"customer",sent_at:p});n.setState({messages:[].concat(n.state.messages,[h])},(function(){return n.scrollIntoView()}));var m=function(){if(!i||!a)return Promise.resolve(n.initializeNewConversation(i,t)).then((function(){}))}();return Promise.resolve(m&&m.then?m.then(r):r())}catch(e){return Promise.reject(e)}},n.state={config:{},messages:[],customerId:null,availableAgents:[],conversationId:null,isLoaded:!1,isSending:!1,isOpen:"function"==typeof t.children||!!t.isOpenByDefault,shouldDisplayNotifications:!1,shouldDisplayBranding:!0},n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.componentDidMount=function(){try{var e=this,t=window,n=document||t.document,r=(i=t,Boolean("localhost"===i.location.hostname||"[::1]"===i.location.hostname||i.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/))||!!e.props.debug);return e.logger=new P(r),e.storage=(o=function(e){try{return e&&(e.localStorage||e.sessionStorage)}catch(e){return{_db:{},getItem:function(e){return this._db[e]||null},setItem:function(e,t){this._db[e]=t},removeItem:function(e){delete this._db[e]}}}}(window),{getCustomerId:function(){return function(e){var t=o.getItem("__PAPERCUPS____CUSTOMER_ID__");if(!t)return null;try{return JSON.parse(t)}catch(e){return t}}()},setCustomerId:function(e){o.setItem("__PAPERCUPS____CUSTOMER_ID__",JSON.stringify(e))},removeCustomerId:function(){o.removeItem("__CUSTOMER_ID__")}}),e.subscriptions=[b(window,e.EVENTS,e.customEventHandlers),k(n,e.handleVisibilityChange)],Promise.resolve(e.loadWidgetSettings()).then((function(t){var n=t.baseUrl,r=t.customerId,o=t.metadata;return Promise.resolve(e.isValidCustomer(r)).then((function(t){var i=t?r:null;e.setState({customerId:i});var a=function(e){var t=(e||m).split("://");return("https"===t[0]?"wss":"ws")+"://"+t[1]+"/socket"}(n);return e.socket=new s.Socket(a),e.socket.connect(),e.listenForAgentAvailability(),Promise.resolve(e.fetchLatestConversation(i,o)).then((function(){e.handleChatLoaded()}))}))}))}catch(e){return Promise.reject(e)}var o,i},i.componentWillUnmount=function(){this.channel&&this.channel.leave(),this.subscriptions.forEach((function(e){"function"==typeof e&&e()}))},i.loadWidgetSettings=function(){try{var e=this;return Promise.resolve(e.fetchWidgetSettings()).then((function(t){var n,r,o=e.props.config,i=o.accountId,a=o.primaryColor,s=o.baseUrl,c=o.title,u=o.subtitle,l=o.greeting,f=o.newMessagePlaceholder,g=o.emailInputPlaceholder,p=o.newMessagesNotificationText,h=o.agentAvailableText,m=o.agentUnavailableText,v=o.showAgentAvailability,y=o.customer,b=void 0===y?{}:y,w=d({},M(window),b),S={accountId:i,baseUrl:s,agentAvailableText:h,agentUnavailableText:m,title:c||t.title,subtitle:u||t.subtitle,primaryColor:a||t.color,greeting:l||t.greeting,newMessagePlaceholder:f||t.new_message_placeholder,emailInputPlaceholder:g||t.email_input_placeholder,newMessagesNotificationText:p||t.new_messages_notification_text,companyName:null==t||null===(n=t.account)||void 0===n?void 0:n.company_name,showAgentAvailability:v||t.show_agent_availability,customerId:e.storage.getCustomerId(),subscriptionPlan:null==t||null===(r=t.account)||void 0===r?void 0:r.subscription_plan,metadata:w};return e.setState({config:S}),Promise.resolve(e.updateWidgetSettingsMetadata()).then((function(){return S}))}))}catch(e){return Promise.reject(e)}},i.renderUnreadMessages=function(){var e=this.props.notifications;if(!e||"function"!=typeof e)return null;var t=this.state,n=t.customerId,r=t.messages,i=(void 0===r?[]:r).filter((function(e){var t=e.body;return!e.seen_at&&!function(e,t){return e.customer_id===t||!!e.sent_at&&"customer"===e.type}(e,n)&&t&&t.trim().length>0})).slice(0,2).map((function(e){var t,n,r=e.body;return d({},e,{body:(t=void 0===r?"":r,void 0===n&&(n=" "),t.length<=140?t:t.substr(0,t.lastIndexOf(n,140)).concat("..."))})}));return 0===i.length?null:o.a.createElement(D,{isOpen:!0},o.a.createElement(U,{style:{background:"transparent",flexDirection:"column",justifyContent:"flex-end",height:"100%",width:"100%",flex:1}},e({config:this.props.config,state:this.state,unread:i,onToggleOpen:this.handleToggleOpen})))},i.render=function(){var e=this,t=this.props,n=t.config,r=t.children,i=this.state,a=i.isOpen,s=i.shouldDisplayNotifications,c=i.shouldDisplayBranding;return r?r({config:n,state:this.state,onClose:this.handleToggleOpen,onToggleOpen:this.handleToggleOpen,onSendMessage:this.handleSendMessage,scrollToRef:function(t){return e.scrollToEl=t}}):o.a.createElement(o.a.Fragment,null,!a&&s&&this.renderUnreadMessages(),o.a.createElement(B,{className:"Papercups-chatWindowContainer",isOpen:a},o.a.createElement(U,{style:{background:"#fff",flexDirection:"column",height:"100%",width:"100%",flex:1}},this.props.header&&this.props.header({config:n,state:this.state,onClose:this.handleToggleOpen}),o.a.createElement(T,{style:{flex:1,overflowY:"scroll"}},this.props.body&&this.props.body({config:n,state:this.state,scrollToRef:function(t){return e.scrollToEl=t}})),c&&o.a.createElement(h,null),this.props.footer&&this.props.footer({config:n,state:this.state,onSendMessage:this.handleSendMessage}),o.a.createElement("img",{alt:"Papercups",src:"https://papercups.s3.us-east-2.amazonaws.com/papercups-logo.svg",width:"0",height:"0"}))),o.a.createElement(V,{className:"Papercups-toggleButtonContainer"},this.props.toggle&&this.props.toggle({config:n,state:this.state,onToggleOpen:this.handleToggleOpen})))},r}(o.a.Component),L=function(e){var t=e.config,n=t.title,r=t.subtitle,i=void 0===r?"How can we help you?":r;return o.a.createElement("div",{style:{padding:"16px",background:"rgb(24, 144, 255)",color:"#fff"}},o.a.createElement("h2",{style:{marginTop:4,marginBottom:8}},void 0===n?"Welcome!":n),o.a.createElement("p",{style:{margin:0}},i))},N=function(e){var t=e.state,n=e.scrollToRef,r=t.customerId,i=t.messages;return o.a.createElement("div",{style:{padding:8}},(void 0===i?[]:i).map((function(e,t){var n=e.customer_id===r||!!e.sent_at&&"customer"===e.type;return o.a.createElement("div",{key:e.id||t,style:{display:"flex",justifyContent:n?"flex-end":"flex-start",margin:8}},o.a.createElement("div",{style:{borderRadius:4,padding:8,background:n?"rgb(24, 144, 255)":"rgb(245, 245, 245)",color:n?"#fff":"rgba(0,0,0,.65)",whiteSpace:"pre-wrap"}},e.body))})),o.a.createElement("div",{key:"scroll-el",ref:n}))},W=function(e){var t=e.onSendMessage,n=o.a.useState(""),r=n[0],i=n[1];return o.a.createElement("div",{style:{padding:8,borderTop:"1px solid rgb(230, 230, 230)",boxShadow:"rgba(0, 0, 0, 0.1) 0px 0px 100px 0px"}},o.a.createElement("form",{onSubmit:function(e){e.preventDefault(),t({body:r}),i("")}},o.a.createElement("input",{style:{border:"none",boxSizing:"border-box",width:"100%",padding:8,outline:0,fontSize:"1em"},value:r,placeholder:"Start typing...",onChange:function(e){return i(e.target.value)}})))},R=c.a.button({outline:"none",border:"none",userSelect:"none",cursor:"pointer",width:"50px",height:"50px",borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center","&:focus":{outline:"none"}}),H=function(){return o.a.createElement("svg",{width:"27",height:"27",viewBox:"0 0 27 27"},o.a.createElement("path",{fill:"transparent",strokeWidth:"3",stroke:"hsl(0, 0%, 99%)",strokeLinecap:"round",opacity:"0",d:"M 7.5 14.5 L 19 14.5"}),o.a.createElement("path",{fill:"transparent",strokeWidth:"3",stroke:"hsl(0, 0%, 99%)",strokeLinecap:"round",opacity:"0",d:"M 7.5 8.5 L 19 8.5"}),o.a.createElement("path",{fill:"transparent",strokeWidth:"3",stroke:"hsl(0, 0%, 99%)",strokeLinecap:"round",d:"M22 21.6453C22 20 23 19.5 23 19.5C23 19.5 25.5 18 25.5 14V9C25.5 4 23 1.5 18 1.5H9C4 1.5 1.5 4 1.5 9V14C1.5 19 4 21 9 21H13.5C14 21 14 21 15 21.5L20.25 24.8572L20.8517 25.2118C21.5184 25.6046 22 25.631 22 24.8572V24.0287V22.7858V21.6453Z",opacity:"1"}))},z=function(){return o.a.createElement("svg",{width:"24",height:"25",viewBox:"0 0 24 25",fill:"none"},o.a.createElement("path",{fill:"transparent",strokeWidth:"3",stroke:"hsl(0, 0%, 99%)",strokeLinecap:"round",opacity:"1",d:"M 5 5 L 20 20"}),o.a.createElement("path",{fill:"transparent",strokeWidth:"3",stroke:"hsl(0, 0%, 99%)",strokeLinecap:"round",opacity:"1",d:"M 5 20 L 20 5"}),o.a.createElement("path",{d:"M20.5 21.1453C20.5 19.5 21.5 19 21.5 19C21.5 19 24 18.5 24 13.5V8.5C24 3.5 21.5 1 16.5 1H7.5C2.5 1 0 3.5 0 8.5V13.5C0 18.5 2.5 20.5 7.5 20.5H12C12.5 20.5 12.5 20.5 13.5 21L18.75 24.3572L19.3517 24.7118C20.0184 25.1046 20.5 25.131 20.5 24.3572V23.5287V22.2858V21.1453Z",fill:"white",fillOpacity:"0.7",opacity:"0"}),o.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.5 18C21.5 18 20.5 18.5 20.5 20.1453V21.2858V22.5287V23.3572C20.5 24.131 20.0184 24.1046 19.3517 23.7118L18.75 23.3572L13.5 20C12.8174 19.6587 12.6007 19.5504 12.3729 19.516C12.267 19.5 12.1587 19.5 12 19.5H7.5C2.5 19.5 0 17.5 0 12.5V7.5C0 2.5 2.5 0 7.5 0H16.5C21.5 0 24 2.5 24 7.5V12.5C24 17.5 21.5 18 21.5 18ZM21 17.557C21.8581 17.557 24 13.557 23 13.057C22.3869 12.7505 21.8801 13.7414 21.4646 14.554C21.2023 15.0668 20.9764 15.5086 20.783 15.5086C20.283 15.5086 20 16.0554 20 16.7568C20 17.4582 20.1419 17.557 21 17.557Z",fill:"white",opacity:"0"}))},J=function(e){return o.a.createElement(R,{style:{background:"rgb(24, 144, 255)"},onClick:e.onToggleOpen},o.a.createElement(e.isOpen?z:H,null))},q={title:"Welcome to Papercups!",subtitle:"Ask us anything in the chat window \ud83d\ude0a",primaryColor:"#1890ff",accountId:"eb504736-0f20-4978-98ff-1a82ae60b266",greeting:"Hi there! How can I help you?",newMessagePlaceholder:"Start typing...",emailInputPlaceholder:"What is your email address?",newMessagesNotificationText:"View new messages",agentAvailableText:"Agents are online!",agentUnavailableText:"Agents are not available at the moment.",customer:{name:"Test User",email:"test@test.com",external_id:"123",metadata:{plan:"starter",registered_at:"2020-09-01",age:25,valid:!0}},baseUrl:"https://alex-papercups-staging.herokuapp.com",requireEmailUpfront:!0,showAgentAvailability:!0,hideToggleButton:!1,defaultIsOpen:!1,iconVariant:"filled"},Z=function(){return o.a.createElement("div",null,o.a.createElement(F,{config:q,header:function(e){var t=e.config,n=e.state,r=e.onClose;return o.a.createElement(L,{config:t,state:n,onClose:r})},body:function(e){var t=e.config,n=e.state,r=e.scrollToRef;return o.a.createElement(N,{config:t,state:n,scrollToRef:r})},footer:function(e){var t=e.config,n=e.state,r=e.onSendMessage;return o.a.createElement(W,{config:t,state:n,onSendMessage:r})},toggle:function(e){var t=e.state,n=e.onToggleOpen,r=t.isOpen;return o.a.createElement(J,{isOpen:r,onToggleOpen:n})}}))};a.a.render(o.a.createElement(Z,null),document.getElementById("root"))}},[[16,1,2]]]);
//# sourceMappingURL=main.8551da5a.chunk.js.map
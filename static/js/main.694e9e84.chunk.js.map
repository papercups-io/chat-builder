{"version":3,"sources":["../../node_modules/babel-plugin-transform-async-to-promises/helpers.js","../../src/components/PapercupsBranding.tsx","../../src/helpers/config.ts","../../src/helpers/utils.ts","../../src/helpers/api.ts","../../src/helpers/logger.ts","../../src/helpers/visibility.ts","../../src/track/info.ts","../../src/track/helpers.ts","../../src/components/ChatBuilder.tsx","../../src/storage.ts","../../src/components/ChatToggle.tsx","Header.tsx","Body.tsx","Footer.tsx","App.tsx","index.tsx"],"names":["_catch","body","recover","result","e","then","Symbol","iterator","asyncIterator","PapercupsBranding","React","style","display","margin","justifyContent","alignItems","href","target","rel","color","opacity","transition","DEFAULT_BASE_URL","noop","now","date","Date","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","setupCustomEventHandlers","w","events","handlers","addEventListener","map","event","removeEventListener","console","error","EMPTY_METADATA","get","url","query","axios","params","res","data","post","put","createNewCustomer","accountId","metadata","baseUrl","customer","account_id","first_seen","last_seen","updateCustomerMetadata","customerId","Logger","debugModeEnabled","this","debug","log","info","warn","getBrowserVisibilityInfo","document","hidden","state","mozHidden","msHidden","webkitHidden","isWindowHidden","addVisibilityEventListener","handler","getUserInfo","win","ArrayProto","Array","prototype","FuncProto","Function","ObjProto","Object","toString","hasOwnProperty","navigator","nativeBind","bind","nativeForEach","forEach","nativeIsArray","isArray","slice","breaker","obj","call","isFunction","f","test","x","isString","isUndefined","each","context","length","i","l","key","at","ch","text","value","escapee","next","number","string","white","array","object","JSONDecode","\"","\\","/","b","n","r","t","m","SyntaxError","c","charAt","isFinite","hex","uffff","parseInt","String","fromCharCode","push","word","source","utf8Encode","start","end","stringl","utftext","replace","c1","charCodeAt","enc","substring","windowConsole","windowOpera","opera","screen","userAgent","intl","Intl","nativeIndexOf","indexOf","__NOOP","__NOOPTIONS","includes","str","needle","timestamp","trim","extend","args","prop","func","bound","apply","arguments","TypeError","concat","ctor","self","truncate","ret","val","stripEmptyProperties","v","k","HTTPBuildQuery","formdata","arg_separator","use_val","use_key","arr","encodeURIComponent","join","JSONEncode","mixed_val","quote","escapable","meta","\b","\t","\n","\f","\r","lastIndex","a","holder","gap","mind","partial","toJSON","base64Encode","h2","h3","h4","bits","b64","ac","tmp_arr","getQueryParam","param","results","RegExp","exec","decodeURIComponent","err","campaignParams","campaign_keywords","split","kw","kwkey","URL","searchEngine","referrer","search","searchInfo","keyword","browser","user_agent","vendor","browserVersion","regex","Internet Explorer Mobile","Microsoft Edge","Chrome","Chrome iOS","UC Browser","Safari","Mobile Safari","Opera","Firefox","Firefox iOS","Konqueror","BlackBerry","Android Mobile","Samsung Internet","Internet Explorer","Mozilla","matches","match","parseFloat","os","device","referringDomain","timezone","DateTimeFormat","resolvedOptions","timeZone","properties","referring_domain","time_zone","current_url","location","host","pathname","browser_version","screen_height","height","screen_width","width","lib","insert_id","Math","random","time","Box","styled","div","Flex","ChatWindowContainer","isOpen","zIndex","position","bottom","right","maxWidth","minHeight","maxHeight","background","boxShadow","border","borderRadius","overflow","transform","pointerEvents","NotificationsContainer","ToggleButtonContainer","ChatBuilder","props","_this","config","empty","API","settings","type","detail","setOpenState","handleToggleOpen","window","logger","setState","handleVisibilityChange","scrollIntoView","isLoaded","onChatLoaded","payload","formatCustomerMetadata","updateExistingCustomer","keys","reduce","acc","dispatchEvent","CustomEvent","storage","setCustomerId","message","onMessageReceived","user_id","customer_id","onMessageSent","shouldDisplayNotifications","channel","socket","on","setTimeout","fetchLatestConversation","receive","room","presence","Presence","onSync","list","availableAgents","metas","filter","scrollToEl","doc","messages","some","msg","shouldMarkAsSeen","markMessagesAsSeen","shouldDisplayBranding","greeting","created_at","toISOString","seen_at","id","defaultCustomerId","external_id","externalId","filters","email","matchingCustomerId","handleCacheCustomerId","cachedCustomerId","checkForExistingCustomer","conversations","getDefaultGreeting","listenForNewConversations","latest","conversationId","formattedMessages","sort","joinConversationChannel","unseenMessages","handleUnseenMessages","existingCustomerId","createOrUpdateCustomer","conversation","leave","handleNewMessage","sendCustomerUpdate","handleMessageReceived","unsent","find","sent_at","y","floor","updated","isAgentMessage","handleMessagesSeen","sentAt","handleMessageSent","conversation_id","isSending","file_ids","isMissingBody","initializeNewConversation","children","isOpenByDefault","componentDidMount","Boolean","hostname","_this3","localStorage","sessionStorage","_db","getItem","setItem","removeItem","getCustomerId","JSON","parse","stringify","removeCustomerId","subscriptions","EVENTS","customEventHandlers","loadWidgetSettings","isValidCustomer","websocketUrl","Socket","connect","listenForAgentAvailability","handleChatLoaded","componentWillUnmount","unsubscribe","fetchWidgetSettings","_this5","primaryColor","title","subtitle","newMessagePlaceholder","emailInputPlaceholder","newMessagesNotificationText","agentAvailableText","agentUnavailableText","showAgentAvailability","new_message_placeholder","email_input_placeholder","new_messages_notification_text","companyName","account","company_name","show_agent_availability","subscriptionPlan","subscription_plan","updateWidgetSettingsMetadata","renderUnreadMessages","notifications","unread","separator","substr","lastIndexOf","flexDirection","flex","onToggleOpen","render","styles","onClose","onSendMessage","handleSendMessage","scrollToRef","el","_this6","Fragment","className","header","overflowY","footer","alt","src","toggle","Component","ToggleButton","button","outline","userSelect","cursor","&:focus","OpenIcon","viewBox","fill","strokeWidth","stroke","strokeLinecap","d","CloseIcon","fillOpacity","fillRule","clipRule","ChatToggle","onClick","theme","HeaderContainer","HeaderTitle","HeaderSubtitle","p","ReplyTimeContainer","ReplyTimeLabel","ReplyTimeValue","ClockSvg","xmlns","alignSelf","marginRight","Header","marginLeft","BodyContainer","CustomerMessage","isNextSameSender","paddingBottom","paddingLeft","paddingRight","fontSize","padding","whiteSpace","AgentMessage","profilePhotoUrl","user","profile_photo_url","shouldDisplayAvatar","left","backgroundPosition","backgroundSize","backgroundImage","Body","grouped","idx","formatted","dayjs","format","groupMessagesByDate","paddingTop","isCustomer","ref","FooterWrapper","FooterContainer","FooterTextarea","textarea","EmojiSvg","top","focusable","aria-hidden","FileSvg","FooterButtonsContainer","FooterButton","Footer","useState","setMessageBody","placeholder","onChange","onKeyDown","preventDefault","name","plan","registered_at","age","valid","App","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.694e9e84.chunk.js","sourcesContent":["// A type of promise-like that resolves synchronously and supports only one observer\nexport const _Pact = /*#__PURE__*/(function() {\n\tfunction _Pact() {}\n\t_Pact.prototype.then = function(onFulfilled, onRejected) {\n\t\tconst result = new _Pact();\n\t\tconst state = this.s;\n\t\tif (state) {\n\t\t\tconst callback = state & 1 ? onFulfilled : onRejected;\n\t\t\tif (callback) {\n\t\t\t\ttry {\n\t\t\t\t\t_settle(result, 1, callback(this.v));\n\t\t\t\t} catch (e) {\n\t\t\t\t\t_settle(result, 2, e);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t} else {\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}\n\t\tthis.o = function(_this) {\n\t\t\ttry {\n\t\t\t\tconst value = _this.v;\n\t\t\t\tif (_this.s & 1) {\n\t\t\t\t\t_settle(result, 1, onFulfilled ? onFulfilled(value) : value);\n\t\t\t\t} else if (onRejected) {\n\t\t\t\t\t_settle(result, 1, onRejected(value));\n\t\t\t\t} else {\n\t\t\t\t\t_settle(result, 2, value);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t_settle(result, 2, e);\n\t\t\t}\n\t\t};\n\t\treturn result;\n\t}\n\treturn _Pact;\n})();\n\n// Settles a pact synchronously\nexport function _settle(pact, state, value) {\n\tif (!pact.s) {\n\t\tif (value instanceof _Pact) {\n\t\t\tif (value.s) {\n\t\t\t\tif (state & 1) {\n\t\t\t\t\tstate = value.s;\n\t\t\t\t}\n\t\t\t\tvalue = value.v;\n\t\t\t} else {\n\t\t\t\tvalue.o = _settle.bind(null, pact, state);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tif (value && value.then) {\n\t\t\tvalue.then(_settle.bind(null, pact, state), _settle.bind(null, pact, 2));\n\t\t\treturn;\n\t\t}\n\t\tpact.s = state;\n\t\tpact.v = value;\n\t\tconst observer = pact.o;\n\t\tif (observer) {\n\t\t\tobserver(pact);\n\t\t}\n\t}\n}\n\nexport function _isSettledPact(thenable) {\n\treturn thenable instanceof _Pact && thenable.s & 1;\n}\n\n// Converts argument to a function that always returns a Promise\nexport function _async(f) {\n\treturn function() {\n\t\tfor (var args = [], i = 0; i < arguments.length; i++) {\n\t\t\targs[i] = arguments[i];\n\t\t}\n\t\ttry {\n\t\t\treturn Promise.resolve(f.apply(this, args));\n\t\t} catch(e) {\n\t\t\treturn Promise.reject(e);\n\t\t}\n\t}\n}\n\n// Awaits on a value that may or may not be a Promise (equivalent to the await keyword in ES2015, with continuations passed explicitly)\nexport function _await(value, then, direct) {\n\tif (direct) {\n\t\treturn then ? then(value) : value;\n\t}\n\tif (!value || !value.then) {\n\t\tvalue = Promise.resolve(value);\n\t}\n\treturn then ? value.then(then) : value;\n}\n\n// Awaits on a value that may or may not be a Promise, then ignores it\nexport function _awaitIgnored(value, direct) {\n\tif (!direct) {\n\t\treturn value && value.then ? value.then(_empty) : Promise.resolve();\n\t}\n}\n\n// Proceeds after a value has resolved, or proceeds immediately if the value is not thenable\nexport function _continue(value, then) {\n\treturn value && value.then ? value.then(then) : then(value);\n}\n\n// Proceeds after a value has resolved, or proceeds immediately if the value is not thenable\nexport function _continueIgnored(value) {\n\tif (value && value.then) {\n\t\treturn value.then(_empty);\n\t}\n}\n\n// Asynchronously iterate through an object that has a length property, passing the index as the first argument to the callback (even as the length property changes)\nexport function _forTo(array, body, check) {\n\tvar i = -1, pact, reject;\n\tfunction _cycle(result) {\n\t\ttry {\n\t\t\twhile (++i < array.length && (!check || !check())) {\n\t\t\t\tresult = body(i);\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.then(_cycle, reject || (reject = _settle.bind(null, pact = new _Pact(), 2)));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (pact) {\n\t\t\t\t_settle(pact, 1, result);\n\t\t\t} else {\n\t\t\t\tpact = result;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t_settle(pact || (pact = new _Pact()), 2, e);\n\t\t}\n\t}\n\t_cycle();\n\treturn pact;\n}\n\n// Asynchronously iterate through an object's properties (including properties inherited from the prototype)\n// Uses a snapshot of the object's properties\nexport function _forIn(target, body, check) {\n\tvar keys = [];\n\tfor (var key in target) {\n\t\tkeys.push(key);\n\t}\n\treturn _forTo(keys, function(i) { return body(keys[i]); }, check);\n}\n\n// Asynchronously iterate through an object's own properties (excluding properties inherited from the prototype)\n// Uses a snapshot of the object's properties\nexport function _forOwn(target, body, check) {\n\tvar keys = [];\n\tfor (var key in target) {\n\t\tif (Object.prototype.hasOwnProperty.call(target, key)) {\n\t\t\tkeys.push(key);\n\t\t}\n\t}\n\treturn _forTo(keys, function(i) { return body(keys[i]); }, check);\n}\n\nexport const _iteratorSymbol = /*#__PURE__*/ typeof Symbol !== \"undefined\" ? (Symbol.iterator || (Symbol.iterator = Symbol(\"Symbol.iterator\"))) : \"@@iterator\";\n\n// Asynchronously iterate through an object's values\n// Uses for...of if the runtime supports it, otherwise iterates until length on a copy\nexport function _forOf(target, body, check) {\n\tif (typeof target[_iteratorSymbol] === \"function\") {\n\t\tvar iterator = target[_iteratorSymbol](), step, pact, reject;\n\t\tfunction _cycle(result) {\n\t\t\ttry {\n\t\t\t\twhile (!(step = iterator.next()).done && (!check || !check())) {\n\t\t\t\t\tresult = body(step.value);\n\t\t\t\t\tif (result && result.then) {\n\t\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult.then(_cycle, reject || (reject = _settle.bind(null, pact = new _Pact(), 2)));\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (pact) {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t} else {\n\t\t\t\t\tpact = result;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t_settle(pact || (pact = new _Pact()), 2, e);\n\t\t\t}\n\t\t}\n\t\t_cycle();\n\t\tif (iterator.return) {\n\t\t\tvar _fixup = function(value) {\n\t\t\t\ttry {\n\t\t\t\t\tif (!step.done) {\n\t\t\t\t\t\titerator.return();\n\t\t\t\t\t}\n\t\t\t\t} catch(e) {\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t}\n\t\t\tif (pact && pact.then) {\n\t\t\t\treturn pact.then(_fixup, function(e) {\n\t\t\t\t\tthrow _fixup(e);\n\t\t\t\t});\n\t\t\t}\n\t\t\t_fixup();\n\t\t}\n\t\treturn pact;\n\t}\n\t// No support for Symbol.iterator\n\tif (!(\"length\" in target)) {\n\t\tthrow new TypeError(\"Object is not iterable\");\n\t}\n\t// Handle live collections properly\n\tvar values = [];\n\tfor (var i = 0; i < target.length; i++) {\n\t\tvalues.push(target[i]);\n\t}\n\treturn _forTo(values, function(i) { return body(values[i]); }, check);\n}\n\nexport const _asyncIteratorSymbol = /*#__PURE__*/ typeof Symbol !== \"undefined\" ? (Symbol.asyncIterator || (Symbol.asyncIterator = Symbol(\"Symbol.asyncIterator\"))) : \"@@asyncIterator\";\n\n// Asynchronously iterate on a value using it's async iterator if present, or its synchronous iterator if missing\nexport function _forAwaitOf(target, body, check) {\n\tif (typeof target[_asyncIteratorSymbol] === \"function\") {\n\t\tvar pact = new _Pact();\n\t\tvar iterator = target[_asyncIteratorSymbol]();\n\t\titerator.next().then(_resumeAfterNext).then(void 0, _reject);\n\t\treturn pact;\n\t\tfunction _resumeAfterBody(result) {\n\t\t\tif (check && check()) {\n\t\t\t\treturn _settle(pact, 1, iterator.return ? iterator.return().then(function() { return result; }) : result);\n\t\t\t}\n\t\t\titerator.next().then(_resumeAfterNext).then(void 0, _reject);\n\t\t}\n\t\tfunction _resumeAfterNext(step) {\n\t\t\tif (step.done) {\n\t\t\t\t_settle(pact, 1);\n\t\t\t} else {\n\t\t\t\tPromise.resolve(body(step.value)).then(_resumeAfterBody).then(void 0, _reject);\n\t\t\t}\n\t\t}\n\t\tfunction _reject(error) {\n\t\t\t_settle(pact, 2, iterator.return ? iterator.return().then(function() { return error; }) : error);\n\t\t}\n\t}\n\treturn Promise.resolve(_forOf(target, function(value) { return Promise.resolve(value).then(body); }, check));\n}\n\n// Asynchronously implement a generic for loop\nexport function _for(test, update, body) {\n\tvar stage;\n\tfor (;;) {\n\t\tvar shouldContinue = test();\n\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\tshouldContinue = shouldContinue.v;\n\t\t}\n\t\tif (!shouldContinue) {\n\t\t\treturn result;\n\t\t}\n\t\tif (shouldContinue.then) {\n\t\t\tstage = 0;\n\t\t\tbreak;\n\t\t}\n\t\tvar result = body();\n\t\tif (result && result.then) {\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.s;\n\t\t\t} else {\n\t\t\t\tstage = 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (update) {\n\t\t\tvar updateValue = update();\n\t\t\tif (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n\t\t\t\tstage = 2;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tvar pact = new _Pact();\n\tvar reject = _settle.bind(null, pact, 2);\n\t(stage === 0 ? shouldContinue.then(_resumeAfterTest) : stage === 1 ? result.then(_resumeAfterBody) : updateValue.then(_resumeAfterUpdate)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterBody(value) {\n\t\tresult = value;\n\t\tdo {\n\t\t\tif (update) {\n\t\t\t\tupdateValue = update();\n\t\t\t\tif (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n\t\t\t\t\tupdateValue.then(_resumeAfterUpdate).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tshouldContinue = test();\n\t\t\tif (!shouldContinue || (_isSettledPact(shouldContinue) && !shouldContinue.v)) {\n\t\t\t\t_settle(pact, 1, result);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.v;\n\t\t\t}\n\t\t} while (!result || !result.then);\n\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t}\n\tfunction _resumeAfterTest(shouldContinue) {\n\t\tif (shouldContinue) {\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t} else {\n\t\t\t\t_resumeAfterBody(result);\n\t\t\t}\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n\tfunction _resumeAfterUpdate() {\n\t\tif (shouldContinue = test()) {\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t} else {\n\t\t\t\t_resumeAfterTest(shouldContinue);\n\t\t\t}\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n}\n\n// Asynchronously implement a do ... while loop\nexport function _do(body, test) {\n\tvar awaitBody;\n\tdo {\n\t\tvar result = body();\n\t\tif (result && result.then) {\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.v;\n\t\t\t} else {\n\t\t\t\tawaitBody = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tvar shouldContinue = test();\n\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\tshouldContinue = shouldContinue.v;\n\t\t}\n\t\tif (!shouldContinue) {\n\t\t\treturn result;\n\t\t}\n\t} while (!shouldContinue.then);\n\tconst pact = new _Pact();\n\tconst reject = _settle.bind(null, pact, 2);\n\t(awaitBody ? result.then(_resumeAfterBody) : shouldContinue.then(_resumeAfterTest)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterBody(value) {\n\t\tresult = value;\n\t\tfor (;;) {\n\t\t\tshouldContinue = test();\n\t\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\t\tshouldContinue = shouldContinue.v;\n\t\t\t}\n\t\t\tif (!shouldContinue) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\tresult = result.v;\n\t\t\t\t} else {\n\t\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t_settle(pact, 1, result);\n\t}\n\tfunction _resumeAfterTest(shouldContinue) {\n\t\tif (shouldContinue) {\n\t\t\tdo {\n\t\t\t\tresult = body();\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tshouldContinue = test();\n\t\t\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\t\t\tshouldContinue = shouldContinue.v;\n\t\t\t\t}\n\t\t\t\tif (!shouldContinue) {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} while (!shouldContinue.then);\n\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n}\n\n// Asynchronously implement a switch statement\nexport function _switch(discriminant, cases) {\n\tvar dispatchIndex = -1;\n\tvar awaitBody;\n\touter: {\n\t\tfor (var i = 0; i < cases.length; i++) {\n\t\t\tvar test = cases[i][0];\n\t\t\tif (test) {\n\t\t\t\tvar testValue = test();\n\t\t\t\tif (testValue && testValue.then) {\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\t\t\t\tif (testValue === discriminant) {\n\t\t\t\t\tdispatchIndex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Found the default case, set it as the pending dispatch case\n\t\t\t\tdispatchIndex = i;\n\t\t\t}\n\t\t}\n\t\tif (dispatchIndex !== -1) {\n\t\t\tdo {\n\t\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\t\twhile (!body) {\n\t\t\t\t\tdispatchIndex++;\n\t\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t\t}\n\t\t\t\tvar result = body();\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tawaitBody = true;\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\t\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\t\tdispatchIndex++;\n\t\t\t} while (fallthroughCheck && !fallthroughCheck());\n\t\t\treturn result;\n\t\t}\n\t}\n\tconst pact = new _Pact();\n\tconst reject = _settle.bind(null, pact, 2);\n\t(awaitBody ? result.then(_resumeAfterBody) : testValue.then(_resumeAfterTest)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterTest(value) {\n\t\tfor (;;) {\n\t\t\tif (value === discriminant) {\n\t\t\t\tdispatchIndex = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (++i === cases.length) {\n\t\t\t\tif (dispatchIndex !== -1) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\ttest = cases[i][0];\n\t\t\tif (test) {\n\t\t\t\tvalue = test();\n\t\t\t\tif (value && value.then) {\n\t\t\t\t\tvalue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdispatchIndex = i;\n\t\t\t}\n\t\t}\n\t\tdo {\n\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\twhile (!body) {\n\t\t\t\tdispatchIndex++;\n\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t}\n\t\t\tvar result = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\tdispatchIndex++;\n\t\t} while (fallthroughCheck && !fallthroughCheck());\n\t\t_settle(pact, 1, result);\n\t}\n\tfunction _resumeAfterBody(result) {\n\t\tfor (;;) {\n\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\tif (!fallthroughCheck || fallthroughCheck()) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdispatchIndex++;\n\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\twhile (!body) {\n\t\t\t\tdispatchIndex++;\n\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t_settle(pact, 1, result);\n\t}\n}\n\n// Asynchronously call a function and pass the result to explicitly passed continuations\nexport function _call(body, then, direct) {\n\tif (direct) {\n\t\treturn then ? then(body()) : body();\n\t}\n\ttry {\n\t\tvar result = Promise.resolve(body());\n\t\treturn then ? result.then(then) : result;\n\t} catch (e) {\n\t\treturn Promise.reject(e);\n\t}\n}\n\n// Asynchronously call a function and swallow the result\nexport function _callIgnored(body, direct) {\n\treturn _call(body, _empty, direct);\n}\n\n// Asynchronously call a function and pass the result to explicitly passed continuations\nexport function _invoke(body, then) {\n\tvar result = body();\n\tif (result && result.then) {\n\t\treturn result.then(then);\n\t}\n\treturn then(result);\n}\n\n// Asynchronously call a function and swallow the result\nexport function _invokeIgnored(body) {\n\tvar result = body();\n\tif (result && result.then) {\n\t\treturn result.then(_empty);\n\t}\n}\n\n// Asynchronously call a function and send errors to recovery continuation\nexport function _catch(body, recover) {\n\ttry {\n\t\tvar result = body();\n\t} catch(e) {\n\t\treturn recover(e);\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(void 0, recover);\n\t}\n\treturn result;\n}\n\n// Asynchronously await a promise and pass the result to a finally continuation\nexport function _finallyRethrows(body, finalizer) {\n\ttry {\n\t\tvar result = body();\n\t} catch (e) {\n\t\treturn finalizer(true, e);\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(finalizer.bind(null, false), finalizer.bind(null, true));\n\t}\n\treturn finalizer(false, result);\n}\n\n// Asynchronously await a promise and invoke a finally continuation that always overrides the result\nexport function _finally(body, finalizer) {\n\ttry {\n\t\tvar result = body();\n\t} catch (e) {\n\t\treturn finalizer();\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(finalizer, finalizer);\n\t}\n\treturn finalizer();\n}\n\n// Rethrow or return a value from a finally continuation\nexport function _rethrow(thrown, value) {\n\tif (thrown)\n\t\tthrow value;\n\treturn value;\n}\n\n// Empty function to implement break and other control flow that ignores asynchronous results\nexport function _empty() {\n}\n\n// Sentinel value for early returns in generators \nexport const _earlyReturn = /*#__PURE__*/ {};\n\n// Asynchronously call a function and send errors to recovery continuation, skipping early returns\nexport function _catchInGenerator(body, recover) {\n\treturn _catch(body, function(e) {\n\t\tif (e === _earlyReturn) {\n\t\t\tthrow e;\n\t\t}\n\t\treturn recover(e);\n\t});\n}\n\n// Asynchronous generator class; accepts the entrypoint of the generator, to which it passes itself when the generator should start\nexport const _AsyncGenerator = /*#__PURE__*/(function() {\n\tfunction _AsyncGenerator(entry) {\n\t\tthis._entry = entry;\n\t\tthis._pact = null;\n\t\tthis._resolve = null;\n\t\tthis._return = null;\n\t\tthis._promise = null;\n\t}\n\n\tfunction _wrapReturnedValue(value) {\n\t\treturn { value: value, done: true };\n\t}\n\tfunction _wrapYieldedValue(value) {\n\t\treturn { value: value, done: false };\n\t}\n\n\t_AsyncGenerator.prototype._yield = function(value) {\n\t\t// Yield the value to the pending next call\n\t\tthis._resolve(value && value.then ? value.then(_wrapYieldedValue) : _wrapYieldedValue(value));\n\t\t// Return a pact for an upcoming next/return/throw call\n\t\treturn this._pact = new _Pact();\n\t};\n\t_AsyncGenerator.prototype.next = function(value) {\n\t\t// Advance the generator, starting it if it has yet to be started\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tconst _entry = _this._entry;\n\t\t\t\tif (_entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the next call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Start the generator\n\t\t\t\t_this._entry = null;\n\t\t\t\t_this._resolve = resolve;\n\t\t\t\tfunction returnValue(value) {\n\t\t\t\t\t_this._resolve(value && value.then ? value.then(_wrapReturnedValue) : _wrapReturnedValue(value));\n\t\t\t\t\t_this._pact = null;\n\t\t\t\t\t_this._resolve = null;\n\t\t\t\t}\n\t\t\t\tvar result = _entry(_this);\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tresult.then(returnValue, function(error) {\n\t\t\t\t\t\tif (error === _earlyReturn) {\n\t\t\t\t\t\t\treturnValue(_this._return);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst pact = new _Pact();\n\t\t\t\t\t\t\t_this._resolve(pact);\n\t\t\t\t\t\t\t_this._pact = null;\n\t\t\t\t\t\t\t_this._resolve = null;\n\t\t\t\t\t\t\t_resolve(pact, 2, error);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturnValue(result);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Generator is started and a yield expression is pending, settle it\n\t\t\t\t_this._pact = null;\n\t\t\t\t_this._resolve = resolve;\n\t\t\t\t_settle(_pact, 1, value);\n\t\t\t}\n\t\t});\n\t};\n\t_AsyncGenerator.prototype.return = function(value) {\n\t\t// Early return from the generator if started, otherwise abandons the generator\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tif (_this._entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the return call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Generator is not started, abandon it and return the specified value\n\t\t\t\t_this._entry = null;\n\t\t\t\treturn resolve(value && value.then ? value.then(_wrapReturnedValue) : _wrapReturnedValue(value));\n\t\t\t}\n\t\t\t// Settle the yield expression with a rejected \"early return\" value\n\t\t\t_this._return = value;\n\t\t\t_this._resolve = resolve;\n\t\t\t_this._pact = null;\n\t\t\t_settle(_pact, 2, _earlyReturn);\n\t\t});\n\t};\n\t_AsyncGenerator.prototype.throw = function(error) {\n\t\t// Inject an exception into the pending yield expression\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve, reject) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tif (_this._entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the throw call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Generator is not started, abandon it and return a rejected Promise containing the error\n\t\t\t\t_this._entry = null;\n\t\t\t\treturn reject(error);\n\t\t\t}\n\t\t\t// Settle the yield expression with the value as a rejection\n\t\t\t_this._resolve = resolve;\n\t\t\t_this._pact = null;\n\t\t\t_settle(_pact, 2, error);\n\t\t});\n\t};\n\n\t_AsyncGenerator.prototype[_asyncIteratorSymbol] = function() {\n\t\treturn this;\n\t};\n\t\n\treturn _AsyncGenerator;\n})();\n","import React from 'react';\n\nconst PapercupsBranding = () => {\n  return (\n    <div\n      style={{\n        display: 'flex',\n        margin: 8,\n        justifyContent: 'center',\n        alignItems: 'center',\n      }}\n    >\n      <a\n        href='https://papercups.io?utm_source=papercups&utm_medium=chat&utm_campaign=chat-builder-link'\n        target='_blank'\n        rel='noopener noreferrer'\n        style={{\n          color: 'gray',\n          opacity: 0.8,\n          transition: '0.2s',\n        }}\n      >\n        Powered by Papercups\n      </a>\n    </div>\n  );\n};\n\nexport default PapercupsBranding;\n","export const DEFAULT_BASE_URL = 'https://app.papercups.io';\n\nexport const isDev = (w: any) => {\n  return Boolean(\n    w.location.hostname === 'localhost' ||\n      // [::1] is the IPv6 localhost address.\n      w.location.hostname === '[::1]' ||\n      // 127.0.0.0/8 are considered localhost for IPv4.\n      w.location.hostname.match(\n        /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n      )\n  );\n};\n\nexport const getWebsocketUrl = (baseUrl?: string) => {\n  // TODO: handle this parsing better\n  const url = baseUrl || DEFAULT_BASE_URL;\n  const [protocol, host] = url.split('://');\n  const isHttps = protocol === 'https';\n\n  // TODO: not sure how websockets work with subdomains\n  return `${isHttps ? 'wss' : 'ws'}://${host}/socket`;\n};\n","import {Message} from './types';\n\nexport function noop() {}\n\n// TODO: handle this on the server instead\nexport function now() {\n  const date = new Date();\n\n  return new Date(\n    date.getUTCFullYear(),\n    date.getUTCMonth(),\n    date.getUTCDate(),\n    date.getUTCHours(),\n    date.getUTCMinutes(),\n    date.getUTCSeconds()\n  );\n}\n\nexport function sleep(ms: number) {\n  return new Promise((res) => setTimeout(res, ms));\n}\n\n// Returns the words (or whatever substrings based on the `separator`)\n// in a string up until the point of meeting the`max` character limit\nexport function shorten(str: string, max: number, separator = ' ') {\n  if (str.length <= max) {\n    return str;\n  }\n\n  return str.substr(0, str.lastIndexOf(separator, max)).concat('...');\n}\n\nexport function shouldActivateGameMode(message?: string) {\n  if (!message || !message.length) {\n    return false;\n  }\n\n  return (\n    [\n      '/play2048',\n      '/xyzzy',\n      '/poweroverwhelming',\n      '/howdoyouturnthison',\n      'what is 2^11',\n      'what is 2^11?',\n      \"what's 2^11\",\n      \"what's 2^11?\",\n    ].indexOf(message.toLowerCase()) !== -1\n  );\n}\n\nexport function setupPostMessageHandlers(w: any, handler: (msg: any) => void) {\n  const cb = (msg: any) => {\n    handler(msg);\n  };\n\n  if (w.addEventListener) {\n    w.addEventListener('message', cb);\n\n    return () => w.removeEventListener('message', cb);\n  } else {\n    w.attachEvent('onmessage', cb);\n\n    return () => w.detachEvent('message', cb);\n  }\n}\n\nexport const setupCustomEventHandlers = (\n  w: any,\n  events: Array<string>,\n  handlers: (e: any) => void\n) => {\n  if (w.addEventListener) {\n    for (const event of events) {\n      w.addEventListener(event, handlers);\n    }\n\n    return () => events.map((event) => w.removeEventListener(event, handlers));\n  } else {\n    console.error('Custom events are not supported in your browser!');\n\n    return noop;\n  }\n};\n\nexport const isCustomerMessage = (\n  message: Message,\n  customerId?: string | null\n): boolean => {\n  return (\n    message.customer_id === customerId ||\n    (!!message.sent_at && message.type === 'customer')\n  );\n};\n\nexport const areDatesEqual = (x?: string, y?: string) => {\n  if (!x || !y) {\n    return false;\n  }\n\n  return Math.floor(+new Date(x) / 1000) === Math.floor(+new Date(y) / 1000);\n};\n\nexport const isValidUuid = (id: any) => {\n  if (!id || !id.length) {\n    return false;\n  }\n\n  const regex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\n\n  return regex.test(id);\n};\n","// import superagent from 'superagent';\nimport axios from 'axios';\nimport {DEFAULT_BASE_URL} from './config';\nimport {now} from './utils';\nimport {CustomerMetadata, WidgetSettings} from './types';\n\nconst EMPTY_METADATA = {} as CustomerMetadata;\n\nconst get = async (url: string, query = {}) => {\n  return axios.get(url, {params: query}).then((res) => res.data.data);\n};\n\nconst post = async (url: string, params = {}) => {\n  return axios.post(url, params).then((res) => res.data.data);\n};\n\nconst put = async (url: string, params = {}) => {\n  return axios.put(url, params).then((res) => res.data.data);\n};\n\nexport const fetchWidgetSettings = async (\n  accountId: string,\n  baseUrl = DEFAULT_BASE_URL\n): Promise<WidgetSettings> => {\n  // return superagent\n  //   .get(`${baseUrl}/api/widget_settings`)\n  //   .query({account_id: accountId})\n  //   .then((res) => res.body.data);\n\n  return get(`${baseUrl}/api/widget_settings`, {account_id: accountId});\n};\n\nexport const updateWidgetSettingsMetadata = async (\n  accountId: string,\n  metadata: any,\n  baseUrl = DEFAULT_BASE_URL\n): Promise<WidgetSettings> => {\n  // return superagent\n  //   .put(`${baseUrl}/api/widget_settings/metadata`)\n  //   .send({account_id: accountId, metadata})\n  //   .then((res) => res.body.data);\n\n  return put(`${baseUrl}/api/widget_settings/metadata`, {\n    account_id: accountId,\n    metadata,\n  });\n};\n\nexport const createNewCustomer = async (\n  accountId: string,\n  metadata: Partial<CustomerMetadata> = EMPTY_METADATA,\n  baseUrl = DEFAULT_BASE_URL\n) => {\n  // return superagent\n  //   .post(`${baseUrl}/api/customers`)\n  //   .send({\n  //     customer: {\n  //       ...metadata,\n  //       account_id: accountId,\n  //       // TODO: handle on the server instead?\n  //       first_seen: now(),\n  //       last_seen: now(),\n  //     },\n  //   })\n  //   .then((res) => res.body.data);\n\n  return post(`${baseUrl}/api/customers`, {\n    customer: {\n      ...metadata,\n      account_id: accountId,\n      // TODO: handle on the server instead?\n      first_seen: now(),\n      last_seen: now(),\n    },\n  });\n};\n\nexport const isValidCustomer = async (\n  customerId: string,\n  accountId: string,\n  baseUrl = DEFAULT_BASE_URL\n) => {\n  // return superagent\n  //   .get(`${baseUrl}/api/customers/${customerId}/exists`)\n  //   .query({\n  //     account_id: accountId,\n  //   })\n  //   .then((res) => res.body.data);\n\n  return get(`${baseUrl}/api/customers/${customerId}/exists`, {\n    account_id: accountId,\n  });\n};\n\nexport const updateCustomerMetadata = async (\n  customerId: string,\n  metadata: Partial<CustomerMetadata> = EMPTY_METADATA,\n  baseUrl = DEFAULT_BASE_URL\n) => {\n  // return superagent\n  //   .put(`${baseUrl}/api/customers/${customerId}/metadata`)\n  //   .send({\n  //     metadata,\n  //   })\n  //   .then((res) => res.body.data);\n\n  return put(`${baseUrl}/api/customers/${customerId}/metadata`, {metadata});\n};\n\nexport const createNewConversation = async (\n  accountId: string,\n  customerId: string,\n  baseUrl = DEFAULT_BASE_URL\n) => {\n  // return superagent\n  //   .post(`${baseUrl}/api/conversations`)\n  //   .send({\n  //     conversation: {\n  //       account_id: accountId,\n  //       customer_id: customerId,\n  //     },\n  //   })\n  //   .then((res) => res.body.data);\n\n  return post(`${baseUrl}/api/conversations`, {\n    conversation: {\n      account_id: accountId,\n      customer_id: customerId,\n    },\n  });\n};\n\nexport const findCustomerByExternalId = async (\n  externalId: string,\n  accountId: string,\n  filters: Record<string, any>,\n  baseUrl = DEFAULT_BASE_URL\n) => {\n  // return superagent\n  //   .get(`${baseUrl}/api/customers/identify`)\n  //   .query({...filters, external_id: externalId, account_id: accountId})\n  //   .then((res) => res.body.data);\n\n  return get(`${baseUrl}/api/customers/identify`, {\n    ...filters,\n    external_id: externalId,\n    account_id: accountId,\n  });\n};\n\nexport const fetchCustomerConversations = async (\n  customerId: string,\n  accountId: string,\n  baseUrl = DEFAULT_BASE_URL\n) => {\n  // return superagent\n  // .get(`${baseUrl}/api/conversations/customer`)\n  // .query({customer_id: customerId, account_id: accountId})\n  // .then((res) => res.body.data);\n\n  return get(`${baseUrl}/api/conversations/customer`, {\n    customer_id: customerId,\n    account_id: accountId,\n  });\n};\n\nexport const upload = async (\n  accountId: string,\n  file: any,\n  baseUrl = DEFAULT_BASE_URL\n) => {\n  // return superagent\n  //   .post(`${baseUrl}/api/upload`)\n  //   .send({\n  //     file,\n  //     account_id: accountId,\n  //   })\n  //   .then((res) => res.body.data);\n\n  return post(`${baseUrl}/api/upload`, {\n    file,\n    account_id: accountId,\n  });\n};\n","class Logger {\n  debugModeEnabled: boolean;\n\n  constructor(debugModeEnabled?: boolean) {\n    this.debugModeEnabled = !!debugModeEnabled;\n  }\n\n  debug(...args: any) {\n    if (!this.debugModeEnabled) {\n      return;\n    }\n\n    console.debug(...args);\n  }\n\n  log(...args: any) {\n    if (!this.debugModeEnabled) {\n      return;\n    }\n\n    console.log(...args);\n  }\n\n  info(...args: any) {\n    console.info(...args);\n  }\n\n  warn(...args: any) {\n    console.warn(...args);\n  }\n\n  error(...args: any) {\n    console.error(...args);\n  }\n}\n\nexport default Logger;\n","export const getBrowserVisibilityInfo = (document: any) => {\n  if (typeof document.hidden !== 'undefined') {\n    return {\n      hidden: 'hidden',\n      event: 'visibilitychange',\n      state: 'visibilityState',\n    };\n  } else if (typeof document.mozHidden !== 'undefined') {\n    return {\n      hidden: 'mozHidden',\n      event: 'mozvisibilitychange',\n      state: 'mozVisibilityState',\n    };\n  } else if (typeof document.msHidden !== 'undefined') {\n    return {\n      hidden: 'msHidden',\n      event: 'msvisibilitychange',\n      state: 'msVisibilityState',\n    };\n  } else if (typeof document.webkitHidden !== 'undefined') {\n    return {\n      hidden: 'webkitHidden',\n      event: 'webkitvisibilitychange',\n      state: 'webkitVisibilityState',\n    };\n  } else {\n    return {\n      hidden: null,\n      event: null,\n      state: null,\n    };\n  }\n};\n\nexport const isWindowHidden = (document: any): boolean => {\n  const {hidden} = getBrowserVisibilityInfo(document);\n\n  if (!hidden) {\n    return false;\n  }\n\n  return !!document[hidden];\n};\n\nexport const addVisibilityEventListener = (\n  document: any,\n  handler: (e: any) => void\n) => {\n  const {event} = getBrowserVisibilityInfo(document);\n\n  document.addEventListener(event, handler, false);\n\n  return () => document.removeEventListener(event, handler);\n};\n","import {helpers} from './helpers';\n\nexport function getUserInfo(win: any) {\n  const {\n    navigator,\n    userAgent,\n    windowOpera,\n    intl,\n    each,\n    extend,\n    includes,\n    timestamp,\n    stripEmptyProperties,\n    getQueryParam,\n  } = helpers(win);\n\n  // Mostly borrowed from:\n  // https://github.com/PostHog/posthog-js/blob/dbfac85a2808626e3c1780013a9075d5c9fd0971/src/utils.js#L1433\n  const info = {\n    campaignParams: function () {\n      const campaign_keywords = 'utm_source utm_medium utm_campaign utm_content utm_term'.split(\n        ' '\n      );\n      let kw = '';\n      let params: any = {};\n\n      each(campaign_keywords, function (kwkey: string) {\n        kw = getQueryParam(document.URL, kwkey);\n\n        if (kw.length) {\n          params[kwkey] = kw;\n        }\n      });\n\n      return params;\n    },\n\n    searchEngine: function (referrer: any) {\n      if (referrer.search('https?://(.*)google.([^/?]*)') === 0) {\n        return 'google';\n      } else if (referrer.search('https?://(.*)bing.com') === 0) {\n        return 'bing';\n      } else if (referrer.search('https?://(.*)yahoo.com') === 0) {\n        return 'yahoo';\n      } else if (referrer.search('https?://(.*)duckduckgo.com') === 0) {\n        return 'duckduckgo';\n      } else {\n        return null;\n      }\n    },\n\n    searchInfo: function (referrer: any) {\n      let search = info.searchEngine(referrer);\n      let param = search != 'yahoo' ? 'q' : 'p';\n      let ret: any = {};\n\n      if (search !== null) {\n        ret['$search_engine'] = search;\n\n        var keyword = getQueryParam(referrer, param);\n        if (keyword.length) {\n          ret['ph_keyword'] = keyword;\n        }\n      }\n\n      return ret;\n    },\n\n    /**\n     * This function detects which browser is running this script.\n     * The order of the checks are important since many user agents\n     * include key words used in later checks.\n     */\n    browser: function (user_agent: any, vendor: any, opera: any) {\n      vendor = vendor || ''; // vendor is undefined for at least IE9\n      if (opera || includes(user_agent, ' OPR/')) {\n        if (includes(user_agent, 'Mini')) {\n          return 'Opera Mini';\n        }\n        return 'Opera';\n      } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n        return 'BlackBerry';\n      } else if (\n        includes(user_agent, 'IEMobile') ||\n        includes(user_agent, 'WPDesktop')\n      ) {\n        return 'Internet Explorer Mobile';\n      } else if (includes(user_agent, 'SamsungBrowser/')) {\n        // https://developer.samsung.com/internet/user-agent-string-format\n        return 'Samsung Internet';\n      } else if (includes(user_agent, 'Edge') || includes(user_agent, 'Edg/')) {\n        return 'Microsoft Edge';\n      } else if (includes(user_agent, 'FBIOS')) {\n        return 'Facebook Mobile';\n      } else if (includes(user_agent, 'Chrome')) {\n        return 'Chrome';\n      } else if (includes(user_agent, 'CriOS')) {\n        return 'Chrome iOS';\n      } else if (\n        includes(user_agent, 'UCWEB') ||\n        includes(user_agent, 'UCBrowser')\n      ) {\n        return 'UC Browser';\n      } else if (includes(user_agent, 'FxiOS')) {\n        return 'Firefox iOS';\n      } else if (includes(vendor, 'Apple')) {\n        if (includes(user_agent, 'Mobile')) {\n          return 'Mobile Safari';\n        }\n        return 'Safari';\n      } else if (includes(user_agent, 'Android')) {\n        return 'Android Mobile';\n      } else if (includes(user_agent, 'Konqueror')) {\n        return 'Konqueror';\n      } else if (includes(user_agent, 'Firefox')) {\n        return 'Firefox';\n      } else if (\n        includes(user_agent, 'MSIE') ||\n        includes(user_agent, 'Trident/')\n      ) {\n        return 'Internet Explorer';\n      } else if (includes(user_agent, 'Gecko')) {\n        return 'Mozilla';\n      } else {\n        return '';\n      }\n    },\n\n    /**\n     * This function detects which browser version is running this script,\n     * parsing major and minor version (e.g., 42.1). User agent strings from:\n     * http://www.useragentstring.com/pages/useragentstring.php\n     */\n    browserVersion: function (userAgent: any, vendor: any, opera: any) {\n      const browser = info.browser(userAgent, vendor, opera);\n      const versionRegexs: {[key: string]: RegExp} = {\n        'Internet Explorer Mobile': /rv:(\\d+(\\.\\d+)?)/,\n        'Microsoft Edge': /Edge?\\/(\\d+(\\.\\d+)?)/,\n        Chrome: /Chrome\\/(\\d+(\\.\\d+)?)/,\n        'Chrome iOS': /CriOS\\/(\\d+(\\.\\d+)?)/,\n        'UC Browser': /(UCBrowser|UCWEB)\\/(\\d+(\\.\\d+)?)/,\n        Safari: /Version\\/(\\d+(\\.\\d+)?)/,\n        'Mobile Safari': /Version\\/(\\d+(\\.\\d+)?)/,\n        Opera: /(Opera|OPR)\\/(\\d+(\\.\\d+)?)/,\n        Firefox: /Firefox\\/(\\d+(\\.\\d+)?)/,\n        'Firefox iOS': /FxiOS\\/(\\d+(\\.\\d+)?)/,\n        Konqueror: /Konqueror:(\\d+(\\.\\d+)?)/,\n        BlackBerry: /BlackBerry (\\d+(\\.\\d+)?)/,\n        'Android Mobile': /android\\s(\\d+(\\.\\d+)?)/,\n        'Samsung Internet': /SamsungBrowser\\/(\\d+(\\.\\d+)?)/,\n        'Internet Explorer': /(rv:|MSIE )(\\d+(\\.\\d+)?)/,\n        Mozilla: /rv:(\\d+(\\.\\d+)?)/,\n      };\n      const regex = versionRegexs[browser];\n      if (regex === undefined) {\n        return null;\n      }\n      const matches = userAgent.match(regex);\n      if (!matches) {\n        return null;\n      }\n\n      return parseFloat(matches[matches.length - 2]);\n    },\n\n    os: function () {\n      const a = userAgent;\n      if (/Windows/i.test(a)) {\n        if (/Phone/.test(a) || /WPDesktop/.test(a)) {\n          return 'Windows Phone';\n        }\n        return 'Windows';\n      } else if (/(iPhone|iPad|iPod)/.test(a)) {\n        return 'iOS';\n      } else if (/Android/.test(a)) {\n        return 'Android';\n      } else if (/(BlackBerry|PlayBook|BB10)/i.test(a)) {\n        return 'BlackBerry';\n      } else if (/Mac/i.test(a)) {\n        return 'Mac OS X';\n      } else if (/Linux/.test(a)) {\n        return 'Linux';\n      } else if (/CrOS/.test(a)) {\n        return 'Chrome OS';\n      } else {\n        return '';\n      }\n    },\n\n    device: function (user_agent: any) {\n      if (/Windows Phone/i.test(user_agent) || /WPDesktop/.test(user_agent)) {\n        return 'Windows Phone';\n      } else if (/iPad/.test(user_agent)) {\n        return 'iPad';\n      } else if (/iPod/.test(user_agent)) {\n        return 'iPod Touch';\n      } else if (/iPhone/.test(user_agent)) {\n        return 'iPhone';\n      } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n        return 'BlackBerry';\n      } else if (/Android/.test(user_agent)) {\n        return 'Android';\n      } else {\n        return '';\n      }\n    },\n\n    referringDomain: function (referrer: string) {\n      const split = referrer.split('/');\n      if (split.length >= 3) {\n        return split[2];\n      }\n      return '';\n    },\n\n    timezone: function (intl: any) {\n      try {\n        return intl.DateTimeFormat().resolvedOptions().timeZone;\n      } catch (e) {\n        return null;\n      }\n    },\n\n    properties: function () {\n      return extend(\n        stripEmptyProperties({\n          os: info.os(),\n          browser: info.browser(userAgent, navigator.vendor, windowOpera),\n          referrer: document.referrer,\n          referring_domain: info.referringDomain(document.referrer),\n          device: info.device(userAgent),\n          time_zone: info.timezone(intl),\n        }),\n        {\n          current_url: win.location.href,\n          host: win.location.host,\n          pathname: win.location.pathname,\n          browser_version: info\n            .browserVersion(userAgent, navigator.vendor, windowOpera)\n            ?.toString(),\n          screen_height: screen.height,\n          screen_width: screen.width,\n          lib: 'web',\n          insert_id:\n            Math.random().toString(36).substring(2, 10) +\n            Math.random().toString(36).substring(2, 10),\n          time: timestamp() / 1000, // epoch time in seconds\n        }\n      );\n    },\n  };\n\n  return info.properties();\n}\n","export const helpers = (win: any) => {\n  const ArrayProto = Array.prototype;\n  const FuncProto = Function.prototype;\n  const ObjProto = Object.prototype;\n  const toString = ObjProto.toString;\n  const hasOwnProperty = ObjProto.hasOwnProperty;\n  const windowConsole = win.console;\n  const navigator = win.navigator;\n  const document = win.document;\n  const windowOpera = (win as any).opera;\n  const screen = win.screen;\n  const userAgent = navigator.userAgent;\n  const intl = win.Intl;\n\n  const nativeBind = FuncProto.bind;\n  const nativeForEach = ArrayProto.forEach;\n  const nativeIndexOf = ArrayProto.indexOf;\n  const nativeIsArray = Array.isArray;\n  const slice = ArrayProto.slice;\n  const breaker = {};\n\n  const __NOOP = function () {};\n  const __NOOPTIONS = {};\n\n  const isArray =\n    nativeIsArray ||\n    function (obj: any) {\n      return toString.call(obj) === '[object Array]';\n    };\n\n  function isObject(obj: any) {\n    return obj === Object(obj) && !isArray(obj);\n  }\n\n  function isFunction(f: any) {\n    try {\n      return /^\\s*\\bfunction\\b/.test(f);\n    } catch (x) {\n      return false;\n    }\n  }\n\n  function isString(obj: any) {\n    return toString.call(obj) == '[object String]';\n  }\n\n  function includes(str: any, needle: any) {\n    return str.indexOf(needle) !== -1;\n  }\n\n  function isUndefined(obj: any) {\n    return obj === void 0;\n  }\n\n  function timestamp() {\n    Date.now =\n      Date.now ||\n      function () {\n        return +new Date();\n      };\n\n    return Date.now();\n  }\n\n  function each(obj: any, iterator: any, context?: any) {\n    if (obj === null || obj === undefined) {\n      return;\n    }\n    if (nativeForEach && obj.forEach === nativeForEach) {\n      obj.forEach(iterator, context);\n    } else if (obj.length === +obj.length) {\n      for (var i = 0, l = obj.length; i < l; i++) {\n        if (i in obj && iterator.call(context, obj[i], i, obj) === breaker) {\n          return;\n        }\n      }\n    } else {\n      for (var key in obj) {\n        if (hasOwnProperty.call(obj, key)) {\n          if (iterator.call(context, obj[key], key, obj) === breaker) {\n            return;\n          }\n        }\n      }\n    }\n  }\n\n  function trim(str: string) {\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim#Polyfill\n    return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n  }\n\n  function extend(obj: any, ...args: Array<any>) {\n    each(args, function (source: any) {\n      for (let prop in source) {\n        if (source[prop] !== void 0) {\n          obj[prop] = source[prop];\n        }\n      }\n    });\n\n    return obj;\n  }\n\n  function bind(func: any, context: any) {\n    let args: any;\n    let bound: any;\n\n    if (nativeBind && func.bind === nativeBind) {\n      return nativeBind.apply(func, slice.call(arguments, 1));\n    }\n    if (!isFunction(func)) {\n      throw new TypeError();\n    }\n    args = slice.call(arguments, 2);\n    bound = function () {\n      if (!(this instanceof bound)) {\n        return func.apply(context, args.concat(slice.call(arguments)));\n      }\n      let ctor: any = {};\n      ctor.prototype = func.prototype;\n      let self = new ctor();\n      ctor.prototype = null;\n      let result = func.apply(self, args.concat(slice.call(arguments)));\n      if (Object(result) === result) {\n        return result;\n      }\n      return self;\n    };\n    return bound;\n  }\n\n  function truncate(obj: any, length: number) {\n    let ret: any;\n\n    if (typeof obj === 'string') {\n      ret = obj.slice(0, length);\n    } else if (isArray(obj)) {\n      ret = [];\n      each(obj, function (val: any) {\n        ret.push(truncate(val, length));\n      });\n    } else if (isObject(obj)) {\n      ret = {};\n      each(obj, function (val: any, key: string) {\n        ret[key] = truncate(val, length);\n      });\n    } else {\n      ret = obj;\n    }\n\n    return ret;\n  }\n\n  function stripEmptyProperties(obj: any) {\n    let ret: any = {};\n\n    each(obj, function (v: any, k: string) {\n      if (isString(v) && v.length > 0) {\n        ret[k] = v;\n      }\n    });\n\n    return ret;\n  }\n\n  function HTTPBuildQuery(formdata: any, arg_separator?: any) {\n    let use_val;\n    let use_key;\n    let arr: Array<any> = [];\n\n    if (isUndefined(arg_separator)) {\n      arg_separator = '&';\n    }\n\n    each(formdata, function (val: any, key: string) {\n      use_val = encodeURIComponent(val.toString());\n      use_key = encodeURIComponent(key);\n      arr[arr.length] = use_key + '=' + use_val;\n    });\n\n    return arr.join(arg_separator);\n  }\n\n  const JSONEncode = (function () {\n    return function (mixed_val: any) {\n      var value = mixed_val;\n      var quote = function (string: string) {\n        var escapable = /[\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g; // eslint-disable-line no-control-regex\n        var meta: any = {\n          // table of character substitutions\n          '\\b': '\\\\b',\n          '\\t': '\\\\t',\n          '\\n': '\\\\n',\n          '\\f': '\\\\f',\n          '\\r': '\\\\r',\n          '\"': '\\\\\"',\n          '\\\\': '\\\\\\\\',\n        };\n\n        escapable.lastIndex = 0;\n        return escapable.test(string)\n          ? '\"' +\n              string.replace(escapable, function (a) {\n                var c = meta[a];\n                return typeof c === 'string'\n                  ? c\n                  : '\\\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n              }) +\n              '\"'\n          : '\"' + string + '\"';\n      };\n\n      var str = function (key: any, holder: any) {\n        let gap = '';\n        let indent = '    ';\n        let i = 0; // The loop counter.\n        let k = ''; // The member key.\n        let v: any = ''; // The member value.\n        let length = 0;\n        let mind = gap;\n        let partial = [];\n        let value = holder[key];\n\n        // If the value has a toJSON method, call it to obtain a replacement value.\n        if (\n          value &&\n          typeof value === 'object' &&\n          typeof value.toJSON === 'function'\n        ) {\n          value = value.toJSON(key);\n        }\n\n        // What happens next depends on the value's type.\n        switch (typeof value) {\n          case 'string':\n            return quote(value);\n\n          case 'number':\n            // JSON numbers must be finite. Encode non-finite numbers as null.\n            return isFinite(value) ? String(value) : 'null';\n          case 'boolean':\n          case 'undefined':\n            // case 'null':\n            // If the value is a boolean or null, convert it to a string. Note:\n            // typeof null does not produce 'null'. The case is included here in\n            // the remote chance that this gets fixed someday.\n\n            return String(value);\n          case 'object':\n            // If the type is 'object', we might be dealing with an object or an array or\n            // null.\n            // Due to a specification blunder in ECMAScript, typeof null is 'object',\n            // so watch out for that case.\n            if (!value) {\n              return 'null';\n            }\n\n            // Make an array to hold the partial results of stringifying this object value.\n            gap += indent;\n            partial = [];\n\n            // Is the value an array?\n            if (toString.apply(value) === '[object Array]') {\n              // The value is an array. Stringify every element. Use null as a placeholder\n              // for non-JSON values.\n\n              length = value.length;\n              for (i = 0; i < length; i += 1) {\n                partial[i] = str(i, value) || 'null';\n              }\n\n              // Join all of the elements together, separated with commas, and wrap them in\n              // brackets.\n              v =\n                partial.length === 0\n                  ? '[]'\n                  : gap\n                  ? '[\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + ']'\n                  : '[' + partial.join(',') + ']';\n              gap = mind;\n              return v;\n            }\n\n            // Iterate through all of the keys in the object.\n            for (k in value) {\n              if (hasOwnProperty.call(value, k)) {\n                v = str(k, value);\n                if (v) {\n                  partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                }\n              }\n            }\n\n            // Join all of the member texts together, separated with commas,\n            // and wrap them in braces.\n            v =\n              partial.length === 0\n                ? '{}'\n                : gap\n                ? '{' + partial.join(',') + '' + mind + '}'\n                : '{' + partial.join(',') + '}';\n            gap = mind;\n            return v;\n        }\n      };\n\n      // Make a fake root object containing our value under the key of ''.\n      // Return the result of stringifying the value.\n      return str('', {\n        '': value,\n      });\n    };\n  })();\n\n  const JSONDecode = (function () {\n    let at: any; // The index of the current character\n    let ch: any; // The current character\n    let escapee: any = {\n      '\"': '\"',\n      '\\\\': '\\\\',\n      '/': '/',\n      b: '\\b',\n      f: '\\f',\n      n: '\\n',\n      r: '\\r',\n      t: '\\t',\n    };\n    let text: string;\n    let error = function (m: string) {\n      var e: any = new SyntaxError(m);\n      e.at = at;\n      e.text = text;\n      throw e;\n    };\n    let next = function (c?: any) {\n      // If a c parameter is provided, verify that it matches the current character.\n      if (c && c !== ch) {\n        error(\"Expected '\" + c + \"' instead of '\" + ch + \"'\");\n      }\n      // Get the next character. When there are no more characters,\n      // return the empty string.\n      ch = text.charAt(at);\n      at += 1;\n      return ch;\n    };\n    let number = function () {\n      // Parse a number value.\n      var number,\n        string = '';\n\n      if (ch === '-') {\n        string = '-';\n        next('-');\n      }\n      while (ch >= '0' && ch <= '9') {\n        string += ch;\n        next();\n      }\n      if (ch === '.') {\n        string += '.';\n        while (next() && ch >= '0' && ch <= '9') {\n          string += ch;\n        }\n      }\n      if (ch === 'e' || ch === 'E') {\n        string += ch;\n        next();\n        if (ch === '-' || ch === '+') {\n          string += ch;\n          next();\n        }\n        while (ch >= '0' && ch <= '9') {\n          string += ch;\n          next();\n        }\n      }\n      number = +string;\n      if (!isFinite(number)) {\n        error('Bad number');\n      } else {\n        return number;\n      }\n    };\n    let string = function () {\n      // Parse a string value.\n      let hex;\n      let i;\n      let string = '';\n      let uffff;\n\n      // When parsing for string values, we must look for \" and \\ characters.\n      if (ch === '\"') {\n        while (next()) {\n          if (ch === '\"') {\n            next();\n            return string;\n          }\n          if (ch === '\\\\') {\n            next();\n            if (ch === 'u') {\n              uffff = 0;\n              for (i = 0; i < 4; i += 1) {\n                hex = parseInt(next(), 16);\n                if (!isFinite(hex)) {\n                  break;\n                }\n                uffff = uffff * 16 + hex;\n              }\n              string += String.fromCharCode(uffff);\n            } else if (typeof escapee[ch] === 'string') {\n              string += escapee[ch];\n            } else {\n              break;\n            }\n          } else {\n            string += ch;\n          }\n        }\n      }\n      error('Bad string');\n    };\n    let white = function () {\n      // Skip whitespace.\n      while (ch && ch <= ' ') {\n        next();\n      }\n    };\n    let word = function () {\n      // true, false, or null.\n      switch (ch) {\n        case 't':\n          next('t');\n          next('r');\n          next('u');\n          next('e');\n          return true;\n        case 'f':\n          next('f');\n          next('a');\n          next('l');\n          next('s');\n          next('e');\n          return false;\n        case 'n':\n          next('n');\n          next('u');\n          next('l');\n          next('l');\n          return null;\n      }\n      error('Unexpected \"' + ch + '\"');\n    };\n    let value: any; // Placeholder for the value function.\n    let array = function () {\n      // Parse an array value.\n      var array: Array<any> = [];\n\n      if (ch === '[') {\n        next('[');\n        white();\n        if (ch === ']') {\n          next(']');\n          return array; // empty array\n        }\n        while (ch) {\n          array.push(value());\n          white();\n          if (ch === ']') {\n            next(']');\n            return array;\n          }\n          next(',');\n          white();\n        }\n      }\n      error('Bad array');\n    };\n    let object = function () {\n      // Parse an object value.\n      let key: any;\n      let object: any = {};\n\n      if (ch === '{') {\n        next('{');\n        white();\n        if (ch === '}') {\n          next('}');\n          return object; // empty object\n        }\n        while (ch) {\n          key = string();\n          white();\n          next(':');\n          if (Object.hasOwnProperty.call(object, key)) {\n            error('Duplicate key \"' + key + '\"');\n          }\n          object[key] = value();\n          white();\n          if (ch === '}') {\n            next('}');\n            return object;\n          }\n          next(',');\n          white();\n        }\n      }\n      error('Bad object');\n    };\n\n    value = function () {\n      // Parse a JSON value. It could be an object, an array, a string,\n      // a number, or a word.\n      white();\n      switch (ch) {\n        case '{':\n          return object();\n        case '[':\n          return array();\n        case '\"':\n          return string();\n        case '-':\n          return number();\n        default:\n          return ch >= '0' && ch <= '9' ? number() : word();\n      }\n    };\n\n    // Return the json_parse function. It will have access to all of the\n    // above functions and variables.\n    return function (source: any) {\n      var result;\n\n      text = source;\n      at = 0;\n      ch = ' ';\n      result = value();\n      white();\n      if (ch) {\n        error('Syntax error');\n      }\n\n      return result;\n    };\n  })();\n\n  function utf8Encode(string: string) {\n    string = (string + '').replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n\n    var utftext = '',\n      start,\n      end;\n    var stringl = 0,\n      n;\n\n    start = end = 0;\n    stringl = string.length;\n\n    for (n = 0; n < stringl; n++) {\n      var c1 = string.charCodeAt(n);\n      var enc = null;\n\n      if (c1 < 128) {\n        end++;\n      } else if (c1 > 127 && c1 < 2048) {\n        enc = String.fromCharCode((c1 >> 6) | 192, (c1 & 63) | 128);\n      } else {\n        enc = String.fromCharCode(\n          (c1 >> 12) | 224,\n          ((c1 >> 6) & 63) | 128,\n          (c1 & 63) | 128\n        );\n      }\n      if (enc !== null) {\n        if (end > start) {\n          utftext += string.substring(start, end);\n        }\n        utftext += enc;\n        start = end = n + 1;\n      }\n    }\n\n    if (end > start) {\n      utftext += string.substring(start, string.length);\n    }\n\n    return utftext;\n  }\n\n  function base64Encode(data: any) {\n    var b64 =\n      'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n    var o1,\n      o2,\n      o3,\n      h1,\n      h2,\n      h3,\n      h4,\n      bits,\n      i = 0,\n      ac = 0,\n      enc = '',\n      tmp_arr = [];\n\n    if (!data) {\n      return data;\n    }\n\n    data = utf8Encode(data);\n\n    do {\n      // pack three octets into four hexets\n      o1 = data.charCodeAt(i++);\n      o2 = data.charCodeAt(i++);\n      o3 = data.charCodeAt(i++);\n\n      bits = (o1 << 16) | (o2 << 8) | o3;\n\n      h1 = (bits >> 18) & 0x3f;\n      h2 = (bits >> 12) & 0x3f;\n      h3 = (bits >> 6) & 0x3f;\n      h4 = bits & 0x3f;\n\n      // use hexets to index into b64, and append result to encoded string\n      tmp_arr[ac++] =\n        b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n    } while (i < data.length);\n\n    enc = tmp_arr.join('');\n\n    switch (data.length % 3) {\n      case 1:\n        enc = enc.slice(0, -2) + '==';\n        break;\n      case 2:\n        enc = enc.slice(0, -1) + '=';\n        break;\n    }\n\n    return enc;\n  }\n\n  function getQueryParam(url: string, param: string) {\n    // Expects a raw URL\n    param = param.replace(/[[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n\n    const regexS = '[\\\\?&]' + param + '=([^&#]*)';\n    const regex = new RegExp(regexS);\n    const results = regex.exec(url);\n\n    if (\n      results === null ||\n      (results && typeof results[1] !== 'string' && (results[1] as any).length)\n    ) {\n      return '';\n    } else {\n      var result = results[1];\n      try {\n        result = decodeURIComponent(result);\n      } catch (err) {\n        console.error('Skipping decoding for malformed query param: ' + result);\n      }\n      return result.replace(/\\+/g, ' ');\n    }\n  }\n\n  return {\n    ArrayProto,\n    FuncProto,\n    ObjProto,\n    toString,\n    hasOwnProperty,\n    win,\n    windowConsole,\n    navigator,\n    document,\n    windowOpera,\n    screen,\n    userAgent,\n    intl,\n    nativeBind,\n    nativeForEach,\n    nativeIndexOf,\n    nativeIsArray,\n    slice,\n    breaker,\n    __NOOP,\n    __NOOPTIONS,\n    isFunction,\n    isString,\n    includes,\n    isUndefined,\n    timestamp,\n    each,\n    trim,\n    extend,\n    bind,\n    truncate,\n    stripEmptyProperties,\n    HTTPBuildQuery,\n    JSONEncode,\n    JSONDecode,\n    utf8Encode,\n    base64Encode,\n    getQueryParam,\n  };\n};\n","import React from 'react';\nimport {Socket, Presence} from 'phoenix';\nimport styled from '@emotion/styled';\nimport PapercupsBranding from './PapercupsBranding';\nimport * as API from '../helpers/api';\nimport {\n  noop,\n  areDatesEqual,\n  isValidUuid,\n  isCustomerMessage,\n  shorten,\n  setupCustomEventHandlers,\n} from '../helpers/utils';\nimport {\n  CustomerMetadata,\n  Message,\n  WidgetConfig,\n  WidgetSettings,\n} from '../helpers/types';\nimport {isDev, getWebsocketUrl} from '../helpers/config';\nimport Logger from '../helpers/logger';\nimport {\n  addVisibilityEventListener,\n  isWindowHidden,\n} from '../helpers/visibility';\nimport store from '../storage';\nimport {getUserInfo} from '../track/info';\n\nconst Box = styled.div``;\n\nconst Flex = styled.div`\n  display: flex;\n`;\n\nconst ChatWindowContainer = styled.div(({isOpen}: {isOpen?: boolean}) => ({\n  margin: 0,\n  zIndex: 2147483000,\n  position: 'fixed',\n  bottom: 100,\n  right: 20,\n  width: 376,\n  maxWidth: ['90%', '376px'],\n  minHeight: isOpen ? 250 : 0,\n  maxHeight: ['60%', '704px'],\n  background: '#fff',\n  boxShadow: 'rgba(0, 0, 0, 0.16) 0px 5px 40px',\n  height: isOpen ? 'calc(100% - 120px)' : 0,\n  border: 'none',\n  borderRadius: 8,\n  overflow: 'hidden',\n  transition: 'opacity 0.2s ease-in, transform 0.2s ease-in',\n  opacity: isOpen ? 1 : 0,\n  transform: isOpen ? 'none' : 'translateY(4px) translateZ(0px)',\n  pointerEvents: isOpen ? 'auto' : 'none',\n}));\n\nconst NotificationsContainer = styled.div(({isOpen}: {isOpen?: boolean}) => ({\n  margin: 0,\n  zIndex: 2147483000,\n  position: 'fixed',\n  bottom: 100,\n  right: 20,\n  width: 240,\n  maxWidth: ['90%', '376px'],\n  minHeight: isOpen ? 250 : 0,\n  maxHeight: ['60%', '704px'],\n  background: 'transparent',\n  boxShadow: 'none',\n  height: isOpen ? 'calc(100% - 120px)' : 0,\n  border: 'none',\n  borderRadius: 8,\n  overflow: 'hidden',\n  transition: 'opacity 0.2s ease-in, transform 0.2s ease-in',\n  opacity: isOpen ? 1 : 0,\n  transform: isOpen ? 'none' : 'translateY(4px) translateZ(0px)',\n  pointerEvents: isOpen ? 'auto' : 'none',\n}));\n\nconst ToggleButtonContainer = styled.div({\n  position: 'fixed',\n  zIndex: 2147483003,\n  bottom: 20,\n  right: 20,\n});\n\nexport type Config = {\n  accountId: string;\n  customerId?: string;\n  primaryColor?: string;\n  title?: string;\n  subtitle?: string;\n  baseUrl?: string;\n  greeting?: string;\n  newMessagePlaceholder?: string;\n  emailInputPlaceholder?: string;\n  newMessagesNotificationText?: string;\n  shouldRequireEmail?: boolean;\n  isMobile?: boolean;\n  customer?: CustomerMetadata;\n  companyName?: string;\n  agentAvailableText?: string;\n  agentUnavailableText?: string;\n  showAgentAvailability?: boolean;\n  isCloseable?: boolean;\n};\n\nexport interface Options {\n  config: Config;\n  state: State;\n}\n\nexport type OnSendMessage = (\n  message: Partial<Message>,\n  email?: string\n) => Promise<any>;\nexport type ScrollToRef = (el: any) => void;\nexport type HeaderProps = Options & {onClose: () => void};\nexport type BodyProps = Options & {scrollToRef: ScrollToRef};\nexport type FooterProps = Options & {\n  onSendMessage: OnSendMessage;\n};\nexport type ToggleButtonProps = Options & {onToggleOpen: () => void};\nexport type NotificationsProps = Options & {\n  unread: Array<Message>;\n  onToggleOpen: () => void;\n};\n\nexport type ChildrenProps = Options & {\n  onClose: () => void;\n  onSendMessage: OnSendMessage;\n  onToggleOpen: () => void;\n  scrollToRef: ScrollToRef;\n};\n\ntype Props = {\n  config: Config;\n  debug?: boolean;\n  isOpenByDefault?: boolean;\n  styles?: {\n    header?: Record<string, any>;\n    body?: Record<string, any>;\n    footer?: Record<string, any>;\n  };\n  // TODO: figure out what type this should be\n  children?: (options: ChildrenProps) => React.ReactElement;\n  // UI components\n  header?: (options: HeaderProps) => React.ReactElement;\n  body?: (options: BodyProps) => React.ReactElement;\n  footer?: (options: FooterProps) => React.ReactElement;\n  toggle?: (options: ToggleButtonProps) => React.ReactElement;\n  notifications?: (options: NotificationsProps) => React.ReactElement;\n  // callbacks\n  onChatLoaded?: () => void;\n  onChatOpened?: () => void;\n  onChatClosed?: () => void;\n  onMessageSent?: (message: Message) => void;\n  onMessageReceived?: (message: Message) => void;\n};\n\nexport type State = {\n  config: WidgetConfig;\n  messages: Array<Message>;\n  customerId?: string | null;\n  conversationId: string | null;\n  availableAgents: Array<any>;\n  isLoaded: boolean;\n  isSending: boolean;\n  isOpen: boolean;\n  shouldDisplayNotifications: boolean;\n  shouldDisplayBranding: boolean;\n};\n\nclass ChatBuilder extends React.Component<Props, State> {\n  scrollToEl: any = null;\n\n  socket: any;\n  channel: any;\n  logger: Logger;\n  storage: any;\n  subscriptions: Array<() => void> = [];\n\n  EVENTS = [\n    'papercups:open',\n    'papercups:close',\n    'papercups:toggle',\n    'papercups:identify',\n    'storytime:customer:set',\n  ];\n\n  constructor(props: Props) {\n    super(props);\n\n    const {children, isOpenByDefault} = props;\n    const isOpen = typeof children === 'function' || !!isOpenByDefault;\n\n    this.state = {\n      config: {} as WidgetConfig,\n      messages: [],\n      // TODO: figure out how to determine these, either by IP or localStorage\n      // (eventually we will probably use cookies for this)\n      // TODO: remove this from state if possible, just use props instead?\n      customerId: null,\n      availableAgents: [],\n      conversationId: null,\n      isLoaded: false,\n      isSending: false,\n      isOpen: isOpen,\n      shouldDisplayNotifications: false,\n      shouldDisplayBranding: true,\n    };\n  }\n\n  async componentDidMount() {\n    const win = window as any;\n    const doc = (document || win.document) as any;\n    const debugModeEnabled = isDev(win) || !!this.props.debug;\n\n    this.logger = new Logger(debugModeEnabled);\n    this.storage = store(window);\n    this.subscriptions = [\n      setupCustomEventHandlers(window, this.EVENTS, this.customEventHandlers),\n      addVisibilityEventListener(doc, this.handleVisibilityChange),\n    ];\n\n    const config = await this.loadWidgetSettings();\n    const {baseUrl, customerId: cachedCustomerId, metadata} = config;\n    const isValidCustomer = await this.isValidCustomer(cachedCustomerId);\n    const customerId = isValidCustomer ? cachedCustomerId : null;\n\n    this.setState({customerId});\n\n    const websocketUrl = getWebsocketUrl(baseUrl);\n\n    this.socket = new Socket(websocketUrl);\n    this.socket.connect();\n    this.listenForAgentAvailability();\n\n    await this.fetchLatestConversation(customerId, metadata);\n\n    this.handleChatLoaded();\n  }\n\n  componentWillUnmount() {\n    this.channel && this.channel.leave();\n    this.subscriptions.forEach((unsubscribe) => {\n      if (typeof unsubscribe === 'function') {\n        unsubscribe();\n      }\n    });\n  }\n\n  async loadWidgetSettings() {\n    // TODO: use `subscription_plan` from settings.account to determine\n    // whether to display the Papercups branding or not in the chat window\n    const settings = await this.fetchWidgetSettings();\n    const {\n      accountId,\n      primaryColor,\n      baseUrl,\n      title,\n      subtitle,\n      greeting,\n      newMessagePlaceholder,\n      emailInputPlaceholder,\n      newMessagesNotificationText,\n      agentAvailableText,\n      agentUnavailableText,\n      showAgentAvailability,\n      // requireEmailUpfront,\n      // canToggle,\n      customer = {},\n    } = this.props.config;\n\n    const metadata = {...getUserInfo(window), ...customer};\n    const config: WidgetConfig = {\n      accountId,\n      baseUrl,\n      agentAvailableText,\n      agentUnavailableText,\n      title: title || settings.title,\n      subtitle: subtitle || settings.subtitle,\n      primaryColor: primaryColor || settings.color,\n      greeting: greeting || settings.greeting,\n      newMessagePlaceholder:\n        newMessagePlaceholder || settings.new_message_placeholder,\n      emailInputPlaceholder:\n        emailInputPlaceholder || settings.email_input_placeholder,\n      newMessagesNotificationText:\n        newMessagesNotificationText || settings.new_messages_notification_text,\n      companyName: settings?.account?.company_name,\n      // requireEmailUpfront: requireEmailUpfront ? 1 : 0,\n      showAgentAvailability:\n        showAgentAvailability || settings.show_agent_availability,\n      // closeable: canToggle ? 1 : 0,\n      customerId: this.storage.getCustomerId(),\n      subscriptionPlan: settings?.account?.subscription_plan,\n      metadata: metadata,\n    };\n\n    this.setState({config});\n\n    // Set some metadata on the widget to better understand usage\n    await this.updateWidgetSettingsMetadata();\n\n    return config;\n  }\n\n  fetchWidgetSettings = async (): Promise<WidgetSettings> => {\n    const {accountId, baseUrl} = this.props.config;\n    const empty = {} as WidgetSettings;\n\n    return API.fetchWidgetSettings(accountId, baseUrl)\n      .then((settings) => settings || empty)\n      .catch(() => empty);\n  };\n\n  customEventHandlers = (event: any) => {\n    if (!event || !event.type) {\n      return null;\n    }\n\n    const {type, detail} = event;\n\n    switch (type) {\n      case 'papercups:open':\n        return this.setOpenState(true);\n      case 'papercups:close':\n        return this.setOpenState(false);\n      case 'papercups:toggle':\n        return this.handleToggleOpen();\n      case 'storytime:customer:set':\n        return console.warn(\n          'No handler has been set up to handle event `storytime:customer:set`',\n          detail\n        );\n      default:\n        return null;\n    }\n  };\n\n  updateWidgetSettingsMetadata = async () => {\n    const {accountId, baseUrl} = this.props.config;\n    const metadata = getUserInfo(window);\n\n    return API.updateWidgetSettingsMetadata(accountId, metadata, baseUrl).catch(\n      (err) => {\n        // No need to block on this\n        this.logger.error('Failed to update widget metadata:', err);\n      }\n    );\n  };\n\n  setOpenState = (isOpen: boolean) => {\n    // TODO: execute toggle callbacks\n    // TODO: scroll to ref?\n    this.setState({isOpen}, () => {\n      this.handleVisibilityChange();\n\n      if (isOpen) {\n        this.scrollIntoView();\n      }\n    });\n  };\n\n  handleToggleOpen = () => {\n    const {isOpen: wasOpen, isLoaded} = this.state;\n    const isOpen = !wasOpen;\n\n    // Prevent opening the widget until everything has loaded\n    if (!isLoaded) {\n      return;\n    }\n\n    this.setOpenState(isOpen);\n  };\n\n  // // TODO: just use the functions themselves, rather than emitting events\n  // emit = (event: string, payload?: any) => {\n  //   switch (event) {\n  //     case 'chat:loaded':\n  //       return this.handleChatLoaded();\n  //     case 'customer:created':\n  //     case 'customer:updated':\n  //       return this.handleCacheCustomerId(payload);\n  //     case 'conversation:join':\n  //       return this.sendCustomerUpdate(payload);\n  //     case 'message:received':\n  //       return this.handleMessageReceived(payload);\n  //     case 'message:sent':\n  //       return this.handleMessageSent(payload);\n  //     case 'messages:unseen':\n  //       return this.handleUnseenMessages(payload);\n  //     case 'messages:seen':\n  //       return this.handleMessagesSeen();\n  //     case 'papercups:open':\n  //     case 'papercups:close':\n  //       return this.handleToggleOpen();\n  //     default:\n  //       return null;\n  //   }\n  // };\n\n  handleChatLoaded = () => {\n    this.setState({isLoaded: true});\n    // const {config = {} as WidgetConfig} = this.state;\n    const {onChatLoaded = noop} = this.props;\n\n    if (onChatLoaded && typeof onChatLoaded === 'function') {\n      onChatLoaded();\n    }\n\n    // if (defaultIsOpen || !canToggle) {\n    //   this.setState({isOpen: true}, () => this.emitToggleEvent(true));\n    // }\n\n    // this.send('papercups:plan', {plan: subscriptionPlan});\n  };\n\n  sendCustomerUpdate = (payload: any) => {\n    const {customerId} = payload;\n    const customerBrowserInfo = getUserInfo(window);\n    const metadata = {...customerBrowserInfo, ...this.formatCustomerMetadata()};\n\n    return this.updateExistingCustomer(customerId, metadata);\n  };\n\n  formatCustomerMetadata = () => {\n    const {customer = {}} = this.props.config;\n\n    if (!customer) {\n      return {};\n    }\n\n    return Object.keys(customer).reduce((acc, key) => {\n      if (key === 'metadata') {\n        return {...acc, [key]: customer[key]};\n      } else {\n        // Make sure all other passed-in values are strings\n        return {...acc, [key]: String(customer[key])};\n      }\n    }, {});\n  };\n\n  handleCacheCustomerId = (customerId: string) => {\n    // Let other modules know that the customer has been set\n    this.logger.debug('Caching customer ID:', customerId);\n    window.dispatchEvent(\n      new CustomEvent('papercups:customer:set', {\n        detail: customerId,\n      })\n    );\n    this.storage.setCustomerId(customerId);\n  };\n\n  handleMessageReceived = (message: Message) => {\n    const {onMessageReceived = noop} = this.props;\n    const {user_id: userId, customer_id: customerId} = message;\n    const isFromAgent = !!userId && !customerId;\n    // Only invoke callback if message is from agent, because we currently track\n    // `message:received` events to know if a message went through successfully\n    if (isFromAgent) {\n      onMessageReceived && onMessageReceived(message);\n    }\n  };\n\n  handleMessageSent = (message: Message) => {\n    const {onMessageSent = noop} = this.props;\n\n    onMessageSent && onMessageSent(message);\n  };\n\n  handleUnseenMessages = (payload: any) => {\n    this.logger.debug('Handling unseen messages:', payload);\n    this.setState({shouldDisplayNotifications: true});\n    // this.send('notifications:display', {shouldDisplayNotifications: true});\n  };\n\n  handleMessagesSeen = () => {\n    this.logger.debug('Handling messages seen');\n    this.setState({shouldDisplayNotifications: false});\n    // this.send('notifications:display', {shouldDisplayNotifications: false});\n  };\n\n  // postMessageHandlers = (msg: any) => {\n  //   const {event, payload = {}} = msg.data;\n  //   this.logger.debug('Handling in iframe:', msg.data);\n\n  //   switch (event) {\n  //     case 'customer:update':\n  //       const {customerId, metadata} = payload;\n\n  //       return this.updateExistingCustomer(customerId, metadata);\n  //     case 'notifications:display':\n  //       return this.setState({\n  //         // // shouldDisplayNotifications: !!payload.shouldDisplayNotifications,\n  //       });\n  //     case 'papercups:toggle':\n  //       return this.handleToggleDisplay(payload);\n  //     case 'papercups:plan':\n  //       return this.handlePapercupsPlan(payload);\n  //     case 'papercups:ping':\n  //       return this.logger.debug('Pong!');\n  //     default:\n  //       return null;\n  //   }\n  // };\n\n  listenForNewConversations = (customerId: string) => {\n    const {customer: metadata} = this.props.config;\n\n    const channel = this.socket.channel(`conversation:lobby:${customerId}`, {});\n\n    channel.on('conversation:created', () => {\n      // TODO: clean this up a bit?\n      // TODO: remove timeout when issue is fixed\n      setTimeout(\n        () => this.fetchLatestConversation(customerId, metadata),\n        1000\n      );\n    });\n\n    channel\n      .join()\n      .receive('ok', (res: any) => {\n        this.logger.debug('Successfully listening for new conversations!', res);\n      })\n      .receive('error', (err: any) => {\n        this.logger.debug('Unable to listen for new conversations!', err);\n      });\n  };\n\n  listenForAgentAvailability = () => {\n    const {accountId} = this.props.config;\n    const room = this.socket.channel(`room:${accountId}`, {});\n\n    room\n      .join()\n      .receive('ok', (res: any) => {\n        this.logger.debug('Joined room successfully!', res);\n      })\n      .receive('error', (err: any) => {\n        this.logger.debug('Unable to join room!', err);\n      });\n\n    const presence = new Presence(room);\n\n    presence.onSync(() => {\n      this.logger.debug('Syncing presence:', presence.list());\n\n      this.setState({\n        availableAgents: presence\n          .list()\n          .map(({metas}) => {\n            const [info] = metas;\n\n            return info;\n          })\n          .filter((info) => !!info.user_id),\n      });\n    });\n  };\n\n  scrollIntoView = () => {\n    this.scrollToEl && this.scrollToEl.scrollIntoView(false);\n  };\n\n  // If the page is not visible (i.e. user is looking at another tab),\n  // we want to mark messages as read once the chat widget becomes visible\n  // again, as long as it's open.\n  handleVisibilityChange = (e?: any) => {\n    const doc = document || (e && e.target);\n\n    if (isWindowHidden(doc)) {\n      return;\n    }\n\n    const {messages = []} = this.state;\n    const shouldMarkSeen = messages.some((msg) => this.shouldMarkAsSeen(msg));\n\n    if (shouldMarkSeen) {\n      this.markMessagesAsSeen();\n    }\n  };\n\n  handlePapercupsPlan = (payload: any = {}) => {\n    this.logger.debug('Handling subscription plan:', payload);\n\n    // TODO: figure out the best way to determine when to display branding\n    // const plan = payload && payload.plan;\n    // const shouldDisplayBranding = plan\n    //   ? String(plan).toLowerCase() === 'starter'\n    //   : false;\n\n    this.setState({shouldDisplayBranding: true});\n  };\n\n  // TODO: how is this different than `handleToggleOpen`?\n  handleToggleDisplay = (payload: any = {}) => {\n    const isOpen = !!payload.isOpen;\n\n    this.setState({isOpen}, () => {\n      this.handleVisibilityChange();\n\n      if (isOpen) {\n        this.scrollIntoView();\n      }\n    });\n  };\n\n  getDefaultGreeting = (): Array<Message> => {\n    const {greeting} = this.props.config;\n\n    if (!greeting) {\n      return [];\n    }\n\n    return [\n      {\n        type: 'bot',\n        customer_id: 'bot',\n        body: greeting, // 'Hi there! How can I help you?',\n        created_at: new Date().toISOString(), // TODO: what should this be?\n        seen_at: new Date().toISOString(),\n      },\n    ];\n  };\n\n  isValidCustomer = async (customerId?: string | null) => {\n    if (!customerId || !customerId.length) {\n      return false;\n    }\n\n    if (!isValidUuid(customerId)) {\n      return false;\n    }\n\n    const {baseUrl, accountId} = this.props.config;\n\n    try {\n      const isValidCustomer = await API.isValidCustomer(\n        customerId,\n        accountId,\n        baseUrl\n      );\n\n      return isValidCustomer;\n    } catch (err) {\n      this.logger.warn('Failed to validate customer ID.');\n      this.logger.warn('You might be on an older version of Papercups.');\n      // Return true for backwards compatibility\n      return true;\n    }\n  };\n\n  // Check if we have a matching customer based on the `external_id` provided\n  // in the customer metadata. Otherwise, fallback to the cached customer id.\n  checkForExistingCustomer = async (\n    metadata?: CustomerMetadata,\n    defaultCustomerId?: string | null\n  ): Promise<string | null | undefined> => {\n    if (!metadata || !metadata?.external_id) {\n      this.setState({customerId: defaultCustomerId});\n\n      return defaultCustomerId;\n    }\n\n    const {accountId, baseUrl} = this.props.config;\n    // NB: we check for matching existing customers based on external_id, email,\n    // and host -- this may break across subdomains, but I think this is fine for now.\n    const {email, host, external_id: externalId} = metadata;\n    const filters = {email, host};\n    // TODO: make this opt-in?\n    const {\n      customer_id: matchingCustomerId,\n    } = await API.findCustomerByExternalId(\n      externalId,\n      accountId,\n      filters,\n      baseUrl\n    );\n\n    if (!matchingCustomerId) {\n      this.setState({customerId: null});\n\n      return null;\n    } else if (matchingCustomerId === defaultCustomerId) {\n      this.setState({customerId: defaultCustomerId});\n\n      return defaultCustomerId;\n    } else {\n      this.setState({customerId: matchingCustomerId});\n      // Emit update so we can cache the ID in the parent window\n      // this.emit('customer:updated', {customerId: matchingCustomerId});\n      this.handleCacheCustomerId(matchingCustomerId);\n\n      return matchingCustomerId;\n    }\n  };\n\n  // Check if we've seen this customer before; if we have, try to fetch\n  // the latest existing conversation for that customer. Otherwise, we wait\n  // until the customer initiates the first message to create the conversation.\n  fetchLatestConversation = async (\n    cachedCustomerId?: string | null,\n    metadata?: CustomerMetadata\n  ) => {\n    // TODO: is there a way to split up some of this logic a little better?\n    const customerId = await this.checkForExistingCustomer(\n      metadata,\n      cachedCustomerId\n    );\n\n    if (!customerId) {\n      // If there's no customerId, we haven't seen this customer before,\n      // so do nothing until they try to create a new message\n      this.setState({messages: [...this.getDefaultGreeting()]});\n\n      return;\n    }\n\n    const {accountId, baseUrl} = this.props.config;\n\n    this.logger.debug('Fetching conversations for customer:', customerId);\n\n    try {\n      const conversations = await API.fetchCustomerConversations(\n        customerId,\n        accountId,\n        baseUrl\n      );\n\n      this.logger.debug('Found existing conversations:', conversations);\n\n      if (!conversations || !conversations.length) {\n        // If there are no conversations yet, wait until the customer creates\n        // a new message to create the new conversation\n        this.setState({messages: [...this.getDefaultGreeting()]});\n        this.listenForNewConversations(customerId);\n\n        return;\n      }\n\n      const [latest] = conversations;\n      const {id: conversationId, messages = []} = latest;\n      const formattedMessages = messages.sort(\n        (a: any, b: any) => +new Date(a.created_at) - +new Date(b.created_at)\n      );\n\n      this.setState({\n        conversationId,\n        messages: [...this.getDefaultGreeting(), ...formattedMessages],\n      });\n\n      this.joinConversationChannel(conversationId, customerId);\n\n      await this.updateExistingCustomer(customerId, metadata);\n\n      const unseenMessages = formattedMessages.filter(\n        (msg: Message) => !msg.seen_at && !!msg.user_id\n      );\n\n      if (unseenMessages.length > 0) {\n        const [firstUnseenMessage] = unseenMessages;\n\n        this.handleUnseenMessages({message: firstUnseenMessage});\n      }\n    } catch (err) {\n      this.logger.debug('Error fetching conversations!', err);\n    }\n  };\n\n  createOrUpdateCustomer = async (\n    accountId: string,\n    existingCustomerId?: string | null,\n    email?: string\n  ): Promise<string> => {\n    const {baseUrl, customer} = this.props.config;\n    const metadata = email ? {...customer, email} : customer;\n\n    try {\n      const customer = existingCustomerId\n        ? await API.updateCustomerMetadata(\n            existingCustomerId,\n            metadata,\n            baseUrl\n          )\n        : await API.createNewCustomer(accountId, metadata, baseUrl);\n      const {id: customerId} = customer;\n\n      if (!existingCustomerId) {\n        this.handleCacheCustomerId(customerId);\n      }\n\n      return customerId;\n    } catch (err) {\n      // TODO: this edge case may occur if the cached customer ID somehow\n      // gets messed up (e.g. between dev and prod environments). The long term\n      // fix should be changing the cache key for different environments.\n      this.logger.error('Failed to update or create customer:', err);\n      this.logger.error('Retrying...');\n\n      const {id: customerId} = await API.createNewCustomer(\n        accountId,\n        metadata,\n        baseUrl\n      );\n\n      this.handleCacheCustomerId(customerId);\n\n      return customerId;\n    }\n  };\n\n  // Updates the customer with metadata fields like `name`, `email`, `external_id`\n  // to make it easier to identify customers in the dashboard.\n  updateExistingCustomer = async (\n    customerId: string,\n    metadata?: CustomerMetadata\n  ) => {\n    if (!metadata) {\n      return;\n    }\n\n    try {\n      const {baseUrl} = this.props.config;\n\n      await API.updateCustomerMetadata(customerId, metadata, baseUrl);\n    } catch (err) {\n      this.logger.debug('Error updating customer metadata!', err);\n    }\n  };\n\n  initializeNewConversation = async (\n    existingCustomerId?: string | null,\n    email?: string\n  ) => {\n    const {accountId, baseUrl} = this.props.config;\n    const customerId = await this.createOrUpdateCustomer(\n      accountId,\n      existingCustomerId,\n      email\n    );\n    const {id: conversationId} = await API.createNewConversation(\n      accountId,\n      customerId,\n      baseUrl\n    );\n\n    this.setState({customerId, conversationId});\n    this.joinConversationChannel(conversationId, customerId);\n\n    return {customerId, conversationId};\n  };\n\n  joinConversationChannel = (conversationId: string, customerId?: string) => {\n    if (this.channel && this.channel.leave) {\n      this.channel.leave(); // TODO: what's the best practice here?\n    }\n\n    this.logger.debug('Joining channel:', conversationId);\n\n    this.channel = this.socket.channel(`conversation:${conversationId}`, {\n      customer_id: customerId,\n    });\n\n    this.channel.on('shout', (message: any) => {\n      this.handleNewMessage(message);\n    });\n\n    this.channel\n      .join()\n      .receive('ok', (res: any) => {\n        this.logger.debug('Joined conversation successfully!', res);\n      })\n      .receive('error', (err: any) => {\n        this.logger.debug('Unable to join conversation!', err);\n      });\n\n    this.sendCustomerUpdate({conversationId, customerId});\n    this.scrollIntoView();\n  };\n\n  handleNewMessage = (message: Message) => {\n    this.handleMessageReceived(message);\n\n    const {messages = []} = this.state;\n    const unsent = messages.find(\n      (m) =>\n        !m.created_at &&\n        areDatesEqual(m.sent_at, message.sent_at) &&\n        (m.body === message.body || (!m.body && !message.body))\n    );\n    const updated = unsent\n      ? messages.map((m) => (m.sent_at === unsent.sent_at ? message : m))\n      : [...messages, message];\n\n    this.setState({messages: updated}, () => {\n      this.scrollIntoView();\n\n      if (this.shouldMarkAsSeen(message)) {\n        this.markMessagesAsSeen();\n      } else if (!unsent) {\n        // If the message was not `unsent`, we know it came from the other end,\n        // in which case we should indicate that it hasn't been seen yet.\n        this.handleUnseenMessages({message});\n      }\n    });\n  };\n\n  shouldMarkAsSeen = (message: Message) => {\n    const {isOpen} = this.state;\n    const {user_id: agentId, seen_at: seenAt} = message;\n    const isAgentMessage = !!agentId;\n\n    // If already seen or the page is not visible, don't mark as seen\n    if (seenAt || isWindowHidden(document)) {\n      return false;\n    }\n\n    return isAgentMessage && isOpen;\n  };\n\n  markMessagesAsSeen = () => {\n    const {customerId, conversationId, messages = []} = this.state;\n\n    if (!this.channel || !customerId || !conversationId) {\n      return;\n    }\n\n    this.logger.debug('Marking messages as seen!');\n\n    this.channel.push('messages:seen', {});\n    this.handleMessagesSeen();\n    this.setState({\n      messages: messages.map((msg) => {\n        return msg.seen_at ? msg : {...msg, seen_at: new Date().toISOString()};\n      }),\n    });\n  };\n\n  handleSendMessage = async (message: Partial<Message>, email?: string) => {\n    const {customerId, conversationId, isSending} = this.state;\n    const {body = '', file_ids = []} = message;\n    const isMissingBody = !body || body.trim().length === 0;\n    const isMissingAttachments = !file_ids || file_ids.length === 0;\n    const shouldSkipSending = isMissingBody && isMissingAttachments;\n\n    if (isSending || shouldSkipSending) {\n      return;\n    }\n\n    // TODO: this seems to be unreliable\n    const sentAt = new Date().toISOString();\n    // TODO: figure out how this should work if `customerId` is null\n    const payload: Message = {\n      ...message,\n      body,\n      customer_id: customerId,\n      type: 'customer',\n      sent_at: sentAt,\n    };\n\n    this.setState(\n      {\n        messages: [...this.state.messages, payload],\n      },\n      () => this.scrollIntoView()\n    );\n\n    if (!customerId || !conversationId) {\n      await this.initializeNewConversation(customerId, email);\n    }\n\n    // We should never hit this block, just adding to satisfy TypeScript\n    if (!this.channel) {\n      return;\n    }\n\n    this.channel.push('shout', {\n      ...message,\n      body,\n      customer_id: this.state.customerId,\n      sent_at: sentAt,\n    });\n\n    // TODO: should this only be emitted after the message is successfully sent?\n    this.handleMessageSent({\n      ...message,\n      body,\n      type: 'customer',\n      sent_at: sentAt,\n      customer_id: this.state.customerId,\n      conversation_id: this.state.conversationId,\n    });\n  };\n\n  // TODO: make it possible to disable this feature?\n  renderUnreadMessages() {\n    const MAX_CHARS = 140;\n    const {notifications} = this.props;\n\n    if (!notifications || typeof notifications !== 'function') {\n      return null;\n    }\n\n    const {customerId, messages = []} = this.state;\n    const unread = messages\n      .filter((msg) => {\n        const {seen_at: seen, body} = msg;\n\n        if (seen) {\n          return false;\n        }\n\n        // NB: `msg.type` doesn't come from the server, it's just a way to\n        // help identify unsent messages in the frontend for now\n        const isMe = isCustomerMessage(msg, customerId);\n\n        return !isMe && body && body.trim().length > 0;\n      })\n      .slice(0, 2) // Only show the first 2 unread messages\n      .map((msg) => {\n        const {body = ''} = msg;\n\n        return {...msg, body: shorten(body, MAX_CHARS)};\n      });\n\n    if (unread.length === 0) {\n      return null;\n    }\n\n    // TODO: how should this be styled/positioned? (probably similar to toggle?)\n    return (\n      <NotificationsContainer isOpen>\n        <Flex\n          style={{\n            background: 'transparent',\n            flexDirection: 'column',\n            justifyContent: 'flex-end',\n            height: '100%',\n            width: '100%',\n            flex: 1,\n          }}\n        >\n          {notifications({\n            config: this.props.config,\n            state: this.state,\n            unread: unread,\n            onToggleOpen: this.handleToggleOpen,\n          })}\n        </Flex>\n      </NotificationsContainer>\n    );\n  }\n\n  render() {\n    const {config, styles = {}, children} = this.props;\n    const {\n      isOpen,\n      shouldDisplayNotifications,\n      shouldDisplayBranding,\n    } = this.state;\n\n    // TODO: set up a React context for this?\n    if (children) {\n      return children({\n        config: config,\n        state: this.state,\n        // TODO: dedupe?\n        onClose: this.handleToggleOpen,\n        onToggleOpen: this.handleToggleOpen,\n        onSendMessage: this.handleSendMessage,\n        scrollToRef: (el: any) => (this.scrollToEl = el),\n      });\n    }\n\n    return (\n      <React.Fragment>\n        {!isOpen && shouldDisplayNotifications && this.renderUnreadMessages()}\n\n        <ChatWindowContainer\n          className='Papercups-chatWindowContainer'\n          isOpen={isOpen}\n        >\n          <Flex\n            style={{\n              background: '#fff',\n              flexDirection: 'column',\n              height: '100%',\n              width: '100%',\n              flex: 1,\n            }}\n          >\n            {this.props.header &&\n              this.props.header({\n                config: config,\n                state: this.state,\n                onClose: this.handleToggleOpen,\n              })}\n\n            <Box\n              style={{\n                flex: 1,\n                overflowY: 'scroll',\n                // boxShadow: 'rgba(0, 0, 0, 0.2) 0px 21px 4px -20px inset',\n                ...styles.body,\n              }}\n            >\n              {this.props.body &&\n                this.props.body({\n                  config: config,\n                  state: this.state,\n                  scrollToRef: (el: any) => (this.scrollToEl = el),\n                })}\n            </Box>\n\n            {shouldDisplayBranding && <PapercupsBranding />}\n\n            {this.props.footer &&\n              this.props.footer({\n                config: config,\n                state: this.state,\n                onSendMessage: this.handleSendMessage,\n              })}\n\n            <img\n              alt='Papercups'\n              src='https://papercups.s3.us-east-2.amazonaws.com/papercups-logo.svg'\n              width='0'\n              height='0'\n            />\n          </Flex>\n        </ChatWindowContainer>\n\n        <ToggleButtonContainer className='Papercups-toggleButtonContainer'>\n          {this.props.toggle &&\n            this.props.toggle({\n              config: config,\n              state: this.state,\n              onToggleOpen: this.handleToggleOpen,\n            })}\n        </ToggleButtonContainer>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default ChatBuilder;\n","// TODO: do something different for dev vs prod\n// TODO: do something different for dev vs prod\nconst PREFIX = '__PAPERCUPS__';\n\n// FIXME: this is just a workaround until we can stop\n// relying on localStorage in our chat iframe\nconst getStorage = (w: any) => {\n  try {\n    const storage = w && (w.localStorage || w.sessionStorage);\n\n    return storage;\n  } catch (e) {\n    return {\n      _db: {},\n      getItem(key: string) {\n        return this._db[key] || null;\n      },\n      setItem(key: string, value: any) {\n        this._db[key] = value;\n      },\n      removeItem(key: string) {\n        delete this._db[key];\n      },\n    };\n  }\n};\n\nexport default function store(w: any) {\n  const storage = getStorage(w);\n\n  const get = (key: string) => {\n    const result = storage.getItem(`${PREFIX}${key}`);\n\n    if (!result) {\n      return null;\n    }\n\n    try {\n      return JSON.parse(result);\n    } catch (e) {\n      return result;\n    }\n  };\n\n  const set = (key: string, value: any) => {\n    storage.setItem(`${PREFIX}${key}`, JSON.stringify(value));\n  };\n\n  const remove = (key: string) => {\n    storage.removeItem(key);\n  };\n\n  // TODO: improve these names\n\n  return {\n    getCustomerId: () => get('__CUSTOMER_ID__'),\n    setCustomerId: (id: string) => set('__CUSTOMER_ID__', id),\n    removeCustomerId: () => remove('__CUSTOMER_ID__'),\n  };\n}\n","import React from 'react';\nimport styled from '@emotion/styled';\n\nconst ToggleButton = styled.button({\n  outline: 'none',\n  border: 'none',\n  userSelect: 'none',\n  cursor: 'pointer',\n  width: '50px',\n  height: '50px',\n  borderRadius: '50%',\n  display: 'flex',\n  justifyContent: 'center',\n  alignItems: 'center',\n\n  '&:focus': {\n    outline: 'none',\n  },\n});\n\nconst OpenIcon = () => {\n  return (\n    <svg width='27' height='27' viewBox='0 0 27 27'>\n      <path\n        fill='transparent'\n        strokeWidth='3'\n        stroke='hsl(0, 0%, 99%)'\n        strokeLinecap='round'\n        opacity='0'\n        d='M 7.5 14.5 L 19 14.5'\n      ></path>\n      <path\n        fill='transparent'\n        strokeWidth='3'\n        stroke='hsl(0, 0%, 99%)'\n        strokeLinecap='round'\n        opacity='0'\n        d='M 7.5 8.5 L 19 8.5'\n      ></path>\n      <path\n        fill='transparent'\n        strokeWidth='3'\n        stroke='hsl(0, 0%, 99%)'\n        strokeLinecap='round'\n        d='M22 21.6453C22 20 23 19.5 23 19.5C23 19.5 25.5 18 25.5 14V9C25.5 4 23 1.5 18 1.5H9C4 1.5 1.5 4 1.5 9V14C1.5 19 4 21 9 21H13.5C14 21 14 21 15 21.5L20.25 24.8572L20.8517 25.2118C21.5184 25.6046 22 25.631 22 24.8572V24.0287V22.7858V21.6453Z'\n        opacity='1'\n      ></path>\n    </svg>\n  );\n};\n\nconst CloseIcon = () => {\n  return (\n    <svg width='24' height='25' viewBox='0 0 24 25' fill='none'>\n      <path\n        fill='transparent'\n        strokeWidth='3'\n        stroke='hsl(0, 0%, 99%)'\n        strokeLinecap='round'\n        opacity='1'\n        d='M 5 5 L 20 20'\n      ></path>\n      <path\n        fill='transparent'\n        strokeWidth='3'\n        stroke='hsl(0, 0%, 99%)'\n        strokeLinecap='round'\n        opacity='1'\n        d='M 5 20 L 20 5'\n      ></path>\n      <path\n        d='M20.5 21.1453C20.5 19.5 21.5 19 21.5 19C21.5 19 24 18.5 24 13.5V8.5C24 3.5 21.5 1 16.5 1H7.5C2.5 1 0 3.5 0 8.5V13.5C0 18.5 2.5 20.5 7.5 20.5H12C12.5 20.5 12.5 20.5 13.5 21L18.75 24.3572L19.3517 24.7118C20.0184 25.1046 20.5 25.131 20.5 24.3572V23.5287V22.2858V21.1453Z'\n        fill='white'\n        fillOpacity='0.7'\n        opacity='0'\n      ></path>\n      <path\n        fillRule='evenodd'\n        clipRule='evenodd'\n        d='M21.5 18C21.5 18 20.5 18.5 20.5 20.1453V21.2858V22.5287V23.3572C20.5 24.131 20.0184 24.1046 19.3517 23.7118L18.75 23.3572L13.5 20C12.8174 19.6587 12.6007 19.5504 12.3729 19.516C12.267 19.5 12.1587 19.5 12 19.5H7.5C2.5 19.5 0 17.5 0 12.5V7.5C0 2.5 2.5 0 7.5 0H16.5C21.5 0 24 2.5 24 7.5V12.5C24 17.5 21.5 18 21.5 18ZM21 17.557C21.8581 17.557 24 13.557 23 13.057C22.3869 12.7505 21.8801 13.7414 21.4646 14.554C21.2023 15.0668 20.9764 15.5086 20.783 15.5086C20.283 15.5086 20 16.0554 20 16.7568C20 17.4582 20.1419 17.557 21 17.557Z'\n        fill='white'\n        opacity='0'\n      ></path>\n    </svg>\n  );\n};\n\nconst ChatToggle = ({\n  isOpen,\n  onToggleOpen,\n}: {\n  isOpen?: boolean;\n  onToggleOpen: () => void;\n}) => {\n  return (\n    <ToggleButton\n      style={{background: 'rgb(24, 144, 255)'}}\n      onClick={onToggleOpen}\n    >\n      {isOpen ? <CloseIcon /> : <OpenIcon />}\n    </ToggleButton>\n  );\n};\n\nexport default ChatToggle;\n","import React from 'react';\nimport styled from '@emotion/styled';\n\nconst Box = styled.div(({children, theme, ...props}: any) => {\n  return {...props};\n});\n\nconst Flex = styled.div(({children, theme, ...props}: any) => {\n  return {...props, display: 'flex'};\n});\n\nconst HeaderContainer = styled.div`\n  background: linear-gradient(135deg, rgb(24, 144, 255) 0%, rgb(0, 0, 0) 100%);\n  color: rgb(255, 255, 255);\n  padding: 24px 24px 4px 40px;\n`;\n\nconst HeaderTitle = styled.h2`\n  color: rgb(255, 255, 255);\n  font-size: 20px;\n  line-height: 30px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin: 0;\n  font-weight: normal;\n`;\n\nconst HeaderSubtitle = styled.p`\n  margin: 0;\n  color: rgba(255, 255, 255, 0.7);\n  font-size: 14px;\n  line-height: 21px;\n`;\n\nconst ReplyTimeContainer = styled.div`\n  display: flex;\n  align-items: center;\n  margin: 24px 0px 32px;\n`;\n\nconst ReplyTimeLabel = styled.div`\n  font-size: 14px;\n  width: 100%;\n  -webkit-box-flex: 1;\n  flex-grow: 1;\n  color: rgba(255, 255, 255, 0.7);\n  line-height: 1.5;\n`;\n\nconst ReplyTimeValue = styled(Flex)`\n  font-weight: 500;\n  font-size: 14px;\n  color: rgb(255, 255, 255);\n  line-height: 1.5;\n`;\n\nconst ClockSvg = () => {\n  return (\n    <svg\n      xmlns='http://www.w3.org/2000/svg'\n      width='14'\n      height='14'\n      viewBox='0 0 14 14'\n      style={{\n        fill: 'currentcolor',\n        alignSelf: 'center',\n        marginRight: 4,\n      }}\n    >\n      <path\n        fillRule='evenodd'\n        d='M12.5 7c0 3.0376-2.4624 5.5-5.5 5.5-3.03757 0-5.5-2.4624-5.5-5.5 0-3.03757 2.46243-5.5 5.5-5.5 3.0376 0 5.5 2.46243 5.5 5.5zM14 7c0 3.866-3.134 7-7 7-3.86599 0-7-3.134-7-7 0-3.86599 3.13401-7 7-7 3.866 0 7 3.13401 7 7zM6.27844 3.48219v3.78093l.00105.00104c.00305.07805.03658.1518.09341.20546l.07452.0566L9.6706 9.69708l.15009.03773h.05667c.09341-.01886.14904-.07442.20574-.13102l.4125-.65514c.0355-.04926.0552-.10809.0566-.16876 0-.09329-.0566-.14885-.1501-.20545L7.62817 6.68345V3.48219c0-.14989-.1312-.29979-.30017-.29979h-.74938c-.16898 0-.30018.1499-.30018.29979z'\n        clipRule='evenodd'\n      ></path>\n    </svg>\n  );\n};\n\nconst Header = ({config}: any) => {\n  const {title, subtitle} = config;\n\n  return (\n    <HeaderContainer>\n      <HeaderTitle>{title}</HeaderTitle>\n      <HeaderSubtitle>{subtitle}</HeaderSubtitle>\n      <ReplyTimeContainer>\n        <Box\n          style={{\n            height: 56,\n            width: 56,\n            borderRadius: '50%',\n            overflow: 'hidden',\n            marginRight: 8,\n          }}\n        >\n          <img\n            style={{height: '100%'}}\n            alt='Alex'\n            src='https://i.imgur.com/dNy8biD.jpg'\n          />\n        </Box>\n        <Box style={{marginLeft: 8}}>\n          <ReplyTimeLabel>Our usual reply time</ReplyTimeLabel>\n          <ReplyTimeValue alignItems='center'>\n            <ClockSvg /> A few minutes\n          </ReplyTimeValue>\n        </Box>\n      </ReplyTimeContainer>\n    </HeaderContainer>\n  );\n};\n\nexport default Header;\n","import React from 'react';\nimport styled from '@emotion/styled';\nimport {BodyProps} from '@papercups-io/chat-builder';\nimport dayjs from 'dayjs';\n\nconst Box = styled.div(({children, theme, ...props}: any) => {\n  return {...props};\n});\n\nconst Flex = styled.div(({children, theme, ...props}: any) => {\n  return {...props, display: 'flex'};\n});\n\nconst BodyContainer = styled(Box)`\n  position: relative;\n  flex: 1 1 0%;\n  height: 100%;\n  background-color: white;\n  box-shadow: rgb(0 0 0 / 20%) 0px 21px 4px -20px inset;\n  padding: 24px 24px 0px;\n`;\n\nconst groupMessagesByDate = (messages: Array<any>) => {\n  return messages.reduce((acc, message, idx) => {\n    const next = messages[idx + 1] || null;\n    const date =\n      message.type === 'bot' && next ? next.created_at : message.created_at;\n    const formatted = dayjs(date).format('MMMM DD');\n\n    return {...acc, [formatted]: (acc[formatted] || []).concat(message)};\n  }, {});\n};\n\nconst CustomerMessage = ({message, isNextSameSender}: any) => {\n  return (\n    <Flex\n      style={{\n        paddingBottom: isNextSameSender ? 8 : 16,\n        paddingLeft: 48,\n        paddingRight: 0,\n        justifyContent: 'flex-end',\n      }}\n    >\n      <Box\n        style={{\n          fontSize: 14,\n          borderRadius: 5,\n          padding: '16px 20px',\n          background: 'rgb(24, 144, 255)',\n          color: '#fff',\n          whiteSpace: 'pre-wrap',\n        }}\n      >\n        {message.body}\n      </Box>\n    </Flex>\n  );\n};\n\nconst AgentMessage = ({message, isNextSameSender}: any) => {\n  const profilePhotoUrl = message.user?.profile_photo_url;\n  const shouldDisplayAvatar = !isNextSameSender;\n\n  return (\n    <Flex\n      style={{\n        position: 'relative',\n        paddingBottom: isNextSameSender ? 8 : 16,\n        paddingLeft: 44,\n        paddingRight: 48,\n        justifyContent: 'flex-start',\n        alignItems: 'flex-end',\n      }}\n    >\n      {shouldDisplayAvatar && (\n        <Box\n          style={{\n            height: 32,\n            width: 32,\n            position: 'absolute',\n            left: 0,\n            bottom: 24,\n\n            borderRadius: '50%',\n            justifyContent: 'center',\n            alignItems: 'center',\n\n            backgroundPosition: 'center',\n            backgroundSize: 'cover',\n            backgroundImage: `url(${profilePhotoUrl})`,\n          }}\n        />\n      )}\n\n      <Box\n        style={{\n          fontSize: 14,\n          borderRadius: 5,\n          padding: '16px 20px',\n          background: 'rgb(245, 245, 245)',\n          color: 'rgba(0,0,0,.65)',\n          whiteSpace: 'pre-wrap',\n        }}\n      >\n        {message.body}\n      </Box>\n    </Flex>\n  );\n};\n\nconst Body = ({state, scrollToRef}: BodyProps) => {\n  const {customerId, messages = []} = state;\n  const grouped = groupMessagesByDate(messages);\n\n  return (\n    <BodyContainer>\n      {Object.keys(grouped).map((date) => {\n        const messages = grouped[date];\n\n        return (\n          <Box key={date}>\n            <Flex\n              style={{\n                paddingTop: 14,\n                paddingBottom: 14,\n                fontSize: 14,\n                color: 'rgb(115, 115, 118)',\n                justifyContent: 'center',\n                alignItems: 'center',\n              }}\n            >\n              {date}\n            </Flex>\n\n            {messages.map((message: any, idx: number) => {\n              // TODO: clean/DRY up a bit?\n              const isCustomer =\n                message.customer_id === customerId ||\n                (!!message.sent_at && message.type === 'customer');\n              const next = messages[idx + 1];\n              const isNextMessageCustomer =\n                next &&\n                (next.customer_id === customerId ||\n                  (!!next.sent_at && next.type === 'customer'));\n              const isNextSameSender = isCustomer === isNextMessageCustomer;\n\n              if (isCustomer) {\n                return (\n                  <CustomerMessage\n                    key={message.id || idx}\n                    message={message}\n                    isNextSameSender={isNextSameSender}\n                  />\n                );\n              } else {\n                return (\n                  <AgentMessage\n                    key={message.id || idx}\n                    message={message}\n                    isNextSameSender={isNextSameSender}\n                  />\n                );\n              }\n            })}\n          </Box>\n        );\n      })}\n\n      <Box key='scroll-el' ref={scrollToRef} />\n    </BodyContainer>\n  );\n};\n\nexport default Body;\n","import React from 'react';\nimport styled from '@emotion/styled';\n\nconst Box = styled.div(({children, theme, ...props}: any) => {\n  return {...props};\n});\n\nconst FooterWrapper = styled(Box)`\n  min-height: 56px;\n  max-height: 200px;\n  position: relative;\n  border-top: 1px solid rgb(230, 230, 230);\n`;\n\nconst FooterContainer = styled(Box)`\n  position: absolute;\n  bottom: 0px;\n  top: 0px;\n  left: 0px;\n  right: 0px;\n`;\n\nconst FooterTextarea = styled.textarea`\n  box-sizing: border-box;\n  padding: 18px 100px 18px 29px;\n  width: 100%;\n  height: 100%;\n  font-family: 'Open Sans', 'Helvetica Neue', 'Apple Color Emoji', Helvetica,\n    Arial, sans-serif;\n  font-size: 14px;\n  font-weight: normal;\n  line-height: 1.33;\n  background-color: rgb(255, 255, 255);\n  white-space: pre-wrap;\n  overflow-wrap: break-word;\n\n  position: absolute;\n  bottom: 0px;\n  left: 0px;\n  color: rgb(0, 0, 0);\n  resize: none;\n  border: none;\n  transition: background-color 200ms ease 0s, box-shadow 200ms ease 0s;\n  outline-offset: -5px;\n\n  outline: none;\n\n  &:focus {\n    outline: none;\n    background-color: rgb(255, 255, 255);\n    box-shadow: rgb(0 0 0 / 10%) 0px 0px 100px 0px;\n  }\n`;\n\nconst EmojiSvg = () => {\n  return (\n    <svg\n      style={{height: 18, top: 18, position: 'absolute', fill: 'currentcolor'}}\n      focusable='false'\n      aria-hidden='true'\n      viewBox='0 0 18 18'\n    >\n      <path\n        d='M9 0a9 9 0 1 1 0 18A9 9 0 0 1 9 0zm0 1C4.589 1 1 4.589 1 9s3.589 8 8 8 8-3.589 8-8-3.589-8-8-8zM5 6.999a1 1 0 1 1 2.002.004A1 1 0 0 1 5 6.999zm5.999 0a1.002 1.002 0 0 1 2.001 0 1 1 0 1 1-2.001 0zM8.959 13.5c-.086 0-.173-.002-.26-.007-2.44-.132-4.024-2.099-4.09-2.182l-.31-.392.781-.62.312.39c.014.017 1.382 1.703 3.37 1.806 1.306.072 2.61-.554 3.882-1.846l.351-.356.712.702-.35.356c-1.407 1.427-2.886 2.15-4.398 2.15z'\n        fillRule='evenodd'\n      ></path>\n    </svg>\n  );\n};\n\nconst FileSvg = () => {\n  return (\n    <svg\n      style={{height: 18, top: 18, position: 'absolute', fill: 'currentcolor'}}\n      focusable='false'\n      aria-hidden='true'\n      viewBox='0 0 16 18'\n    >\n      <path\n        d='M14.154 6.918l-.004.003.001-.004-3.287 3.286-.006-.005-3.574 3.574c-.016.017-.03.036-.048.053l-.05.047-.043.041v-.002c-1.167 1.07-2.692 1.331-3.823.2-1.13-1.13-.89-2.677.18-3.843l-.005-.004.074-.073.016-.018c.006-.005.012-.009.017-.016l6.053-6.053.761.76-6.053 6.054-.029.028v.001l-.005.004-.073.074c.011-.01.025-.018.035-.03-.688.75-.93 1.636-.21 2.356.72.72 1.583.456 2.333-.232l-.03.034.04-.042.01-.008.008-.009.033-.03.031-.034.01-.009.007-.009 5.004-5.003.005.006 1.858-1.859c1.223-1.218 1.51-2.913.291-4.132C12.462.806 10.414.74 9.195 1.958L2.248 8.905c.003 0 .006-.002.008-.004-1.625 1.667-1.542 4.43.103 6.074 1.646 1.646 4.474 1.795 6.141.17-.003.002-.004.008-.008.012l.047-.047 6.053-6.054.042-.042.743.78-.025.021.001.002-6.05 6.05-.002.002-.002.001-.046.046h-.002c-2.094 2.04-5.578 1.894-7.652-.18-2.049-2.049-2.15-5.407-.183-7.505l-.006-.005h-.002l.076-.078 6.943-6.944.003-.002.004-.005c1.641-1.64 4.367-1.574 6.008.066 1.64 1.642 1.353 4.014-.288 5.655z'\n        fillRule='evenodd'\n      ></path>\n    </svg>\n  );\n};\n\nconst FooterButtonsContainer = styled(Box)`\n  position: absolute;\n  top: 0px;\n  right: 21px;\n`;\n\nconst FooterButton = styled.button`\n  margin: 0px;\n  padding: 0px;\n  background-color: transparent;\n  background-image: none;\n  border: none;\n  border-radius: 0px;\n  box-sizing: content-box;\n  min-width: 0px;\n  position: relative;\n  float: left;\n  display: inline-block;\n  cursor: pointer;\n  opacity: 0.4;\n  transition: opacity 200ms ease 0s;\n  height: 51px;\n  margin-top: 2px;\n  padding-left: 8px;\n  padding-right: 8px;\n\n  &:focus {\n    outline: none;\n  }\n`;\n\nconst Footer = ({onSendMessage}: any) => {\n  const [message, setMessageBody] = React.useState('');\n\n  const handleChangeMessage = (e: React.ChangeEvent<HTMLTextAreaElement>) =>\n    setMessageBody(e.target.value);\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      onSendMessage({body: message});\n      setMessageBody('');\n    }\n  };\n\n  return (\n    <FooterWrapper>\n      <FooterContainer>\n        <FooterTextarea\n          placeholder='Send a message...'\n          value={message}\n          onChange={handleChangeMessage}\n          onKeyDown={handleKeyDown}\n        />\n        <FooterButtonsContainer>\n          <FooterButton style={{width: 18}}>\n            <EmojiSvg />\n          </FooterButton>\n          <FooterButton style={{width: 18}}>\n            <FileSvg />\n          </FooterButton>\n        </FooterButtonsContainer>\n      </FooterContainer>\n    </FooterWrapper>\n  );\n};\n\nexport default Footer;\n","import React from 'react';\nimport {ChatBuilder, ChatToggle} from '@papercups-io/chat-builder';\nimport Header from './Header';\nimport Body from './Body';\nimport Footer from './Footer';\n\n// NB: during development, replace this with a valid account ID from your dev db\nconst TEST_ACCOUNT_ID = 'eb504736-0f20-4978-98ff-1a82ae60b266';\n\nconst config = {\n  title: 'Welcome to Papercups!',\n  subtitle: 'Ask us anything in the chat window 😊',\n  accountId: TEST_ACCOUNT_ID,\n  greeting: 'Hi there! How can I help you?',\n  customer: {\n    name: 'Test User',\n    email: 'test@test.com',\n    external_id: '123',\n    // Ad hoc metadata\n    metadata: {\n      plan: 'starter',\n      registered_at: '2020-09-01',\n      age: 25,\n      valid: true,\n    },\n  },\n  // NB: we override these values during development -- note that the\n  // baseUrl: 'http://localhost:4000',\n  baseUrl: 'https://alex-papercups-staging.herokuapp.com',\n};\n\nconst App = () => {\n  return (\n    <div>\n      <ChatBuilder\n        config={config}\n        isOpenByDefault\n        header={({config, state, onClose}) => {\n          return <Header config={config} state={state} onClose={onClose} />;\n        }}\n        body={({config, state, scrollToRef}) => {\n          return (\n            <Body config={config} state={state} scrollToRef={scrollToRef} />\n          );\n        }}\n        footer={({config, state, onSendMessage}) => {\n          return (\n            <Footer\n              config={config}\n              state={state}\n              onSendMessage={onSendMessage}\n            />\n          );\n        }}\n        toggle={({state, onToggleOpen}) => {\n          const {isOpen} = state;\n\n          return <ChatToggle isOpen={isOpen} onToggleOpen={onToggleOpen} />;\n        }}\n      />\n    </div>\n  );\n};\n\nexport default App;\n","import './index.css';\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}